<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameHub - Multiplayer Game Rooms</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect rx='20' width='100' height='100' fill='%230ff'/><circle cx='35' cy='45' r='8' fill='%23111'/><circle cx='65' cy='45' r='8' fill='%23111'/><rect x='20' y='60' rx='5' width='25' height='8' fill='%23111'/><rect x='55' y='60' rx='5' width='25' height='8' fill='%23111'/></svg>">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'orbitron': ['"Orbitron"', 'sans-serif'],
                        'quicksand': ['"Quicksand"', 'sans-serif']
                    },
                    screens: {
                        'landscape': { 'raw': '(orientation: landscape) and (max-height: 500px)' }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            max-width: 100vw;
        }
        
        /* Tron glow effects */
        .tron-glow {
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5), 0 0 40px rgba(0, 255, 255, 0.3);
        }
        
        .tron-border {
            border: 2px solid #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5), inset 0 0 10px rgba(0, 255, 255, 0.2);
        }
        
        .tron-text-glow {
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8), 0 0 20px rgba(0, 255, 255, 0.4);
        }
        
        /* Grid background for Tron theme - Simple bright grid */
        .tron-grid {
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
        }
        
        /* Perspective city grid for Tron theme (backup - not used) */
        .tron-grid-city {
            background: 
                linear-gradient(to bottom, 
                    rgba(0, 0, 0, 1) 0%,
                    rgba(0, 20, 40, 1) 50%,
                    rgba(0, 0, 0, 1) 100%
                );
            position: relative;
        }
        
        .tron-grid-city::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 49px,
                    rgba(0, 255, 255, 0.15) 49px,
                    rgba(0, 255, 255, 0.15) 50px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 49px,
                    rgba(0, 255, 255, 0.1) 49px,
                    rgba(0, 255, 255, 0.1) 50px
                );
            background-size: 50px 50px;
            transform: perspective(500px) rotateX(60deg);
            transform-origin: center bottom;
            opacity: 0.6;
        }
        
        .tron-grid-city::after {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(ellipse at center bottom, transparent 0%, rgba(0, 0, 0, 0.8) 70%);
        }
        
        /* Kids theme styles */
        .kids-bubble {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        /* Robot head eye animation */
        .robot-eye-glow {
            animation: eyeGlow 3s ease-in-out infinite, eyeMove 4s ease-in-out infinite;
        }
        
        @keyframes eyeGlow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        @keyframes eyeMove {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(2px); }
            75% { transform: translateX(-2px); }
        }
        
        /* Constrain kids icon movement */
        .kids-icon-float {
            animation: gentleFloat 6s ease-in-out infinite;
        }
        
        @keyframes gentleFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }
        
        @keyframes softPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Custom scrollbar styles */
        .scrollbar-tron::-webkit-scrollbar {
            width: 8px;
        }
        
        .scrollbar-tron::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        .scrollbar-tron::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #06b6d4, #0891b2);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
        }
        
        .scrollbar-tron::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #22d3ee, #06b6d4);
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.8);
        }
        
        .scrollbar-kids::-webkit-scrollbar {
            width: 10px;
        }
        
        .scrollbar-kids::-webkit-scrollbar-track {
            background: rgba(216, 180, 254, 0.3);
            border-radius: 10px;
        }
        
        .scrollbar-kids::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #d8b4fe, #a855f7);
            border-radius: 10px;
        }
        
        .scrollbar-kids::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #e9d5ff, #c084fc);
        }
        
        .scrollbar-scary::-webkit-scrollbar {
            width: 8px;
        }
        
        .scrollbar-scary::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
        }
        
        .scrollbar-scary::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #ea580c, #7c2d12);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(234, 88, 12, 0.5);
        }
        
        .scrollbar-scary::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #f97316, #9a3412);
            box-shadow: 0 0 15px rgba(234, 88, 12, 0.8);
        }
        
        .kids-shadow {
            box-shadow: 0 8px 16px rgba(255, 105, 180, 0.3);
        }
        
        /* Star rating */
        .star {
            color: #ffd700;
        }

        @keyframes fadeToast {
            0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
            10% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
        }

        /* Mobile player avatar scaling (70%) */
        @media (max-width: 767px) {
            .player-avatar {
                transform: scale(0.7);
                transform-origin: center top;
                margin: -6px -4px;
            }
        }

        /* Phone landscape compact overrides */
        @media (orientation: landscape) and (max-height: 500px) {
            .landscape-compact-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
                gap: 0.5rem !important;
            }
        }

        /* QR code: scale to fill container height */
        .qr-small-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        .qr-small-container img,
        .qr-small-container canvas {
            display: block;
            width: auto !important;
            height: 100% !important;
            max-height: 100%;
            aspect-ratio: 1;
        }

        /* Dual-thumb range slider thumbs */
        .dual-range-wrapper input[type="range"]::-webkit-slider-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--tw-thumb-bg, #06b6d4);
            border: 2px solid rgba(255,255,255,0.9);
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
            pointer-events: auto;
            position: relative;
            z-index: 10;
        }
        .dual-range-wrapper input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--tw-thumb-bg, #06b6d4);
            border: 2px solid rgba(255,255,255,0.9);
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
            cursor: pointer;
            pointer-events: auto;
            position: relative;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide icons as SVG components
        const Gamepad2 = ({ className, strokeWidth = 2 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="6" y1="12" x2="10" y2="12"></line>
                <line x1="8" y1="10" x2="8" y2="14"></line>
                <line x1="15" y1="13" x2="15.01" y2="13"></line>
                <line x1="18" y1="11" x2="18.01" y2="11"></line>
                <rect x="2" y="6" width="20" height="12" rx="2"></rect>
            </svg>
        );

        const Users = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );

        const QrCode = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="3" y="3" width="5" height="5"></rect>
                <rect x="16" y="3" width="5" height="5"></rect>
                <rect x="3" y="16" width="5" height="5"></rect>
                <path d="M21 16h-3a2 2 0 0 0-2 2v3"></path>
                <path d="M21 21v.01"></path>
                <path d="M12 7v3a2 2 0 0 1-2 2H7"></path>
                <path d="M3 12h.01"></path>
                <path d="M12 3h.01"></path>
                <path d="M12 16v.01"></path>
                <path d="M16 12h1"></path>
                <path d="M21 12v.01"></path>
                <path d="M12 21v-1"></path>
            </svg>
        );

        const Play = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const X = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Check = ({ className, strokeWidth = 2 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const Crown = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"></path>
            </svg>
        );

        const Menu = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="4" y1="12" x2="20" y2="12"></line>
                <line x1="4" y1="6" x2="20" y2="6"></line>
                <line x1="4" y1="18" x2="20" y2="18"></line>
            </svg>
        );

        const User = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const Settings = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>
        );

        const HelpCircle = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
        );

        const LogOut = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        );

        const Home = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        );

        const MessageCircle = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22z"></path>
            </svg>
        );

        const ChevronDown = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m6 9 6 6 6-6"></path>
            </svg>
        );

        // Game Icons - Simple line style
        const BrainIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/>
                <path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/>
            </svg>
        );

        const PaintBrushIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m14.622 17.897-10.68-2.913"></path>
                <path d="M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z"></path>
                <path d="M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15"></path>
            </svg>
        );

        const PencilIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
            </svg>
        );

        const CardIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                <path d="M7 15h0M2 9.5h20"></path>
            </svg>
        );

        const CalculatorIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="4" y="2" width="16" height="20" rx="2"></rect>
                <line x1="8" y1="6" x2="16" y2="6"></line>
                <line x1="16" y1="14" x2="16" y2="18"></line>
                <path d="M16 10h.01"></path>
                <path d="M12 10h.01"></path>
                <path d="M8 10h.01"></path>
                <path d="M12 14h.01"></path>
                <path d="M8 14h.01"></path>
                <path d="M12 18h.01"></path>
                <path d="M8 18h.01"></path>
            </svg>
        );

        const SmileIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                <line x1="9" y1="9" x2="9.01" y2="9"></line>
                <line x1="15" y1="9" x2="15.01" y2="9"></line>
            </svg>
        );

        const KeyboardIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect>
                <path d="M6 8h.01"></path>
                <path d="M10 8h.01"></path>
                <path d="M14 8h.01"></path>
                <path d="M18 8h.01"></path>
                <path d="M8 12h.01"></path>
                <path d="M12 12h.01"></path>
                <path d="M16 12h.01"></path>
                <path d="M7 16h10"></path>
            </svg>
        );

        const PuzzleIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M19.439 7.85c-.049.322.059.648.289.878l1.568 1.568c.47.47.706 1.087.706 1.704s-.235 1.233-.706 1.704l-1.611 1.611a.98.98 0 0 1-.837.276c-.47-.07-.802-.48-.968-.925a2.501 2.501 0 1 0-3.214 3.214c.446.166.855.497.925.968a.979.979 0 0 1-.276.837l-1.61 1.61a2.404 2.404 0 0 1-1.705.707 2.402 2.402 0 0 1-1.704-.706l-1.568-1.568a1.026 1.026 0 0 0-.877-.29c-.493.074-.84.504-1.02.968a2.5 2.5 0 1 1-3.237-3.237c.464-.18.894-.527.967-1.02a1.026 1.026 0 0 0-.289-.877l-1.568-1.568A2.402 2.402 0 0 1 1.998 12c0-.617.236-1.234.706-1.704L4.23 8.77c.24-.24.581-.353.917-.303.515.077.877.528 1.073 1.01a2.5 2.5 0 1 0 3.259-3.259c-.482-.196-.933-.558-1.01-1.073-.05-.336.062-.676.303-.917l1.525-1.525A2.402 2.402 0 0 1 12 1.998c.617 0 1.234.236 1.704.706l1.568 1.568c.23.23.556.338.877.29.493-.074.84-.504 1.02-.968a2.5 2.5 0 1 1 3.237 3.237c-.464.18-.894.527-.967 1.02Z"></path>
            </svg>
        );

        const MusicIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M9 18V5l12-2v13"></path>
                <circle cx="6" cy="18" r="3"></circle>
                <circle cx="18" cy="16" r="3"></circle>
            </svg>
        );

        const ZapIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
            </svg>
        );

        const BookIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
        );

        const GlobeIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
            </svg>
        );

        const WaveformIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M2 10v3"></path>
                <path d="M6 6v11"></path>
                <path d="M10 3v18"></path>
                <path d="M14 8v7"></path>
                <path d="M18 5v13"></path>
                <path d="M22 10v3"></path>
            </svg>
        );

        const LightbulbIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="9" y1="18" x2="15" y2="18"></line>
                <line x1="10" y1="22" x2="14" y2="22"></line>
                <path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"></path>
            </svg>
        );

        const PartyPopperIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M5.8 11.3 2 22l10.7-3.79"></path>
                <path d="M4 3h.01"></path>
                <path d="M22 8h.01"></path>
                <path d="M15 2h.01"></path>
                <path d="M22 20h.01"></path>
                <path d="m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10"></path>
                <path d="m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17"></path>
                <path d="m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7"></path>
                <path d="M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z"></path>
            </svg>
        );

        // Scary theme icons
        const WolfIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M12 4c-2.5 0-4.5 1-6 2.5L4 8l1.5 1.5C6 11 7 12 8.5 12.5"></path>
                <path d="M12 4c2.5 0 4.5 1 6 2.5L20 8l-1.5 1.5C18 11 17 12 15.5 12.5"></path>
                <circle cx="12" cy="16" r="6"></circle>
                <path d="M9 18l-1.5 2"></path>
                <path d="M15 18l1.5 2"></path>
                <circle cx="10" cy="15" r="0.5" fill="currentColor"></circle>
                <circle cx="14" cy="15" r="0.5" fill="currentColor"></circle>
                <path d="M12 17v2"></path>
            </svg>
        );

        const VampireIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M12 2C8 2 5 5 5 9v3c0 1 0 2 1 3l-2 6h16l-2-6c1-1 1-2 1-3V9c0-4-3-7-7-7Z"></path>
                <path d="M8 10h.01"></path>
                <path d="M16 10h.01"></path>
                <path d="M9 15c.5 1.5 1.5 2 3 2s2.5-.5 3-2"></path>
                <path d="M10 11v4"></path>
                <path d="M14 11v4"></path>
                <path d="M7 21l1-3"></path>
                <path d="M17 21l-1-3"></path>
            </svg>
        );

        const SkullIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="8" r="5"></circle>
                <path d="M8 12v2c0 1 1 2 2 2h4c1 0 2-1 2-2v-2"></path>
                <path d="M17 8c0 4-2.5 7-5 7s-5-3-5-7"></path>
                <circle cx="9" cy="8" r="1" fill="currentColor"></circle>
                <circle cx="15" cy="8" r="1" fill="currentColor"></circle>
                <path d="M12 15v6"></path>
                <path d="M9 18h6"></path>
            </svg>
        );

        // Werewolf Howling Icon for Scary theme
        const WerewolfHowlingIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" className={className} fill="currentColor">
                {/* Left ear */}
                <path d="M 25 25 L 20 10 L 30 20 Z" fill="currentColor"/>
                {/* Right ear */}
                <path d="M 75 25 L 80 10 L 70 20 Z" fill="currentColor"/>
                {/* Head */}
                <ellipse cx="50" cy="40" rx="25" ry="22" fill="currentColor" opacity="0.3"/>
                <circle cx="50" cy="40" r="22" fill="currentColor" opacity="0.5"/>
                {/* Eyes */}
                <circle cx="42" cy="36" r="4" fill="#ff8800"/>
                <circle cx="58" cy="36" r="4" fill="#ff8800"/>
                <circle cx="43" cy="35" r="2" fill="#fff"/>
                <circle cx="59" cy="35" r="2" fill="#fff"/>
                {/* Snout */}
                <ellipse cx="50" cy="48" rx="8" ry="10" fill="currentColor" opacity="0.6"/>
                <path d="M 50 45 L 50 52" stroke="currentColor" strokeWidth="2"/>
                <path d="M 45 54 Q 50 56 55 54" stroke="currentColor" strokeWidth="2" fill="none"/>
                {/* Fangs */}
                <path d="M 46 54 L 47 60 L 45 58" fill="#fff"/>
                <path d="M 54 54 L 53 60 L 55 58" fill="#fff"/>
                {/* Body */}
                <ellipse cx="50" cy="72" rx="20" ry="18" fill="currentColor" opacity="0.4"/>
                {/* Arms raised howling */}
                <path d="M 30 65 L 22 55 L 25 68" fill="currentColor" opacity="0.5"/>
                <path d="M 70 65 L 78 55 L 75 68" fill="currentColor" opacity="0.5"/>
                {/* Moon */}
                <circle cx="80" cy="20" r="8" fill="#ffa500" opacity="0.8"/>
            </svg>
        );

        // Character SVG Components
        const CharacterSVG = ({ characterId, size = 120, color = '#06b6d4' }) => {
            const svgStyle = { width: size, height: size };
            
            // Tron Characters
            if (characterId === 'cyber-knight') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <rect x="35" y="20" width="30" height="35" fill={color} opacity="0.3" rx="3"/>
                        <rect x="30" y="15" width="40" height="10" fill={color} rx="2"/>
                        <circle cx="42" cy="22" r="3" fill={color}/>
                        <circle cx="58" cy="22" r="3" fill={color}/>
                        <rect x="38" y="30" width="24" height="2" fill={color}/>
                        <rect x="40" y="55" width="7" height="25" fill={color} opacity="0.5"/>
                        <rect x="53" y="55" width="7" height="25" fill={color} opacity="0.5"/>
                        <rect x="25" y="35" width="10" height="20" fill={color} opacity="0.4"/>
                        <rect x="65" y="35" width="10" height="20" fill={color} opacity="0.4"/>
                        <path d="M 45 32 L 55 32 L 52 38 L 48 38 Z" fill={color}/>
                    </svg>
                );
            }
            if (characterId === 'neon-ninja') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 50 15 L 40 25 L 40 45 L 60 45 L 60 25 Z" fill={color} opacity="0.3"/>
                        <path d="M 35 20 L 50 10 L 65 20 L 60 25 L 40 25 Z" fill={color}/>
                        <rect x="43" y="28" width="4" height="8" fill={color}/>
                        <rect x="53" y="28" width="4" height="8" fill={color}/>
                        <rect x="38" y="45" width="24" height="30" fill={color} opacity="0.4" rx="2"/>
                        <rect x="38" y="75" width="9" height="15" fill={color} opacity="0.5"/>
                        <rect x="53" y="75" width="9" height="15" fill={color} opacity="0.5"/>
                        <path d="M 30 50 L 35 45 L 35 65 L 30 60 Z" fill={color} opacity="0.6"/>
                        <path d="M 70 50 L 65 45 L 65 65 L 70 60 Z" fill={color} opacity="0.6"/>
                    </svg>
                );
            }
            if (characterId === 'data-runner') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="25" r="12" fill={color} opacity="0.3"/>
                        <circle cx="46" cy="23" r="2" fill={color}/>
                        <circle cx="54" cy="23" r="2" fill={color}/>
                        <path d="M 45 28 Q 50 31 55 28" stroke={color} strokeWidth="2" fill="none"/>
                        <rect x="40" y="37" width="20" height="25" fill={color} opacity="0.4" rx="3"/>
                        <rect x="42" y="62" width="6" height="20" fill={color} opacity="0.5"/>
                        <rect x="52" y="62" width="6" height="20" fill={color} opacity="0.5"/>
                        <path d="M 32 45 L 40 40 L 40 55 L 32 50 Z" fill={color} opacity="0.5"/>
                        <path d="M 68 45 L 60 40 L 60 55 L 68 50 Z" fill={color} opacity="0.5"/>
                        <rect x="44" y="82" width="12" height="3" fill={color} rx="1"/>
                    </svg>
                );
            }
            if (characterId === 'circuit-breaker') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <rect x="35" y="18" width="30" height="30" fill={color} opacity="0.2" rx="4"/>
                        <rect x="40" y="15" width="20" height="8" fill={color} rx="2"/>
                        <circle cx="44" cy="28" r="3" fill={color}/>
                        <circle cx="56" cy="28" r="3" fill={color}/>
                        <rect x="46" y="34" width="8" height="3" fill={color}/>
                        <rect x="38" y="48" width="24" height="22" fill={color} opacity="0.4" rx="2"/>
                        <rect x="40" y="70" width="8" height="18" fill={color} opacity="0.5"/>
                        <rect x="52" y="70" width="8" height="18" fill={color} opacity="0.5"/>
                        <rect x="28" y="50" width="10" height="15" fill={color} opacity="0.5"/>
                        <rect x="62" y="50" width="10" height="15" fill={color} opacity="0.5"/>
                        <line x1="35" y1="25" x2="30" y2="25" stroke={color} strokeWidth="2"/>
                        <line x1="65" y1="25" x2="70" y2="25" stroke={color} strokeWidth="2"/>
                    </svg>
                );
            }
            if (characterId === 'byte-fighter') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <rect x="38" y="18" width="24" height="25" fill={color} opacity="0.3" rx="3"/>
                        <rect x="35" y="15" width="30" height="8" fill={color} rx="2"/>
                        <rect x="42" y="22" width="5" height="10" fill={color}/>
                        <rect x="53" y="22" width="5" height="10" fill={color}/>
                        <rect x="40" y="43" width="20" height="25" fill={color} opacity="0.4" rx="2"/>
                        <rect x="41" y="68" width="7" height="20" fill={color} opacity="0.5"/>
                        <rect x="52" y="68" width="7" height="20" fill={color} opacity="0.5"/>
                        <path d="M 25 48 L 35 43 L 35 60 L 28 58 Z" fill={color} opacity="0.6"/>
                        <path d="M 75 48 L 65 43 L 65 60 L 72 58 Z" fill={color} opacity="0.6"/>
                        <rect x="20" y="45" width="8" height="3" fill={color}/>
                        <rect x="72" y="45" width="8" height="3" fill={color}/>
                    </svg>
                );
            }
            if (characterId === 'pixel-warrior') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <rect x="40" y="20" width="20" height="20" fill={color} opacity="0.3"/>
                        <rect x="38" y="17" width="24" height="6" fill={color}/>
                        <rect x="43" y="25" width="4" height="4" fill={color}/>
                        <rect x="53" y="25" width="4" height="4" fill={color}/>
                        <rect x="45" y="32" width="10" height="2" fill={color}/>
                        <rect x="38" y="40" width="24" height="28" fill={color} opacity="0.4"/>
                        <rect x="40" y="68" width="8" height="20" fill={color} opacity="0.5"/>
                        <rect x="52" y="68" width="8" height="20" fill={color} opacity="0.5"/>
                        <rect x="30" y="45" width="8" height="18" fill={color} opacity="0.5"/>
                        <rect x="62" y="45" width="8" height="18" fill={color} opacity="0.5"/>
                    </svg>
                );
            }
            if (characterId === 'tech-ghost') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 35 30 Q 35 15 50 15 Q 65 15 65 30 L 65 75 L 60 70 L 55 75 L 50 70 L 45 75 L 40 70 L 35 75 Z" fill={color} opacity="0.3"/>
                        <circle cx="43" cy="32" r="4" fill={color}/>
                        <circle cx="57" cy="32" r="4" fill={color}/>
                        <path d="M 42 42 Q 50 46 58 42" stroke={color} strokeWidth="2" fill="none" opacity="0.6"/>
                        <rect x="36" y="50" width="28" height="3" fill={color} opacity="0.4"/>
                        <rect x="38" y="58" width="24" height="2" fill={color} opacity="0.3"/>
                        <circle cx="50" cy="28" r="2" fill={color} opacity="0.5"/>
                    </svg>
                );
            }
            if (characterId === 'cyber-samurai') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 35 18 L 50 12 L 65 18 L 63 25 L 37 25 Z" fill={color}/>
                        <rect x="38" y="25" width="24" height="20" fill={color} opacity="0.3" rx="2"/>
                        <rect x="42" y="30" width="4" height="6" fill={color}/>
                        <rect x="54" y="30" width="4" height="6" fill={color}/>
                        <path d="M 44 38 L 56 38" stroke={color} strokeWidth="2"/>
                        <rect x="40" y="45" width="20" height="25" fill={color} opacity="0.4" rx="2"/>
                        <rect x="42" y="70" width="6" height="18" fill={color} opacity="0.5"/>
                        <rect x="52" y="70" width="6" height="18" fill={color} opacity="0.5"/>
                        <path d="M 32 50 L 38 48 L 38 62 L 32 60 Z" fill={color} opacity="0.6"/>
                        <path d="M 68 50 L 62 48 L 62 62 L 68 60 Z" fill={color} opacity="0.6"/>
                        <rect x="25" y="48" width="10" height="2" fill={color}/>
                    </svg>
                );
            }
            if (characterId === 'grid-master') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <rect x="36" y="16" width="28" height="28" fill="none" stroke={color} strokeWidth="2"/>
                        <line x1="36" y1="23" x2="64" y2="23" stroke={color} strokeWidth="1"/>
                        <line x1="36" y1="30" x2="64" y2="30" stroke={color} strokeWidth="1"/>
                        <line x1="36" y1="37" x2="64" y2="37" stroke={color} strokeWidth="1"/>
                        <line x1="43" y1="16" x2="43" y2="44" stroke={color} strokeWidth="1"/>
                        <line x1="50" y1="16" x2="50" y2="44" stroke={color} strokeWidth="1"/>
                        <line x1="57" y1="16" x2="57" y2="44" stroke={color} strokeWidth="1"/>
                        <rect x="40" y="44" width="20" height="24" fill={color} opacity="0.3" rx="2"/>
                        <rect x="42" y="68" width="7" height="20" fill={color} opacity="0.5"/>
                        <rect x="51" y="68" width="7" height="20" fill={color} opacity="0.5"/>
                        <rect x="32" y="50" width="8" height="15" fill={color} opacity="0.4"/>
                        <rect x="60" y="50" width="8" height="15" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'binary-ace') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="28" r="14" fill={color} opacity="0.3"/>
                        <text x="42" y="27" fill={color} fontSize="10" fontWeight="bold">01</text>
                        <text x="42" y="35" fill={color} fontSize="10" fontWeight="bold">10</text>
                        <rect x="38" y="42" width="24" height="26" fill={color} opacity="0.4" rx="2"/>
                        <rect x="40" y="68" width="8" height="20" fill={color} opacity="0.5"/>
                        <rect x="52" y="68" width="8" height="20" fill={color} opacity="0.5"/>
                        <rect x="30" y="48" width="8" height="16" fill={color} opacity="0.5"/>
                        <rect x="62" y="48" width="8" height="16" fill={color} opacity="0.5"/>
                        <circle cx="44" cy="55" r="2" fill={color}/>
                        <circle cx="56" cy="55" r="2" fill={color}/>
                    </svg>
                );
            }
            
            // Kids Characters
            if (characterId === 'happy-unicorn') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="40" r="18" fill={color} opacity="0.3"/>
                        <path d="M 48 22 L 50 10 L 52 22" fill={color}/>
                        <circle cx="43" cy="38" r="3" fill="#000"/>
                        <circle cx="57" cy="38" r="3" fill="#000"/>
                        <path d="M 44 45 Q 50 49 56 45" stroke={color} strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="65" rx="16" ry="22" fill={color} opacity="0.4"/>
                        <ellipse cx="40" cy="80" rx="6" ry="10" fill={color} opacity="0.5"/>
                        <ellipse cx="60" cy="80" rx="6" ry="10" fill={color} opacity="0.5"/>
                        <path d="M 35 50 Q 30 55 33 60" stroke={color} strokeWidth="3" fill="none"/>
                        <path d="M 65 50 Q 70 55 67 60" stroke={color} strokeWidth="3" fill="none"/>
                        <ellipse cx="46" cy="27" rx="3" ry="5" fill={color} opacity="0.6"/>
                        <ellipse cx="54" cy="27" rx="3" ry="5" fill={color} opacity="0.6"/>
                    </svg>
                );
            }
            if (characterId === 'cool-fox') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 35 25 L 30 10 L 38 20 Z" fill={color}/>
                        <path d="M 65 25 L 70 10 L 62 20 Z" fill={color}/>
                        <circle cx="50" cy="38" r="16" fill={color} opacity="0.4"/>
                        <circle cx="43" cy="36" r="3" fill="#000"/>
                        <circle cx="57" cy="36" r="3" fill="#000"/>
                        <path d="M 50 42 L 50 47 L 46 47" stroke="#000" strokeWidth="2"/>
                        <path d="M 45 48 Q 50 51 55 48" stroke="#000" strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="65" rx="14" ry="20" fill={color} opacity="0.4"/>
                        <ellipse cx="42" cy="80" rx="5" ry="8" fill={color} opacity="0.5"/>
                        <ellipse cx="58" cy="80" rx="5" ry="8" fill={color} opacity="0.5"/>
                        <path d="M 40 55 L 35 50 L 38 58" fill={color} opacity="0.5"/>
                        <path d="M 60 55 L 65 50 L 62 58" fill={color} opacity="0.5"/>
                    </svg>
                );
            }
            if (characterId === 'brave-lion') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="38" r="20" fill={color} opacity="0.2"/>
                        <path d="M 35 25 Q 30 20 32 28 M 40 20 Q 38 15 40 23 M 45 18 Q 45 12 46 20 M 55 18 Q 55 12 54 20 M 60 20 Q 62 15 60 23 M 65 25 Q 70 20 68 28" stroke={color} strokeWidth="2" fill="none"/>
                        <circle cx="50" cy="38" r="14" fill={color} opacity="0.4"/>
                        <circle cx="44" cy="36" r="3" fill="#000"/>
                        <circle cx="56" cy="36" r="3" fill="#000"/>
                        <path d="M 50 40 L 50 44 L 47 44" stroke="#000" strokeWidth="2"/>
                        <path d="M 46 46 Q 50 49 54 46" stroke="#000" strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="65" rx="15" ry="22" fill={color} opacity="0.4"/>
                        <ellipse cx="41" cy="82" rx="6" ry="9" fill={color} opacity="0.5"/>
                        <ellipse cx="59" cy="82" rx="6" ry="9" fill={color} opacity="0.5"/>
                    </svg>
                );
            }
            if (characterId === 'smart-panda') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="38" cy="30" r="8" fill="#000"/>
                        <circle cx="62" cy="30" r="8" fill="#000"/>
                        <circle cx="50" cy="40" r="16" fill="#fff"/>
                        <ellipse cx="44" cy="38" rx="5" ry="7" fill="#000"/>
                        <ellipse cx="56" cy="38" rx="5" ry="7" fill="#000"/>
                        <circle cx="44" cy="38" r="2" fill="#fff"/>
                        <circle cx="56" cy="38" r="2" fill="#fff"/>
                        <path d="M 50 44 L 50 48 L 48 48" stroke="#000" strokeWidth="2"/>
                        <path d="M 47 49 Q 50 51 53 49" stroke="#000" strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="68" rx="14" ry="20" fill="#fff"/>
                        <ellipse cx="43" cy="83" rx="5" ry="8" fill="#000"/>
                        <ellipse cx="57" cy="83" rx="5" ry="8" fill="#000"/>
                        <ellipse cx="35" cy="60" rx="5" ry="8" fill="#000"/>
                        <ellipse cx="65" cy="60" rx="5" ry="8" fill="#000"/>
                    </svg>
                );
            }
            if (characterId === 'silly-frog') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="40" rx="18" ry="16" fill={color} opacity="0.4"/>
                        <circle cx="40" cy="35" r="8" fill="#fff"/>
                        <circle cx="60" cy="35" r="8" fill="#fff"/>
                        <circle cx="40" cy="35" r="4" fill="#000"/>
                        <circle cx="60" cy="35" r="4" fill="#000"/>
                        <path d="M 42 48 Q 50 52 58 48" stroke={color} strokeWidth="2.5" fill="none"/>
                        <ellipse cx="50" cy="68" rx="16" ry="20" fill={color} opacity="0.4"/>
                        <ellipse cx="40" cy="85" rx="8" ry="6" fill={color} opacity="0.5"/>
                        <ellipse cx="60" cy="85" rx="8" ry="6" fill={color} opacity="0.5"/>
                        <circle cx="30" cy="85" r="5" fill={color} opacity="0.6"/>
                        <circle cx="70" cy="85" r="5" fill={color} opacity="0.6"/>
                        <circle cx="25" cy="87" r="3" fill={color} opacity="0.6"/>
                        <circle cx="75" cy="87" r="3" fill={color} opacity="0.6"/>
                    </svg>
                );
            }
            if (characterId === 'speedy-rabbit') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="38" cy="18" rx="6" ry="16" fill={color} opacity="0.4"/>
                        <ellipse cx="62" cy="18" rx="6" ry="16" fill={color} opacity="0.4"/>
                        <circle cx="50" cy="42" r="16" fill={color} opacity="0.4"/>
                        <circle cx="44" cy="40" r="3" fill="#000"/>
                        <circle cx="56" cy="40" r="3" fill="#000"/>
                        <path d="M 50 46 L 50 50 L 48 50" stroke="#000" strokeWidth="2"/>
                        <path d="M 46 51 Q 50 54 54 51" stroke="#000" strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="70" rx="14" ry="18" fill={color} opacity="0.4"/>
                        <circle cx="50" cy="88" r="5" fill={color} opacity="0.5"/>
                        <ellipse cx="42" cy="85" rx="5" ry="7" fill={color} opacity="0.5"/>
                        <ellipse cx="58" cy="85" rx="5" ry="7" fill={color} opacity="0.5"/>
                    </svg>
                );
            }
            if (characterId === 'friendly-bear') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="35" cy="28" r="9" fill={color} opacity="0.4"/>
                        <circle cx="65" cy="28" r="9" fill={color} opacity="0.4"/>
                        <circle cx="50" cy="40" r="18" fill={color} opacity="0.4"/>
                        <circle cx="43" cy="38" r="3" fill="#000"/>
                        <circle cx="57" cy="38" r="3" fill="#000"/>
                        <ellipse cx="50" cy="46" rx="6" ry="5" fill={color} opacity="0.6"/>
                        <path d="M 50 48 L 50 51" stroke="#000" strokeWidth="2"/>
                        <path d="M 46 52 Q 50 55 54 52" stroke="#000" strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="70" rx="16" ry="22" fill={color} opacity="0.4"/>
                        <ellipse cx="41" cy="86" rx="6" ry="8" fill={color} opacity="0.5"/>
                        <ellipse cx="59" cy="86" rx="6" ry="8" fill={color} opacity="0.5"/>
                    </svg>
                );
            }
            if (characterId === 'magical-cat') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 35 22 L 30 10 L 38 25 Z" fill={color} opacity="0.5"/>
                        <path d="M 65 22 L 70 10 L 62 25 Z" fill={color} opacity="0.5"/>
                        <circle cx="50" cy="38" r="15" fill={color} opacity="0.4"/>
                        <circle cx="44" cy="36" r="3" fill="#000"/>
                        <circle cx="56" cy="36" r="3" fill="#000"/>
                        <path d="M 50 40 L 50 44 L 48 44" stroke="#000" strokeWidth="2"/>
                        <path d="M 46 45 Q 50 48 54 45" stroke="#000" strokeWidth="2" fill="none"/>
                        <line x1="38" y1="44" x2="28" y2="42" stroke={color} strokeWidth="1.5"/>
                        <line x1="38" y1="47" x2="28" y2="47" stroke={color} strokeWidth="1.5"/>
                        <line x1="62" y1="44" x2="72" y2="42" stroke={color} strokeWidth="1.5"/>
                        <line x1="62" y1="47" x2="72" y2="47" stroke={color} strokeWidth="1.5"/>
                        <ellipse cx="50" cy="65" rx="13" ry="20" fill={color} opacity="0.4"/>
                        <ellipse cx="43" cy="82" rx="5" ry="8" fill={color} opacity="0.5"/>
                        <ellipse cx="57" cy="82" rx="5" ry="8" fill={color} opacity="0.5"/>
                        <path d="M 55 75 Q 60 70 65 75" stroke={color} strokeWidth="2.5" fill="none"/>
                    </svg>
                );
            }
            if (characterId === 'happy-penguin') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="50" rx="20" ry="30" fill="#000"/>
                        <ellipse cx="50" cy="55" rx="14" ry="22" fill="#fff"/>
                        <circle cx="50" cy="35" r="12" fill="#000"/>
                        <circle cx="45" cy="33" r="3" fill="#fff"/>
                        <circle cx="55" cy="33" r="3" fill="#fff"/>
                        <circle cx="45" cy="33" r="1.5" fill="#000"/>
                        <circle cx="55" cy="33" r="1.5" fill="#000"/>
                        <path d="M 48 38 L 52 38 L 50 41 Z" fill={color}/>
                        <path d="M 47 43 Q 50 45 53 43" stroke="#000" strokeWidth="1.5" fill="none"/>
                        <ellipse cx="32" cy="55" rx="5" ry="12" fill="#000"/>
                        <ellipse cx="68" cy="55" rx="5" ry="12" fill="#000"/>
                        <ellipse cx="42" cy="82" rx="6" ry="4" fill={color}/>
                        <ellipse cx="58" cy="82" rx="6" ry="4" fill={color}/>
                    </svg>
                );
            }
            if (characterId === 'rainbow-koala') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="35" cy="30" r="10" fill={color} opacity="0.3"/>
                        <circle cx="65" cy="30" r="10" fill={color} opacity="0.3"/>
                        <ellipse cx="50" cy="42" rx="18" ry="16" fill={color} opacity="0.4"/>
                        <circle cx="44" cy="40" r="4" fill="#000"/>
                        <circle cx="56" cy="40" r="4" fill="#000"/>
                        <ellipse cx="50" cy="47" rx="5" ry="4" fill={color} opacity="0.6"/>
                        <path d="M 46 52 Q 50 54 54 52" stroke="#000" strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="70" rx="15" ry="22" fill={color} opacity="0.4"/>
                        <ellipse cx="42" cy="86" rx="6" ry="8" fill={color} opacity="0.5"/>
                        <ellipse cx="58" cy="86" rx="6" ry="8" fill={color} opacity="0.5"/>
                        <path d="M 33 60 Q 28 65 30 70" stroke={color} strokeWidth="3" fill="none"/>
                        <path d="M 67 60 Q 72 65 70 70" stroke={color} strokeWidth="3" fill="none"/>
                    </svg>
                );
            }
            
            // Scary Characters
            if (characterId === 'vampire-lord') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 40 22 L 35 10 L 42 20 Z" fill={color}/>
                        <path d="M 60 22 L 65 10 L 58 20 Z" fill={color}/>
                        <ellipse cx="50" cy="35" rx="16" ry="18" fill={color} opacity="0.2"/>
                        <circle cx="43" cy="32" r="4" fill="#ff0000"/>
                        <circle cx="57" cy="32" r="4" fill="#ff0000"/>
                        <path d="M 46 42 L 48 48 L 46 46" fill="#fff"/>
                        <path d="M 54 42 L 52 48 L 54 46" fill="#fff"/>
                        <path d="M 45 45 Q 50 48 55 45" stroke="#ff0000" strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="65" rx="14" ry="24" fill={color} opacity="0.3"/>
                        <path d="M 36 55 L 30 60 L 35 68 L 40 65 Z" fill={color} opacity="0.5"/>
                        <path d="M 64 55 L 70 60 L 65 68 L 60 65 Z" fill={color} opacity="0.5"/>
                        <ellipse cx="43" cy="85" rx="5" ry="7" fill={color} opacity="0.4"/>
                        <ellipse cx="57" cy="85" rx="5" ry="7" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'howling-wolf') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 38 24 L 33 12 L 40 22 Z" fill={color} opacity="0.5"/>
                        <path d="M 62 24 L 67 12 L 60 22 Z" fill={color} opacity="0.5"/>
                        <ellipse cx="50" cy="38" rx="16" ry="15" fill={color} opacity="0.3"/>
                        <circle cx="43" cy="35" r="3" fill="#ffaa00"/>
                        <circle cx="57" cy="35" r="3" fill="#ffaa00"/>
                        <path d="M 50 40 L 50 48" stroke={color} strokeWidth="2"/>
                        <path d="M 45 50 L 50 48 L 55 50" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 44 50 Q 48 53 52 50" stroke="#fff" strokeWidth="1.5" fill="none"/>
                        <ellipse cx="50" cy="68" rx="14" ry="22" fill={color} opacity="0.3"/>
                        <ellipse cx="42" cy="84" rx="6" ry="10" fill={color} opacity="0.4"/>
                        <ellipse cx="58" cy="84" rx="6" ry="10" fill={color} opacity="0.4"/>
                        <path d="M 36 58 L 32 60 L 35 66" fill={color} opacity="0.4"/>
                        <path d="M 64 58 L 68 60 L 65 66" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'ghost-haunter') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 35 30 Q 35 15 50 15 Q 65 15 65 30 L 65 78 L 60 72 L 55 78 L 50 72 L 45 78 L 40 72 L 35 78 Z" fill={color} opacity="0.3"/>
                        <circle cx="42" cy="32" r="5" fill="#000"/>
                        <circle cx="58" cy="32" r="5" fill="#000"/>
                        <circle cx="42" cy="32" r="2" fill="#fff"/>
                        <circle cx="58" cy="32" r="2" fill="#fff"/>
                        <ellipse cx="50" cy="42" rx="6" ry="8" fill="#000" opacity="0.5"/>
                        <path d="M 44 52 Q 50 48 56 52" stroke={color} strokeWidth="2" fill="none" opacity="0.6"/>
                        <circle cx="38" cy="55" r="3" fill={color} opacity="0.4"/>
                        <circle cx="62" cy="55" r="3" fill={color} opacity="0.4"/>
                        <circle cx="45" cy="62" r="2" fill={color} opacity="0.3"/>
                        <circle cx="55" cy="62" r="2" fill={color} opacity="0.3"/>
                    </svg>
                );
            }
            if (characterId === 'zombie-king') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 38 18 L 35 12 L 40 16 L 42 10 L 44 16 L 48 12 L 50 18 L 52 12 L 56 16 L 58 10 L 60 16 L 65 12 L 62 18 Z" fill="#ffd700"/>
                        <ellipse cx="50" cy="38" rx="18" ry="17" fill={color} opacity="0.2"/>
                        <rect x="41" y="33" width="5" height="7" fill="#000" opacity="0.7"/>
                        <rect x="54" y="33" width="5" height="7" fill="#000" opacity="0.7"/>
                        <path d="M 43 46 L 57 46" stroke="#000" strokeWidth="2.5"/>
                        <rect x="46" y="42" width="8" height="2" fill="#000"/>
                        <ellipse cx="50" cy="68" rx="15" ry="24" fill={color} opacity="0.3"/>
                        <ellipse cx="42" cy="86" rx="6" ry="8" fill={color} opacity="0.4"/>
                        <ellipse cx="58" cy="86" rx="6" ry="8" fill={color} opacity="0.4"/>
                        <path d="M 34 58 L 30 62 L 34 68" fill={color} opacity="0.4"/>
                        <path d="M 66 58 L 70 62 L 66 68" fill={color} opacity="0.4"/>
                        <rect x="36" y="50" width="3" height="8" fill={color} opacity="0.3" transform="rotate(15 37.5 54)"/>
                        <rect x="61" y="50" width="3" height="8" fill={color} opacity="0.3" transform="rotate(-15 62.5 54)"/>
                    </svg>
                );
            }
            if (characterId === 'witch-mage') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 35 25 L 50 8 L 65 25 L 62 28 L 38 28 Z" fill={color} opacity="0.6"/>
                        <circle cx="50" cy="28" r="3" fill="#ffd700"/>
                        <ellipse cx="50" cy="40" rx="16" ry="15" fill={color} opacity="0.3"/>
                        <circle cx="44" cy="38" r="3" fill={color}/>
                        <circle cx="56" cy="38" r="3" fill={color}/>
                        <path d="M 46 46 Q 50 48 54 46" stroke={color} strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="68" rx="14" ry="24" fill={color} opacity="0.3"/>
                        <path d="M 36 56 L 28 60 L 32 68 L 38 65 Z" fill={color} opacity="0.5"/>
                        <path d="M 64 56 L 72 60 L 68 68 L 62 65 Z" fill={color} opacity="0.5"/>
                        <ellipse cx="43" cy="86" rx="5" ry="7" fill={color} opacity="0.4"/>
                        <ellipse cx="57" cy="86" rx="5" ry="7" fill={color} opacity="0.4"/>
                        <line x1="30" y1="50" x2="25" y2="55" stroke={color} strokeWidth="2"/>
                        <circle cx="24" cy="56" r="2" fill="#ffd700"/>
                    </svg>
                );
            }
            if (characterId === 'skeleton-warrior') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="30" r="15" fill="none" stroke={color} strokeWidth="2"/>
                        <circle cx="43" cy="28" r="4" fill={color}/>
                        <circle cx="57" cy="28" r="4" fill={color}/>
                        <path d="M 44 36 L 48 38 L 52 38 L 56 36" stroke={color} strokeWidth="2" fill="none"/>
                        <rect x="40" y="45" width="20" height="20" fill="none" stroke={color} strokeWidth="2" rx="2"/>
                        <line x1="45" y1="50" x2="45" y2="60" stroke={color} strokeWidth="2"/>
                        <line x1="50" y1="50" x2="50" y2="60" stroke={color} strokeWidth="2"/>
                        <line x1="55" y1="50" x2="55" y2="60" stroke={color} strokeWidth="2"/>
                        <rect x="42" y="65" width="6" height="22" fill="none" stroke={color} strokeWidth="2"/>
                        <rect x="52" y="65" width="6" height="22" fill="none" stroke={color} strokeWidth="2"/>
                        <line x1="32" y1="48" x2="40" y2="52" stroke={color} strokeWidth="2"/>
                        <line x1="68" y1="48" x2="60" y2="52" stroke={color} strokeWidth="2"/>
                        <line x1="40" y1="52" x2="32" y2="58" stroke={color} strokeWidth="2"/>
                        <line x1="60" y1="52" x2="68" y2="58" stroke={color} strokeWidth="2"/>
                    </svg>
                );
            }
            if (characterId === 'demon-hunter') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 38 20 L 32 8 L 38 18 L 42 14 L 44 20" fill={color}/>
                        <path d="M 62 20 L 68 8 L 62 18 L 58 14 L 56 20" fill={color}/>
                        <ellipse cx="50" cy="36" rx="17" ry="16" fill={color} opacity="0.2"/>
                        <path d="M 41 32 L 45 35 L 41 38" fill="#ff0000"/>
                        <path d="M 59 32 L 55 35 L 59 38" fill="#ff0000"/>
                        <path d="M 44 44 Q 50 48 56 44" stroke="#ff0000" strokeWidth="2.5" fill="none"/>
                        <path d="M 47 45 L 49 50 L 47 48" fill="#fff"/>
                        <path d="M 53 45 L 51 50 L 53 48" fill="#fff"/>
                        <ellipse cx="50" cy="66" rx="14" ry="24" fill={color} opacity="0.3"/>
                        <path d="M 36 54 L 28 58 L 32 66 L 38 63 Z" fill={color} opacity="0.5"/>
                        <path d="M 64 54 L 72 58 L 68 66 L 62 63 Z" fill={color} opacity="0.5"/>
                        <ellipse cx="42" cy="85" rx="5" ry="8" fill={color} opacity="0.4"/>
                        <ellipse cx="58" cy="85" rx="5" ry="8" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'dark-wizard') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 36 26 L 50 10 L 64 26 L 60 30 L 40 30 Z" fill={color} opacity="0.7"/>
                        <circle cx="48" cy="18" r="2" fill="#9333ea"/>
                        <circle cx="52" cy="18" r="2" fill="#9333ea"/>
                        <circle cx="50" cy="22" r="2" fill="#9333ea"/>
                        <ellipse cx="50" cy="42" rx="16" ry="16" fill={color} opacity="0.3"/>
                        <path d="M 42 40 L 48 42 L 42 44" fill={color}/>
                        <path d="M 58 40 L 52 42 L 58 44" fill={color}/>
                        <path d="M 46 48 Q 50 50 54 48" stroke={color} strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="70" rx="15" ry="26" fill={color} opacity="0.3"/>
                        <path d="M 35 58 L 26 64 L 30 74 L 38 70 Z" fill={color} opacity="0.5"/>
                        <path d="M 65 58 L 74 64 L 70 74 L 62 70 Z" fill={color} opacity="0.5"/>
                        <ellipse cx="43" cy="88" rx="5" ry="6" fill={color} opacity="0.4"/>
                        <ellipse cx="57" cy="88" rx="5" ry="6" fill={color} opacity="0.4"/>
                        <path d="M 24 58 L 20 52 L 22 58" stroke="#9333ea" strokeWidth="2"/>
                        <circle cx="20" cy="50" r="3" fill="#9333ea" opacity="0.6"/>
                    </svg>
                );
            }
            if (characterId === 'shadow-reaper') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 40 22 L 35 10 L 42 20 Z" fill="#000" opacity="0.8"/>
                        <path d="M 60 22 L 65 10 L 58 20 Z" fill="#000" opacity="0.8"/>
                        <ellipse cx="50" cy="36" rx="18" ry="17" fill="#000" opacity="0.7"/>
                        <circle cx="43" cy="33" r="5" fill={color}/>
                        <circle cx="57" cy="33" r="5" fill={color}/>
                        <circle cx="43" cy="33" r="2" fill="#000"/>
                        <circle cx="57" cy="33" r="2" fill="#000"/>
                        <path d="M 46 44 Q 50 46 54 44" stroke={color} strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="68" rx="16" ry="26" fill="#000" opacity="0.6"/>
                        <path d="M 34 56 Q 26 62 28 72 L 36 68 Z" fill="#000" opacity="0.7"/>
                        <path d="M 66 56 Q 74 62 72 72 L 64 68 Z" fill="#000" opacity="0.7"/>
                        <path d="M 32 72 Q 28 78 30 86" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 68 72 Q 72 78 70 86" stroke={color} strokeWidth="2" fill="none"/>
                        <ellipse cx="43" cy="88" rx="6" ry="5" fill="#000" opacity="0.6"/>
                        <ellipse cx="57" cy="88" rx="6" ry="5" fill="#000" opacity="0.6"/>
                    </svg>
                );
            }
            if (characterId === 'cursed-mummy') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="34" rx="16" ry="18" fill={color} opacity="0.3"/>
                        <rect x="38" y="28" width="24" height="4" fill={color} opacity="0.5"/>
                        <rect x="40" y="34" width="20" height="3" fill={color} opacity="0.5"/>
                        <rect x="38" y="38" width="24" height="4" fill={color} opacity="0.5"/>
                        <circle cx="43" cy="32" r="3" fill="#000"/>
                        <circle cx="57" cy="32" r="3" fill="#000"/>
                        <path d="M 46 42 L 54 42" stroke={color} strokeWidth="2"/>
                        <ellipse cx="50" cy="66" rx="15" ry="24" fill={color} opacity="0.3"/>
                        <rect x="36" y="54" width="28" height="3" fill={color} opacity="0.5"/>
                        <rect x="38" y="60" width="24" height="3" fill={color} opacity="0.5"/>
                        <rect x="36" y="66" width="28" height="3" fill={color} opacity="0.5"/>
                        <rect x="38" y="72" width="24" height="3" fill={color} opacity="0.5"/>
                        <ellipse cx="42" cy="85" rx="6" ry="8" fill={color} opacity="0.4"/>
                        <ellipse cx="58" cy="85" rx="6" ry="8" fill={color} opacity="0.4"/>
                        <path d="M 34 58 L 30 62 L 34 68" fill={color} opacity="0.4"/>
                        <path d="M 66 58 L 70 62 L 66 68" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            
            // --- New Tron Characters ---
            if (characterId === 'volt-striker') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <polygon points="50,10 42,30 48,30 40,55 52,35 46,35 54,10" fill={color}/>
                        <rect x="35" y="55" width="30" height="25" fill={color} opacity="0.3" rx="3"/>
                        <circle cx="43" cy="64" r="3" fill={color}/><circle cx="57" cy="64" r="3" fill={color}/>
                        <rect x="40" y="80" width="8" height="15" fill={color} opacity="0.5"/>
                        <rect x="52" y="80" width="8" height="15" fill={color} opacity="0.5"/>
                    </svg>
                );
            }
            if (characterId === 'quantum-thief') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="35" r="18" fill={color} opacity="0.2"/>
                        <ellipse cx="50" cy="35" rx="18" ry="12" fill="none" stroke={color} strokeWidth="1.5" strokeDasharray="4 3"/>
                        <ellipse cx="50" cy="35" rx="12" ry="18" fill="none" stroke={color} strokeWidth="1.5" strokeDasharray="4 3"/>
                        <circle cx="44" cy="32" r="3" fill={color}/><circle cx="56" cy="32" r="3" fill={color}/>
                        <path d="M 44 40 Q 50 46 56 40" stroke={color} strokeWidth="2" fill="none"/>
                        <rect x="38" y="55" width="24" height="28" fill={color} opacity="0.3" rx="4"/>
                        <rect x="42" y="83" width="6" height="12" fill={color} opacity="0.4"/>
                        <rect x="52" y="83" width="6" height="12" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'plasma-drone') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="45" rx="25" ry="15" fill={color} opacity="0.3"/>
                        <ellipse cx="50" cy="45" rx="25" ry="15" fill="none" stroke={color} strokeWidth="2"/>
                        <circle cx="42" cy="42" r="4" fill={color}/><circle cx="58" cy="42" r="4" fill={color}/>
                        <rect x="46" y="48" width="8" height="2" fill={color}/>
                        <line x1="25" y1="45" x2="15" y2="35" stroke={color} strokeWidth="2"/>
                        <line x1="75" y1="45" x2="85" y2="35" stroke={color} strokeWidth="2"/>
                        <circle cx="15" cy="35" r="5" fill={color} opacity="0.5"/>
                        <circle cx="85" cy="35" r="5" fill={color} opacity="0.5"/>
                        <ellipse cx="50" cy="70" rx="8" ry="12" fill={color} opacity="0.2"/>
                    </svg>
                );
            }
            if (characterId === 'hex-coder') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <rect x="32" y="18" width="36" height="28" fill={color} opacity="0.2" rx="4"/>
                        <rect x="32" y="18" width="36" height="28" fill="none" stroke={color} strokeWidth="2" rx="4"/>
                        <text x="50" y="37" textAnchor="middle" fill={color} fontSize="10" fontFamily="monospace">0x</text>
                        <circle cx="43" cy="28" r="3" fill={color}/><circle cx="57" cy="28" r="3" fill={color}/>
                        <rect x="36" y="50" width="28" height="30" fill={color} opacity="0.3" rx="3"/>
                        <rect x="40" y="80" width="8" height="14" fill={color} opacity="0.4"/>
                        <rect x="52" y="80" width="8" height="14" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'ion-scout') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="30" r="15" fill={color} opacity="0.25"/>
                        <path d="M 50 15 L 54 22 L 50 20 L 46 22 Z" fill={color}/>
                        <circle cx="44" cy="30" r="3" fill={color}/><circle cx="56" cy="30" r="3" fill={color}/>
                        <rect x="38" y="48" width="24" height="30" fill={color} opacity="0.3" rx="4"/>
                        <line x1="62" y1="55" x2="78" y2="45" stroke={color} strokeWidth="2"/>
                        <circle cx="80" cy="43" r="4" fill="none" stroke={color} strokeWidth="1.5"/>
                        <rect x="42" y="78" width="6" height="14" fill={color} opacity="0.4"/>
                        <rect x="52" y="78" width="6" height="14" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'wire-wraith') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 35 25 Q 50 10 65 25 L 62 50 L 38 50 Z" fill={color} opacity="0.25"/>
                        <circle cx="44" cy="32" r="3" fill={color}/><circle cx="56" cy="32" r="3" fill={color}/>
                        <path d="M 44 40 L 56 40" stroke={color} strokeWidth="1.5"/>
                        <path d="M 38 50 Q 30 65 35 85" stroke={color} strokeWidth="2" fill="none" strokeDasharray="4 3"/>
                        <path d="M 62 50 Q 70 65 65 85" stroke={color} strokeWidth="2" fill="none" strokeDasharray="4 3"/>
                        <path d="M 46 50 Q 44 70 46 90" stroke={color} strokeWidth="2" fill="none" strokeDasharray="4 3"/>
                        <path d="M 54 50 Q 56 70 54 90" stroke={color} strokeWidth="2" fill="none" strokeDasharray="4 3"/>
                    </svg>
                );
            }
            if (characterId === 'signal-flare') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="30" r="14" fill={color} opacity="0.3"/>
                        <circle cx="50" cy="20" r="5" fill={color} opacity="0.6"/>
                        <circle cx="50" cy="20" r="8" fill="none" stroke={color} strokeWidth="1" opacity="0.4"/>
                        <circle cx="50" cy="20" r="12" fill="none" stroke={color} strokeWidth="1" opacity="0.2"/>
                        <circle cx="44" cy="32" r="3" fill={color}/><circle cx="56" cy="32" r="3" fill={color}/>
                        <rect x="38" y="48" width="24" height="30" fill={color} opacity="0.3" rx="3"/>
                        <rect x="42" y="78" width="6" height="14" fill={color} opacity="0.4"/>
                        <rect x="52" y="78" width="6" height="14" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'core-sentinel') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <rect x="32" y="18" width="36" height="30" fill={color} opacity="0.25" rx="5"/>
                        <rect x="32" y="18" width="36" height="30" fill="none" stroke={color} strokeWidth="2.5" rx="5"/>
                        <circle cx="44" cy="30" r="4" fill={color}/><circle cx="56" cy="30" r="4" fill={color}/>
                        <rect x="42" y="38" width="16" height="3" fill={color} rx="1"/>
                        <rect x="35" y="52" width="30" height="32" fill={color} opacity="0.3" rx="4"/>
                        <path d="M 28 58 L 35 62 L 35 72 L 28 68 Z" fill={color} opacity="0.4"/>
                        <path d="M 72 58 L 65 62 L 65 72 L 72 68 Z" fill={color} opacity="0.4"/>
                        <rect x="41" y="84" width="8" height="12" fill={color} opacity="0.5"/>
                        <rect x="51" y="84" width="8" height="12" fill={color} opacity="0.5"/>
                    </svg>
                );
            }
            if (characterId === 'glitch-fox') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 35 30 L 30 12 L 40 25 Z" fill={color}/>
                        <path d="M 65 30 L 70 12 L 60 25 Z" fill={color}/>
                        <ellipse cx="50" cy="38" rx="18" ry="14" fill={color} opacity="0.3"/>
                        <circle cx="43" cy="35" r="3" fill={color}/><circle cx="57" cy="35" r="3" fill={color}/>
                        <path d="M 46 42 L 50 45 L 54 42" stroke={color} strokeWidth="2" fill="none"/>
                        <rect x="40" y="54" width="20" height="24" fill={color} opacity="0.3" rx="3"/>
                        <rect x="38" y="60" width="24" height="3" fill={color} opacity="0.15"/>
                        <rect x="38" y="68" width="24" height="3" fill={color} opacity="0.15"/>
                        <path d="M 60 60 Q 75 55 80 65 Q 75 62 60 66" fill={color} opacity="0.4"/>
                        <rect x="43" y="78" width="6" height="14" fill={color} opacity="0.4"/>
                        <rect x="51" y="78" width="6" height="14" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'null-agent') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <rect x="34" y="18" width="32" height="22" fill={color} opacity="0.15" rx="3"/>
                        <rect x="36" y="22" width="28" height="8" fill={color} opacity="0.4" rx="2"/>
                        <rect x="36" y="22" width="28" height="8" fill="none" stroke={color} strokeWidth="1.5" rx="2"/>
                        <path d="M 44 40 L 56 40" stroke={color} strokeWidth="1.5"/>
                        <rect x="36" y="44" width="28" height="35" fill={color} opacity="0.2" rx="4"/>
                        <line x1="50" y1="50" x2="50" y2="72" stroke={color} strokeWidth="1.5"/>
                        <line x1="42" y1="61" x2="58" y2="61" stroke={color} strokeWidth="1.5"/>
                        <rect x="40" y="79" width="8" height="14" fill={color} opacity="0.4"/>
                        <rect x="52" y="79" width="8" height="14" fill={color} opacity="0.4"/>
                    </svg>
                );
            }

            // --- New Kids Characters ---
            if (characterId === 'buzzy-bee') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="50" rx="22" ry="20" fill={color} opacity="0.4"/>
                        <rect x="30" y="42" width="40" height="6" fill="#333" opacity="0.3"/>
                        <rect x="30" y="54" width="40" height="6" fill="#333" opacity="0.3"/>
                        <circle cx="42" cy="40" r="4" fill="#333"/><circle cx="58" cy="40" r="4" fill="#333"/>
                        <path d="M 44 62 Q 50 67 56 62" stroke="#333" strokeWidth="2" fill="none"/>
                        <path d="M 35 32 Q 28 18 38 15" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 65 32 Q 72 18 62 15" stroke={color} strokeWidth="2" fill="none"/>
                        <circle cx="38" cy="14" r="3" fill={color}/><circle cx="62" cy="14" r="3" fill={color}/>
                        <ellipse cx="30" cy="40" rx="12" ry="8" fill={color} opacity="0.2" transform="rotate(-20 30 40)"/>
                        <ellipse cx="70" cy="40" rx="12" ry="8" fill={color} opacity="0.2" transform="rotate(20 70 40)"/>
                    </svg>
                );
            }
            if (characterId === 'tiny-turtle') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="55" rx="28" ry="22" fill={color} opacity="0.4"/>
                        <ellipse cx="50" cy="55" rx="28" ry="22" fill="none" stroke={color} strokeWidth="2"/>
                        <path d="M 35 45 L 50 38 L 65 45" stroke={color} strokeWidth="1.5" fill="none"/>
                        <circle cx="50" cy="32" r="12" fill={color} opacity="0.5"/>
                        <circle cx="46" cy="30" r="3" fill="#333"/><circle cx="54" cy="30" r="3" fill="#333"/>
                        <path d="M 46 36 Q 50 39 54 36" stroke="#333" strokeWidth="1.5" fill="none"/>
                        <ellipse cx="25" cy="60" rx="8" ry="5" fill={color} opacity="0.5"/>
                        <ellipse cx="75" cy="60" rx="8" ry="5" fill={color} opacity="0.5"/>
                        <ellipse cx="38" cy="78" rx="6" ry="5" fill={color} opacity="0.5"/>
                        <ellipse cx="62" cy="78" rx="6" ry="5" fill={color} opacity="0.5"/>
                    </svg>
                );
            }
            if (characterId === 'dotty-ladybug') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="55" rx="26" ry="24" fill={color} opacity="0.5"/>
                        <line x1="50" y1="31" x2="50" y2="79" stroke="#333" strokeWidth="2"/>
                        <circle cx="38" cy="48" r="5" fill="#333" opacity="0.6"/>
                        <circle cx="60" cy="52" r="4" fill="#333" opacity="0.6"/>
                        <circle cx="42" cy="65" r="4" fill="#333" opacity="0.6"/>
                        <circle cx="58" cy="68" r="5" fill="#333" opacity="0.6"/>
                        <circle cx="50" cy="26" r="10" fill="#333" opacity="0.7"/>
                        <circle cx="46" cy="24" r="2.5" fill={color}/><circle cx="54" cy="24" r="2.5" fill={color}/>
                        <path d="M 42 18 Q 38 8 42 5" stroke="#333" strokeWidth="2" fill="none"/>
                        <path d="M 58 18 Q 62 8 58 5" stroke="#333" strokeWidth="2" fill="none"/>
                    </svg>
                );
            }
            if (characterId === 'fluffy-sheep') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="38" cy="38" r="12" fill={color} opacity="0.5"/>
                        <circle cx="62" cy="38" r="12" fill={color} opacity="0.5"/>
                        <circle cx="50" cy="30" r="14" fill={color} opacity="0.5"/>
                        <circle cx="35" cy="52" r="12" fill={color} opacity="0.5"/>
                        <circle cx="65" cy="52" r="12" fill={color} opacity="0.5"/>
                        <circle cx="50" cy="58" r="14" fill={color} opacity="0.5"/>
                        <circle cx="50" cy="42" r="10" fill={color} opacity="0.7"/>
                        <circle cx="46" cy="40" r="2.5" fill="#333"/><circle cx="54" cy="40" r="2.5" fill="#333"/>
                        <path d="M 46 47 Q 50 50 54 47" stroke="#333" strokeWidth="1.5" fill="none"/>
                        <rect x="40" y="70" width="5" height="12" fill="#333" opacity="0.5" rx="2"/>
                        <rect x="55" y="70" width="5" height="12" fill="#333" opacity="0.5" rx="2"/>
                    </svg>
                );
            }
            if (characterId === 'jolly-dolphin') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 25 50 Q 30 25 50 30 Q 70 25 75 50 Q 70 70 50 75 Q 30 70 25 50 Z" fill={color} opacity="0.4"/>
                        <circle cx="40" cy="42" r="3" fill="#333"/><circle cx="55" cy="42" r="3" fill="#333"/>
                        <path d="M 42 52 Q 48 57 54 52" stroke="#333" strokeWidth="2" fill="none"/>
                        <path d="M 70 38 Q 85 30 82 45" fill={color} opacity="0.5"/>
                        <path d="M 50 22 Q 50 12 58 15" fill={color} opacity="0.5"/>
                        <path d="M 42 75 Q 50 85 58 75" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'cheeky-monkey') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="42" r="22" fill={color} opacity="0.4"/>
                        <circle cx="28" cy="38" r="10" fill={color} opacity="0.5"/>
                        <circle cx="28" cy="38" r="6" fill={color} opacity="0.3"/>
                        <circle cx="72" cy="38" r="10" fill={color} opacity="0.5"/>
                        <circle cx="72" cy="38" r="6" fill={color} opacity="0.3"/>
                        <ellipse cx="50" cy="48" rx="14" ry="10" fill={color} opacity="0.3"/>
                        <circle cx="42" cy="38" r="3" fill="#333"/><circle cx="58" cy="38" r="3" fill="#333"/>
                        <path d="M 44 50 Q 50 55 56 50" stroke="#333" strokeWidth="2" fill="none"/>
                        <path d="M 42 70 Q 50 82 58 70" stroke={color} strokeWidth="3" fill="none"/>
                    </svg>
                );
            }
            if (characterId === 'snowy-owl') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="50" rx="24" ry="28" fill={color} opacity="0.3"/>
                        <circle cx="40" cy="40" r="10" fill={color} opacity="0.4"/>
                        <circle cx="60" cy="40" r="10" fill={color} opacity="0.4"/>
                        <circle cx="40" cy="40" r="5" fill="#333"/><circle cx="60" cy="40" r="5" fill="#333"/>
                        <circle cx="40" cy="39" r="2" fill={color}/><circle cx="60" cy="39" r="2" fill={color}/>
                        <polygon points="50,48 47,52 53,52" fill="#f59e0b"/>
                        <path d="M 35 22 L 40 30" stroke={color} strokeWidth="2"/>
                        <path d="M 65 22 L 60 30" stroke={color} strokeWidth="2"/>
                        <path d="M 30 55 L 20 65 L 32 60" fill={color} opacity="0.4"/>
                        <path d="M 70 55 L 80 65 L 68 60" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'lucky-clover') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="40" cy="30" r="14" fill={color} opacity="0.5"/>
                        <circle cx="60" cy="30" r="14" fill={color} opacity="0.5"/>
                        <circle cx="40" cy="50" r="14" fill={color} opacity="0.5"/>
                        <circle cx="60" cy="50" r="14" fill={color} opacity="0.5"/>
                        <circle cx="46" cy="36" r="2.5" fill="#333"/><circle cx="54" cy="36" r="2.5" fill="#333"/>
                        <path d="M 46 42 Q 50 46 54 42" stroke="#333" strokeWidth="1.5" fill="none"/>
                        <rect x="48" y="60" width="4" height="25" fill={color} opacity="0.6" rx="2"/>
                    </svg>
                );
            }
            if (characterId === 'starry-fish') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="50" rx="20" ry="16" fill={color} opacity="0.4"/>
                        <path d="M 30 50 L 15 42 L 22 55 Z" fill={color} opacity="0.5"/>
                        <path d="M 70 50 L 85 42 L 78 55 Z" fill={color} opacity="0.5"/>
                        <path d="M 50 34 L 45 18 L 55 18 Z" fill={color} opacity="0.5"/>
                        <path d="M 38 66 L 28 78 L 40 72 Z" fill={color} opacity="0.5"/>
                        <path d="M 62 66 L 72 78 L 60 72 Z" fill={color} opacity="0.5"/>
                        <circle cx="44" cy="46" r="3" fill="#333"/><circle cx="56" cy="46" r="3" fill="#333"/>
                        <path d="M 45 55 Q 50 59 55 55" stroke="#333" strokeWidth="1.5" fill="none"/>
                    </svg>
                );
            }
            if (characterId === 'candy-dragon') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="40" rx="20" ry="18" fill={color} opacity="0.4"/>
                        <path d="M 35 25 L 30 12 L 38 22 Z" fill={color} opacity="0.6"/>
                        <path d="M 65 25 L 70 12 L 62 22 Z" fill={color} opacity="0.6"/>
                        <circle cx="43" cy="36" r="4" fill="#333"/><circle cx="57" cy="36" r="4" fill="#333"/>
                        <circle cx="44" cy="35" r="1.5" fill={color}/><circle cx="58" cy="35" r="1.5" fill={color}/>
                        <path d="M 44 48 Q 50 52 56 48" stroke="#333" strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="65" rx="16" ry="18" fill={color} opacity="0.3"/>
                        <path d="M 30 42 L 18 48 L 20 42 L 12 44" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 70 42 L 82 48 L 80 42 L 88 44" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 42 82 Q 50 95 58 82" fill={color} opacity="0.4"/>
                    </svg>
                );
            }

            // --- New Scary Characters ---
            if (characterId === 'bone-crawler') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="28" r="14" fill={color} opacity="0.3"/>
                        <circle cx="44" cy="26" r="4" fill="#000"/><circle cx="56" cy="26" r="4" fill="#000"/>
                        <path d="M 42 35 L 58 35" stroke={color} strokeWidth="2"/>
                        <rect x="46" y="42" width="8" height="20" fill={color} opacity="0.4"/>
                        <rect x="38" y="48" width="24" height="3" fill={color} opacity="0.5"/>
                        <rect x="40" y="54" width="20" height="3" fill={color} opacity="0.5"/>
                        <path d="M 46 62 L 35 80 L 42 78" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 54 62 L 65 80 L 58 78" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 38 48 L 25 55 L 30 48" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 62 48 L 75 55 L 70 48" stroke={color} strokeWidth="2" fill="none"/>
                    </svg>
                );
            }
            if (characterId === 'plague-doctor') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="30" r="16" fill={color} opacity="0.3"/>
                        <ellipse cx="50" cy="15" rx="18" ry="8" fill={color} opacity="0.4"/>
                        <circle cx="43" cy="28" r="5" fill="#000" opacity="0.8"/>
                        <circle cx="57" cy="28" r="5" fill="#000" opacity="0.8"/>
                        <circle cx="43" cy="28" r="2" fill={color}/><circle cx="57" cy="28" r="2" fill={color}/>
                        <path d="M 50 34 L 50 44 L 46 42" stroke={color} strokeWidth="2" fill="none"/>
                        <rect x="36" y="48" width="28" height="35" fill={color} opacity="0.3" rx="3"/>
                        <rect x="40" y="83" width="8" height="12" fill={color} opacity="0.4"/>
                        <rect x="52" y="83" width="8" height="12" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'blood-raven') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="45" rx="18" ry="22" fill={color} opacity="0.4"/>
                        <circle cx="50" cy="28" r="12" fill={color} opacity="0.5"/>
                        <circle cx="45" cy="26" r="3" fill="#000"/><circle cx="55" cy="26" r="3" fill="#000"/>
                        <polygon points="50,32 46,38 54,38" fill="#fbbf24"/>
                        <path d="M 32 40 L 10 30 L 15 45 L 5 50 L 20 50 L 30 50" fill={color} opacity="0.5"/>
                        <path d="M 68 40 L 90 30 L 85 45 L 95 50 L 80 50 L 70 50" fill={color} opacity="0.5"/>
                        <path d="M 44 67 Q 50 75 56 67" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'swamp-fiend') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="50" rx="25" ry="30" fill={color} opacity="0.3"/>
                        <circle cx="42" cy="35" r="6" fill="#000" opacity="0.7"/>
                        <circle cx="58" cy="35" r="6" fill="#000" opacity="0.7"/>
                        <circle cx="42" cy="35" r="3" fill={color}/><circle cx="58" cy="35" r="3" fill={color}/>
                        <path d="M 40 55 Q 50 62 60 55" stroke={color} strokeWidth="3" fill="none"/>
                        <circle cx="32" cy="50" r="4" fill={color} opacity="0.3"/>
                        <circle cx="70" cy="45" r="3" fill={color} opacity="0.3"/>
                        <circle cx="28" cy="60" r="3" fill={color} opacity="0.2"/>
                        <path d="M 38 80 Q 42 90 46 80" fill={color} opacity="0.4"/>
                        <path d="M 54 80 Q 58 90 62 80" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'night-stalker') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 30 20 Q 50 10 70 20 L 68 50 L 32 50 Z" fill={color} opacity="0.3"/>
                        <rect x="34" y="50" width="32" height="35" fill={color} opacity="0.2" rx="3"/>
                        <circle cx="43" cy="35" r="3" fill={color} opacity="0.8"/>
                        <circle cx="57" cy="35" r="3" fill={color} opacity="0.8"/>
                        <path d="M 44 44 L 56 44" stroke={color} strokeWidth="1.5" opacity="0.6"/>
                        <rect x="40" y="85" width="8" height="10" fill={color} opacity="0.3"/>
                        <rect x="52" y="85" width="8" height="10" fill={color} opacity="0.3"/>
                    </svg>
                );
            }
            if (characterId === 'venom-spider') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="40" rx="16" ry="14" fill={color} opacity="0.4"/>
                        <circle cx="44" cy="36" r="4" fill="#000"/><circle cx="56" cy="36" r="4" fill="#000"/>
                        <circle cx="44" cy="36" r="2" fill={color}/><circle cx="56" cy="36" r="2" fill={color}/>
                        <path d="M 46 46 L 50 50 L 54 46" stroke={color} strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="60" rx="14" ry="10" fill={color} opacity="0.3"/>
                        <path d="M 34 38 Q 18 28 12 38" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 34 44 Q 15 44 10 52" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 34 50 Q 18 56 14 65" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 66 38 Q 82 28 88 38" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 66 44 Q 85 44 90 52" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 66 50 Q 82 56 86 65" stroke={color} strokeWidth="2" fill="none"/>
                    </svg>
                );
            }
            if (characterId === 'tomb-keeper') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <rect x="32" y="18" width="36" height="28" fill={color} opacity="0.3" rx="3"/>
                        <path d="M 32 18 Q 50 8 68 18" fill={color} opacity="0.4"/>
                        <circle cx="44" cy="30" r="3" fill="#000"/><circle cx="56" cy="30" r="3" fill="#000"/>
                        <path d="M 44 38 L 56 38" stroke={color} strokeWidth="2"/>
                        <rect x="36" y="50" width="28" height="30" fill={color} opacity="0.3" rx="2"/>
                        <line x1="50" y1="52" x2="50" y2="75" stroke={color} strokeWidth="2" opacity="0.5"/>
                        <line x1="42" y1="62" x2="58" y2="62" stroke={color} strokeWidth="2" opacity="0.5"/>
                        <rect x="42" y="80" width="7" height="14" fill={color} opacity="0.4"/>
                        <rect x="51" y="80" width="7" height="14" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'banshee-wail') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 30 30 Q 50 15 70 30 L 65 90 Q 50 85 35 90 Z" fill={color} opacity="0.2"/>
                        <circle cx="50" cy="35" r="14" fill={color} opacity="0.3"/>
                        <circle cx="44" cy="33" r="4" fill="#000" opacity="0.6"/><circle cx="56" cy="33" r="4" fill="#000" opacity="0.6"/>
                        <ellipse cx="50" cy="44" rx="5" ry="7" fill="#000" opacity="0.5"/>
                        <path d="M 30 40 Q 22 35 20 42" stroke={color} strokeWidth="1.5" fill="none" opacity="0.5"/>
                        <path d="M 70 40 Q 78 35 80 42" stroke={color} strokeWidth="1.5" fill="none" opacity="0.5"/>
                        <path d="M 26 45 Q 18 42 16 48" stroke={color} strokeWidth="1" fill="none" opacity="0.3"/>
                        <path d="M 74 45 Q 82 42 84 48" stroke={color} strokeWidth="1" fill="none" opacity="0.3"/>
                    </svg>
                );
            }
            if (characterId === 'inferno-imp') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="38" r="16" fill={color} opacity="0.4"/>
                        <path d="M 38 25 L 34 10 L 40 20 Z" fill={color}/><path d="M 62 25 L 66 10 L 60 20 Z" fill={color}/>
                        <circle cx="44" cy="35" r="3" fill="#000"/><circle cx="56" cy="35" r="3" fill="#000"/>
                        <path d="M 42 44 Q 50 50 58 44" stroke={color} strokeWidth="2" fill="none"/>
                        <ellipse cx="50" cy="65" rx="14" ry="18" fill={color} opacity="0.3"/>
                        <path d="M 50 82 Q 45 92 50 95 Q 55 92 50 82" fill={color} opacity="0.5"/>
                        <path d="M 28 50 L 22 46 L 20 52" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 72 50 L 78 46 L 80 52" stroke={color} strokeWidth="2" fill="none"/>
                    </svg>
                );
            }
            if (characterId === 'crypt-wyrm') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <ellipse cx="50" cy="30" rx="16" ry="12" fill={color} opacity="0.4"/>
                        <circle cx="44" cy="28" r="3" fill="#000"/><circle cx="56" cy="28" r="3" fill="#000"/>
                        <path d="M 44 36 L 48 38 L 52 36 L 56 38" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 50 42 Q 60 55 55 70 Q 48 80 40 75 Q 32 70 38 60 Q 44 52 50 58 Q 56 65 52 75 Q 48 85 50 92" stroke={color} strokeWidth="5" fill="none" opacity="0.4"/>
                        <path d="M 50 42 Q 60 55 55 70 Q 48 80 40 75 Q 32 70 38 60 Q 44 52 50 58 Q 56 65 52 75 Q 48 85 50 92" stroke={color} strokeWidth="2" fill="none"/>
                    </svg>
                );
            }

            // --- Rare Characters (extra visual details: weapons/armor/accessories) ---
            if (characterId === 'prism-knight') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <rect x="32" y="14" width="36" height="28" fill={color} opacity="0.3" rx="4"/>
                        <rect x="32" y="14" width="36" height="28" fill="none" stroke={color} strokeWidth="2.5" rx="4"/>
                        <path d="M 32 14 L 50 6 L 68 14" fill={color} opacity="0.5"/>
                        <circle cx="43" cy="26" r="3.5" fill={color}/><circle cx="57" cy="26" r="3.5" fill={color}/>
                        <rect x="42" y="34" width="16" height="3" fill={color} rx="1"/>
                        <rect x="34" y="46" width="32" height="36" fill={color} opacity="0.25" rx="4"/>
                        <rect x="34" y="46" width="32" height="36" fill="none" stroke={color} strokeWidth="2" rx="4"/>
                        <polygon points="50,50 42,58 50,66 58,58" fill={color} opacity="0.4"/>
                        <path d="M 26 50 L 14 52 L 14 64 L 26 60 Z" fill={color} opacity="0.5" stroke={color} strokeWidth="1.5"/>
                        <rect x="42" y="82" width="7" height="14" fill={color} opacity="0.5"/>
                        <rect x="51" y="82" width="7" height="14" fill={color} opacity="0.5"/>
                    </svg>
                );
            }
            if (characterId === 'void-archer') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 35 12 Q 50 8 65 12 L 62 28 Q 50 32 38 28 Z" fill={color} opacity="0.4"/>
                        <circle cx="50" cy="24" r="12" fill={color} opacity="0.25"/>
                        <circle cx="45" cy="22" r="2.5" fill={color}/><circle cx="55" cy="22" r="2.5" fill={color}/>
                        <rect x="38" y="38" width="24" height="32" fill={color} opacity="0.25" rx="3"/>
                        <path d="M 75 25 Q 80 50 75 75" stroke={color} strokeWidth="2.5" fill="none"/>
                        <line x1="75" y1="50" x2="60" y2="50" stroke={color} strokeWidth="2"/>
                        <polygon points="60,50 64,47 64,53" fill={color}/>
                        <path d="M 70 30 L 75 25" stroke={color} strokeWidth="1.5"/><path d="M 70 70 L 75 75" stroke={color} strokeWidth="1.5"/>
                        <rect x="42" y="70" width="6" height="14" fill={color} opacity="0.4"/>
                        <rect x="52" y="70" width="6" height="14" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'neon-ronin') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="26" r="14" fill={color} opacity="0.25"/>
                        <rect x="38" y="16" width="24" height="4" fill={color} opacity="0.6"/>
                        <circle cx="44" cy="26" r="3" fill={color}/><circle cx="56" cy="26" r="3" fill={color}/>
                        <path d="M 44 32 L 56 32" stroke={color} strokeWidth="1.5"/>
                        <rect x="36" y="42" width="28" height="34" fill={color} opacity="0.25" rx="3"/>
                        <line x1="50" y1="42" x2="50" y2="76" stroke={color} strokeWidth="1" opacity="0.4"/>
                        <rect x="18" y="20" width="3" height="50" fill={color} opacity="0.7" rx="1"/>
                        <rect x="16" y="16" width="7" height="6" fill={color} opacity="0.9" rx="1"/>
                        <line x1="19" y1="20" x2="19" y2="70" stroke="#fff" strokeWidth="0.5" opacity="0.5"/>
                        <rect x="42" y="76" width="7" height="14" fill={color} opacity="0.4"/>
                        <rect x="51" y="76" width="7" height="14" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'data-alchemist') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="28" r="14" fill={color} opacity="0.25"/>
                        <circle cx="44" cy="26" r="3" fill={color}/><circle cx="56" cy="26" r="3" fill={color}/>
                        <path d="M 44 34 Q 50 38 56 34" stroke={color} strokeWidth="1.5" fill="none"/>
                        <rect x="36" y="44" width="28" height="32" fill={color} opacity="0.25" rx="4"/>
                        <circle cx="28" cy="20" r="6" fill={color} opacity="0.3" stroke={color} strokeWidth="1.5"/>
                        <circle cx="72" cy="24" r="5" fill={color} opacity="0.3" stroke={color} strokeWidth="1.5"/>
                        <circle cx="24" cy="40" r="4" fill={color} opacity="0.3" stroke={color} strokeWidth="1.5"/>
                        <path d="M 28 20 L 36 24" stroke={color} strokeWidth="1" opacity="0.5" strokeDasharray="2 2"/>
                        <path d="M 72 24 L 64 28" stroke={color} strokeWidth="1" opacity="0.5" strokeDasharray="2 2"/>
                        <path d="M 24 40 L 36 44" stroke={color} strokeWidth="1" opacity="0.5" strokeDasharray="2 2"/>
                        <rect x="42" y="76" width="7" height="14" fill={color} opacity="0.4"/>
                        <rect x="51" y="76" width="7" height="14" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'circuit-witch') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <path d="M 50 4 L 38 24 L 62 24 Z" fill={color} opacity="0.5"/>
                        <circle cx="50" cy="30" r="12" fill={color} opacity="0.25"/>
                        <circle cx="45" cy="28" r="2.5" fill={color}/><circle cx="55" cy="28" r="2.5" fill={color}/>
                        <path d="M 36 44 Q 30 60 28 80 L 38 76 L 42 84 L 50 74 L 58 84 L 62 76 L 72 80 Q 70 60 64 44 Z" fill={color} opacity="0.25"/>
                        <path d="M 36 44 Q 30 60 28 80 L 38 76 L 42 84 L 50 74 L 58 84 L 62 76 L 72 80 Q 70 60 64 44 Z" fill="none" stroke={color} strokeWidth="1.5"/>
                        <circle cx="50" cy="56" r="3" fill={color} opacity="0.6"/>
                        <circle cx="50" cy="56" r="6" fill="none" stroke={color} strokeWidth="1" opacity="0.3"/>
                        <path d="M 76 40 L 82 36 L 80 44 L 86 42" stroke={color} strokeWidth="2" fill="none"/>
                    </svg>
                );
            }

            // --- Legendary Characters (glow/flame/large/animal) ---
            if (characterId === 'grid-phoenix') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="50" r="35" fill={color} opacity="0.08"/>
                        <circle cx="50" cy="50" r="28" fill={color} opacity="0.06"/>
                        <path d="M 50 20 L 44 35 Q 50 30 56 35 Z" fill={color}/>
                        <circle cx="46" cy="33" r="2" fill="#000"/><circle cx="54" cy="33" r="2" fill="#000"/>
                        <path d="M 50 38 Q 48 42 50 44 Q 52 42 50 38" fill={color} opacity="0.7"/>
                        <path d="M 35 35 Q 20 25 15 40 Q 22 38 30 45 Q 25 50 18 55 Q 28 52 35 55" fill={color} opacity="0.5"/>
                        <path d="M 65 35 Q 80 25 85 40 Q 78 38 70 45 Q 75 50 82 55 Q 72 52 65 55" fill={color} opacity="0.5"/>
                        <path d="M 40 50 Q 50 48 60 50 L 58 70 Q 50 72 42 70 Z" fill={color} opacity="0.3"/>
                        <path d="M 42 70 Q 38 82 35 90" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 50 70 Q 50 84 50 92" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 58 70 Q 62 82 65 90" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 50 10 Q 48 5 50 2 Q 52 5 50 10" fill={color} opacity="0.6"/>
                    </svg>
                );
            }
            if (characterId === 'neon-titan') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <rect x="50" y="50" width="0" height="0" fill={color} opacity="0.06">
                            <animate attributeName="x" values="22;20;22" dur="2s" repeatCount="indefinite"/>
                            <animate attributeName="y" values="12;10;12" dur="2s" repeatCount="indefinite"/>
                            <animate attributeName="width" values="56;60;56" dur="2s" repeatCount="indefinite"/>
                            <animate attributeName="height" values="80;84;80" dur="2s" repeatCount="indefinite"/>
                            <animate attributeName="opacity" values="0.06;0.12;0.06" dur="2s" repeatCount="indefinite"/>
                        </rect>
                        <rect x="28" y="10" width="44" height="30" fill={color} opacity="0.3" rx="6"/>
                        <rect x="28" y="10" width="44" height="30" fill="none" stroke={color} strokeWidth="3" rx="6"/>
                        <circle cx="42" cy="24" r="5" fill={color}/><circle cx="58" cy="24" r="5" fill={color}/>
                        <rect x="40" y="34" width="20" height="4" fill={color} rx="2"/>
                        <rect x="26" y="44" width="48" height="40" fill={color} opacity="0.25" rx="5"/>
                        <rect x="26" y="44" width="48" height="40" fill="none" stroke={color} strokeWidth="2.5" rx="5"/>
                        <path d="M 18 48 L 26 54 L 26 74 L 18 68 Z" fill={color} opacity="0.5"/>
                        <path d="M 82 48 L 74 54 L 74 74 L 82 68 Z" fill={color} opacity="0.5"/>
                        <rect x="36" y="84" width="12" height="14" fill={color} opacity="0.5" rx="2"/>
                        <rect x="52" y="84" width="12" height="14" fill={color} opacity="0.5" rx="2"/>
                    </svg>
                );
            }
            if (characterId === 'cyber-bear') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="50" r="30" fill={color} opacity="0.06"/>
                        <circle cx="34" cy="22" r="10" fill={color} opacity="0.4"/>
                        <circle cx="66" cy="22" r="10" fill={color} opacity="0.4"/>
                        <circle cx="34" cy="22" r="6" fill={color} opacity="0.2"/>
                        <circle cx="66" cy="22" r="6" fill={color} opacity="0.2"/>
                        <circle cx="50" cy="38" r="20" fill={color} opacity="0.35"/>
                        <circle cx="50" cy="38" r="20" fill="none" stroke={color} strokeWidth="1.5"/>
                        <circle cx="43" cy="34" r="4" fill="#000"/><circle cx="57" cy="34" r="4" fill="#000"/>
                        <circle cx="44" cy="33" r="1.5" fill={color}/><circle cx="58" cy="33" r="1.5" fill={color}/>
                        <ellipse cx="50" cy="42" rx="6" ry="4" fill={color} opacity="0.3"/>
                        <circle cx="50" cy="41" r="2" fill="#000"/>
                        <path d="M 46 46 Q 50 50 54 46" stroke="#000" strokeWidth="1.5" fill="none"/>
                        <ellipse cx="50" cy="68" rx="18" ry="16" fill={color} opacity="0.3"/>
                        <ellipse cx="50" cy="68" rx="18" ry="16" fill="none" stroke={color} strokeWidth="1.5"/>
                        <path d="M 40 50 L 38 56" stroke={color} strokeWidth="1" opacity="0.4"/>
                        <path d="M 60 50 L 62 56" stroke={color} strokeWidth="1" opacity="0.4"/>
                        <path d="M 44 58 L 44 66" stroke={color} strokeWidth="1" opacity="0.3"/>
                        <path d="M 56 58 L 56 66" stroke={color} strokeWidth="1" opacity="0.3"/>
                        <ellipse cx="38" cy="88" rx="7" ry="6" fill={color} opacity="0.4"/>
                        <ellipse cx="62" cy="88" rx="7" ry="6" fill={color} opacity="0.4"/>
                    </svg>
                );
            }
            if (characterId === 'quantum-dragon') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="50" r="32" fill={color} opacity="0.05"/>
                        <ellipse cx="50" cy="32" rx="16" ry="14" fill={color} opacity="0.35"/>
                        <path d="M 36 22 L 28 8 L 38 18 Z" fill={color} opacity="0.7"/>
                        <path d="M 64 22 L 72 8 L 62 18 Z" fill={color} opacity="0.7"/>
                        <circle cx="44" cy="28" r="4" fill="#000"/><circle cx="56" cy="28" r="4" fill="#000"/>
                        <circle cx="45" cy="27" r="1.5" fill={color}/><circle cx="57" cy="27" r="1.5" fill={color}/>
                        <path d="M 44 38 L 48 40 L 52 38 L 56 40" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 50 46 Q 62 56 58 70 Q 52 78 44 74 Q 36 68 42 58 Q 48 50 56 56 Q 64 64 58 76 Q 52 86 50 94" stroke={color} strokeWidth="4" fill="none" opacity="0.3"/>
                        <path d="M 50 46 Q 62 56 58 70 Q 52 78 44 74 Q 36 68 42 58 Q 48 50 56 56 Q 64 64 58 76 Q 52 86 50 94" stroke={color} strokeWidth="2" fill="none"/>
                        <path d="M 30 34 L 16 40 L 14 34 L 8 38" stroke={color} strokeWidth="2" fill="none" opacity="0.5"/>
                        <path d="M 70 34 L 84 40 L 86 34 L 92 38" stroke={color} strokeWidth="2" fill="none" opacity="0.5"/>
                    </svg>
                );
            }
            if (characterId === 'omega-prime') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        <circle cx="50" cy="50" r="38" fill={color} opacity="0.04">
                            <animate attributeName="opacity" values="0.04;0.1;0.04" dur="3s" repeatCount="indefinite"/>
                        </circle>
                        <circle cx="50" cy="50" r="30" fill={color} opacity="0.06">
                            <animate attributeName="opacity" values="0.06;0.14;0.06" dur="2s" repeatCount="indefinite"/>
                        </circle>
                        <circle cx="50" cy="28" r="16" fill={color} opacity="0.3"/>
                        <circle cx="50" cy="28" r="16" fill="none" stroke={color} strokeWidth="2"/>
                        <path d="M 34 20 L 50 10 L 66 20" fill={color} opacity="0.5"/>
                        <circle cx="44" cy="26" r="4" fill={color}/><circle cx="56" cy="26" r="4" fill={color}/>
                        <circle cx="44" cy="26" r="2" fill="#fff" opacity="0.8"/><circle cx="56" cy="26" r="2" fill="#fff" opacity="0.8"/>
                        <path d="M 44 36 Q 50 40 56 36" stroke={color} strokeWidth="2" fill="none"/>
                        <rect x="34" y="48" width="32" height="36" fill={color} opacity="0.2" rx="5"/>
                        <rect x="34" y="48" width="32" height="36" fill="none" stroke={color} strokeWidth="2" rx="5"/>
                        <text x="50" y="72" textAnchor="middle" fill={color} fontSize="18" fontFamily="monospace" opacity="0.7"></text>
                        <rect x="38" y="84" width="10" height="12" fill={color} opacity="0.4" rx="2"/>
                        <rect x="52" y="84" width="10" height="12" fill={color} opacity="0.4" rx="2"/>
                    </svg>
                );
            }

            // Meta avatar - Matrix-style green binary code with Tron cyan accents
            if (characterId === 'meta') {
                return (
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                        {/* Head */}
                        <circle cx="50" cy="24" r="13" fill="#0a2a0a" stroke="#06b6d4" strokeWidth="1" opacity="0.9"/>
                        {/* Body */}
                        <rect x="37" y="38" width="26" height="28" fill="#0a2a0a" stroke="#06b6d4" strokeWidth="0.8" rx="3" opacity="0.9"/>
                        {/* Legs */}
                        <rect x="40" y="66" width="8" height="16" fill="#0a2a0a" stroke="#06b6d4" strokeWidth="0.8" rx="2" opacity="0.9"/>
                        <rect x="52" y="66" width="8" height="16" fill="#0a2a0a" stroke="#06b6d4" strokeWidth="0.8" rx="2" opacity="0.9"/>
                        {/* Arms */}
                        <rect x="26" y="41" width="11" height="5" fill="#0a2a0a" stroke="#06b6d4" strokeWidth="0.8" rx="2" opacity="0.9"/>
                        <rect x="63" y="41" width="11" height="5" fill="#0a2a0a" stroke="#06b6d4" strokeWidth="0.8" rx="2" opacity="0.9"/>
                        {/* Binary code on head */}
                        <text fill="#22c55e" fontSize="5" fontFamily="monospace" opacity="0.8">
                            <tspan x="42" y="18">01</tspan>
                            <tspan x="53" y="20">1</tspan>
                            <tspan x="45" y="30">10</tspan>
                        </text>
                        {/* Binary code on body */}
                        <text fill="#22c55e" fontSize="5" fontFamily="monospace" opacity="0.8">
                            <tspan x="39" y="46">01</tspan>
                            <tspan x="52" y="44">10</tspan>
                            <tspan x="42" y="53">110</tspan>
                            <tspan x="53" y="51">01</tspan>
                            <tspan x="40" y="60">01</tspan>
                            <tspan x="53" y="58">10</tspan>
                        </text>
                        {/* Binary on legs */}
                        <text fill="#22c55e" fontSize="4" fontFamily="monospace" opacity="0.6">
                            <tspan x="42" y="74">10</tspan>
                            <tspan x="54" y="76">01</tspan>
                        </text>
                        {/* Bright streaks */}
                        <text fill="#4ade80" fontSize="4" fontFamily="monospace" opacity="0.5">
                            <tspan x="47" y="48">1</tspan>
                            <tspan x="44" y="56">0</tspan>
                        </text>
                        {/* Glowing cyan eyes */}
                        <circle cx="45" cy="22" r="2.5" fill="#06b6d4">
                            <animate attributeName="opacity" values="1;0.3;1" dur="2s" repeatCount="indefinite"/>
                        </circle>
                        <circle cx="55" cy="22" r="2.5" fill="#06b6d4">
                            <animate attributeName="opacity" values="1;0.3;1" dur="2s" repeatCount="indefinite"/>
                        </circle>
                        {/* Scanning line effect */}
                        <line x1="38" y1="45" x2="62" y2="45" stroke="#06b6d4" strokeWidth="0.5" opacity="0.3">
                            <animate attributeName="y1" values="38;66;38" dur="3s" repeatCount="indefinite"/>
                            <animate attributeName="y2" values="38;66;38" dur="3s" repeatCount="indefinite"/>
                        </line>
                        {/* Question mark overlay */}
                        <text x="50" y="56" textAnchor="middle" fill="#06b6d4" fontSize="14" fontFamily="monospace" fontWeight="bold" opacity="0.6">?</text>
                    </svg>
                );
            }

            // Default fallback
            return (
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style={svgStyle}>
                    <circle cx="50" cy="50" r="40" fill={color} opacity="0.3"/>
                    <circle cx="40" cy="40" r="5" fill={color}/>
                    <circle cx="60" cy="40" r="5" fill={color}/>
                    <path d="M 35 60 Q 50 70 65 60" stroke={color} strokeWidth="3" fill="none"/>
                </svg>
            );
        };

        // Map game IDs to icon components
        const getGameIcon = (gameId, className) => {
            const iconMap = {
                1: <BrainIcon className={className} />,
                2: <PaintBrushIcon className={className} />,
                3: <PencilIcon className={className} />,
                4: <CardIcon className={className} />,
                5: <CalculatorIcon className={className} />,
                6: <SmileIcon className={className} />,
                7: <KeyboardIcon className={className} />,
                8: <PuzzleIcon className={className} />,
                9: <MusicIcon className={className} />,
                10: <ZapIcon className={className} />,
                11: <BookIcon className={className} />,
                12: <PaintBrushIcon className={className} />,
                13: <GlobeIcon className={className} />,
                14: <WaveformIcon className={className} />,
                15: <LightbulbIcon className={className} />,
                16: <PartyPopperIcon className={className} />
            };
            return iconMap[gameId] || <Gamepad2 className={className} />;
        };

        const Star = ({ className, filled }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
        );

        const Info = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
        );

        const Youtube = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path>
                <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
            </svg>
        );

        const Palette = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="13.5" cy="6.5" r=".5"></circle>
                <circle cx="17.5" cy="10.5" r=".5"></circle>
                <circle cx="8.5" cy="7.5" r=".5"></circle>
                <circle cx="6.5" cy="12.5" r=".5"></circle>
                <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"></path>
            </svg>
        );

        // Daft Punk-inspired Helmet Icon for Tron mode with animated eyes
        const DaftPunkRobotHead = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" className={className} fill="currentColor">
                {/* Helmet outline - sleek angular design */}
                <path d="M 30 20 L 20 40 L 20 75 Q 20 85 30 85 L 70 85 Q 80 85 80 75 L 80 40 L 70 20 Z" 
                      stroke="currentColor" strokeWidth="2.5" fill="none"/>
                
                {/* Top chrome strip */}
                <rect x="25" y="22" width="50" height="6" rx="1" fill="currentColor" opacity="0.4"/>
                
                {/* Visor - iconic horizontal band */}
                <rect x="22" y="38" width="56" height="20" rx="2" fill="currentColor"/>
                <rect x="24" y="40" width="52" height="16" rx="1" fill="black" opacity="0.3"/>
                
                {/* LED lights on visor - animated */}
                <circle cx="35" cy="48" r="2" fill="#00ffff" opacity="0.8" className="robot-eye-glow"/>
                <circle cx="50" cy="48" r="2" fill="#00ffff" opacity="0.8" className="robot-eye-glow" style={{animationDelay: '0.5s'}}/>
                <circle cx="65" cy="48" r="2" fill="#00ffff" opacity="0.8" className="robot-eye-glow" style={{animationDelay: '1s'}}/>
                
                {/* Ventilation grills */}
                <line x1="30" y1="65" x2="45" y2="65" stroke="currentColor" strokeWidth="2" opacity="0.6"/>
                <line x1="55" y1="65" x2="70" y2="65" stroke="currentColor" strokeWidth="2" opacity="0.6"/>
                <line x1="30" y1="70" x2="45" y2="70" stroke="currentColor" strokeWidth="2" opacity="0.6"/>
                <line x1="55" y1="70" x2="70" y2="70" stroke="currentColor" strokeWidth="2" opacity="0.6"/>
                
                {/* Chin piece */}
                <path d="M 30 80 L 35 85 L 65 85 L 70 80" stroke="currentColor" strokeWidth="2" fill="none"/>
                
                {/* Side details */}
                <circle cx="22" cy="48" r="3" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                <circle cx="78" cy="48" r="3" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                
                {/* Angular accents */}
                <line x1="25" y1="58" x2="20" y2="63" stroke="currentColor" strokeWidth="2"/>
                <line x1="75" y1="58" x2="80" y2="63" stroke="currentColor" strokeWidth="2"/>
            </svg>
        );

        // Daft Punk Helmet Icon (keeping for kids mode)
        const DaftPunkHelmet = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" className={className} fill="currentColor">
                <path d="M50 10 C30 10 15 25 15 45 L15 70 C15 80 20 85 30 85 L70 85 C80 85 85 80 85 70 L85 45 C85 25 70 10 50 10 Z" stroke="currentColor" strokeWidth="2" fill="none"/>
                <rect x="25" y="35" width="20" height="15" rx="2" fill="currentColor"/>
                <rect x="55" y="35" width="20" height="15" rx="2" fill="currentColor"/>
                <path d="M35 60 Q50 70 65 60" stroke="currentColor" strokeWidth="3" fill="none" strokeLinecap="round"/>
            </svg>
        );

        // Mock game data
        const MOCK_GAMES = [
            { 
                id: 1, 
                name: 'Trivia Master', 
                icon: '',
                color: '#FF6B6B',
                rating: 4.8,
                description: 'Test your knowledge across multiple categories. Fast-paced questions with real-time scoring.',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '2-8',
                ageMin: 10
            },
            { 
                id: 2, 
                name: 'Drawing Battle', 
                icon: '',
                color: '#4ECDC4',
                rating: 4.6,
                description: 'Draw and guess in this creative multiplayer game. Perfect for artists and doodlers alike!',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '3-10',
                ageMin: 6
            },
            { 
                id: 3, 
                name: 'Word Rush', 
                icon: '',
                color: '#FFE66D',
                rating: 4.7,
                description: 'Create words from letters before time runs out. Competitive wordplay at its finest.',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '1-6',
                ageMin: 8
            },
            { 
                id: 4, 
                name: 'Memory Match', 
                icon: '',
                color: '#95E1D3',
                rating: 4.5,
                description: 'Classic memory card matching with a multiplayer twist. Train your brain!',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '1-4',
                ageMin: 5
            },
            { 
                id: 5, 
                name: 'Quick Math', 
                icon: '',
                color: '#F38181',
                rating: 4.9,
                description: 'Solve math problems faster than your opponents. Educational and exciting!',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '1-8',
                ageMin: 7
            },
            { 
                id: 6, 
                name: 'Emoji Charades', 
                icon: '',
                color: '#AA96DA',
                rating: 4.7,
                description: 'Guess phrases from emoji combinations. Fun for all ages and skill levels.',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '2-12',
                ageMin: 8
            },
            { 
                id: 7, 
                name: 'Speed Typing', 
                icon: '',
                color: '#F9A826',
                rating: 4.4,
                description: 'Race against others in this fast-paced typing challenge. Improve your WPM!',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '1-6',
                ageMin: 10
            },
            { 
                id: 8, 
                name: 'Puzzle Rush', 
                icon: '',
                color: '#5F27CD',
                rating: 4.6,
                description: 'Complete jigsaw puzzles collaboratively or competitively. Multiple difficulty levels.',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '1-4',
                ageMin: 6
            },
            { 
                id: 9, 
                name: 'Music Quiz', 
                icon: '',
                color: '#00D2D3',
                rating: 4.8,
                description: 'Identify songs and artists from short clips. Perfect for music lovers!',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '2-10',
                ageMin: 12
            },
            { 
                id: 10, 
                name: 'Reaction Time', 
                icon: '',
                color: '#FF3838',
                rating: 4.3,
                description: 'Test your reflexes in various quick-tap challenges. Lightning fast gameplay!',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '1-8',
                ageMin: 8
            },
            { 
                id: 11, 
                name: 'Story Builder', 
                icon: '',
                color: '#FF6348',
                rating: 4.5,
                description: 'Collaboratively create hilarious stories one sentence at a time.',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '3-8',
                ageMin: 10
            },
            { 
                id: 12, 
                name: 'Color Match', 
                icon: '',
                color: '#786FA6',
                rating: 4.4,
                description: 'Match colors and patterns in this visually stunning puzzle game.',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '1-4',
                ageMin: 5
            },
            { 
                id: 13, 
                name: 'Geography Quest', 
                icon: '',
                color: '#F8B500',
                rating: 4.7,
                description: 'Explore the world through map challenges and country trivia.',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '2-6',
                ageMin: 12
            },
            { 
                id: 14, 
                name: 'Rhythm Master', 
                icon: '',
                color: '#E74292',
                rating: 4.6,
                description: 'Hit the beats and create music together in this rhythm game.',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '1-6',
                ageMin: 8
            },
            { 
                id: 15, 
                name: 'Logic Puzzles', 
                icon: '',
                color: '#546DE5',
                rating: 4.8,
                description: 'Solve complex logic problems and brain teasers together.',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '1-4',
                ageMin: 14
            },
            { 
                id: 16, 
                name: 'Party Minigames', 
                icon: '',
                color: '#26DE81',
                rating: 4.9,
                description: 'Collection of quick party games perfect for large groups.',
                youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                players: '4-16',
                ageMin: 6
            },
        ];

        // Simulated Socket.io connection
        class MockSocket {
            constructor() {
                this.handlers = {};
                this.rooms = new Map();
                // Pre-populate with dummy room
                this.rooms.set('XU1V2', {
                    id: 'XU1V2',
                    name: "Anderson's Game Room",
                    master: 'Anderson',
                    players: [
                        { name: 'Anderson', isMaster: true, avatar: 'cyber-knight' },
                        { name: 'Sarah', isMaster: false, avatar: 'neon-ninja' },
                        { name: 'Mike', isMaster: false, avatar: 'data-runner' },
                        { name: 'Emma', isMaster: false, avatar: 'circuit-breaker' }
                    ],
                    selectedGames: [1, 5, 9], // Trivia Master, Quick Math, Music Quiz
                });
            }

            on(event, handler) {
                if (!this.handlers[event]) this.handlers[event] = [];
                this.handlers[event].push(handler);
            }

            emit(event, data) {
                setTimeout(() => {
                    if (event === 'createRoom') {
                        const roomId = Math.random().toString(36).substring(2, 8).toUpperCase();
                        const room = {
                            id: roomId,
                            name: data.roomName,
                            master: data.playerName,
                            players: [{ name: data.playerName, isMaster: true, avatar: data.avatar || '' }],
                            selectedGames: [],
                        };
                        this.rooms.set(roomId, room);
                        this.trigger('roomCreated', room);
                    } else if (event === 'joinRoom') {
                        const room = this.rooms.get(data.roomId);
                        if (room) {
                            room.players.push({ name: data.playerName, isMaster: false, avatar: data.avatar || '' });
                            this.trigger('roomJoined', room);
                            this.trigger('playerJoined', { roomId: data.roomId, player: data.playerName, avatar: data.avatar });
                        } else {
                            this.trigger('error', { message: 'Room not found' });
                        }
                    } else if (event === 'toggleGame') {
                        const room = this.rooms.get(data.roomId);
                        if (room) {
                            const index = room.selectedGames.indexOf(data.gameId);
                            if (index > -1) {
                                room.selectedGames.splice(index, 1);
                            } else {
                                room.selectedGames.push(data.gameId);
                            }
                            this.trigger('gamesUpdated', { roomId: data.roomId, selectedGames: room.selectedGames });
                        }
                    } else if (event === 'startGame') {
                        this.trigger('gameStarting', { roomId: data.roomId });
                    }
                }, 100);
            }

            trigger(event, data) {
                if (this.handlers[event]) {
                    this.handlers[event].forEach(handler => handler(data));
                }
            }
        }

        const socket = io();

        // --- Session persistence helpers ---
        const SESSION_KEY = 'gamehub_session';
        function saveSession(data) {
            try { sessionStorage.setItem(SESSION_KEY, JSON.stringify(data)); } catch (e) {}
        }
        function loadSession() {
            try { return JSON.parse(sessionStorage.getItem(SESSION_KEY)); } catch (e) { return null; }
        }
        function clearSession() {
            try { sessionStorage.removeItem(SESSION_KEY); } catch (e) {}
        }

        // Pictionary Game Component
        const PictionaryGame = ({ theme, currentTheme, playerName, selectedAvatar, availableCharacters, currentRoom, isMuted }) => {
            const canvasRef = useRef(null);
            const audioRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);
            const [drawColor, setDrawColor] = useState('#000000');
            const [brushSize, setBrushSize] = useState(3);
            const [isDrawer, setIsDrawer] = useState(true);
            const [currentWord, setCurrentWord] = useState('');
            const [gameTimer, setGameTimer] = useState(60);
            const [chatMessages, setChatMessages] = useState([]);
            const [chatInput, setChatInput] = useState('');
            const [roundWinner, setRoundWinner] = useState(null);
            const [audioStarted, setAudioStarted] = useState(false);
            const [musicStarted, setMusicStarted] = useState(false);
            const [showTimerEndModal, setShowTimerEndModal] = useState(false);
            const [showPickWinner, setShowPickWinner] = useState(false);
            const [selectedWinnerCandidate, setSelectedWinnerCandidate] = useState(null);

            // Start music function
            const startMusic = () => {
                if (audioRef.current && !isMuted) {
                    // Load the audio source first
                    audioRef.current.load();
                    
                    const playPromise = audioRef.current.play();
                    
                    if (playPromise !== undefined) {
                        playPromise
                            .then(() => {
                                setMusicStarted(true);
                                console.log(' Music started successfully!');
                                console.log('Current theme:', theme);
                                console.log('Audio src:', audioRef.current.currentSrc);
                            })
                            .catch(err => {
                                console.error(' Music play failed:', err);
                                alert(`Music failed to play. Error: ${err.message}\n\nTry:\n1. Check browser volume\n2. Unmute the tab\n3. Click the mute button in header twice`);
                            });
                    }
                } else if (isMuted) {
                    alert('Music is muted. Click the speaker icon in the header to unmute.');
                }
            };

            // Handle mute state changes
            useEffect(() => {
                if (audioRef.current) {
                    if (isMuted) {
                        audioRef.current.pause();
                    } else if (musicStarted) {
                        audioRef.current.play().catch(err => console.log('Resume failed:', err));
                    }
                }
            }, [isMuted, musicStarted]);

            // Initialize game
            useEffect(() => {
                const words = ['ELEPHANT', 'PIZZA', 'RAINBOW', 'ROCKET', 'CASTLE', 'GUITAR', 'ROBOT', 'TREASURE', 'UNICORN', 'DRAGON'];
                setCurrentWord(words[Math.floor(Math.random() * words.length)]);
                
                // Add fake chat messages for development (only for drawer)
                setChatMessages([
                    { player: 'Sarah', message: 'Is it a house?', timestamp: Date.now() - 5000, avatar: 'neon-ninja' },
                    { player: 'Mike', message: 'Castle!', timestamp: Date.now() - 3000, avatar: 'data-runner' },
                    { player: 'Emma', message: 'A building', timestamp: Date.now() - 1000, avatar: 'circuit-breaker' }
                ]);
            }, []);

            // Game timer countdown with modal when time's up
            useEffect(() => {
                if (gameTimer > 0 && !roundWinner) {
                    const timer = setInterval(() => {
                        setGameTimer(prev => {
                            if (prev === 1 && isDrawer) {
                                // Time's up - show modal
                                setSelectedWinnerCandidate(null);
                                setShowTimerEndModal(true);
                            }
                            return prev - 1;
                        });
                    }, 1000);
                    return () => clearInterval(timer);
                }
            }, [gameTimer, roundWinner, isDrawer]);

            const startDrawing = (e) => {
                if (!isDrawer) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                const y = (e.clientY || e.touches?.[0]?.clientY) - rect.top;
                
                ctx.beginPath();
                ctx.moveTo(x, y);
                setIsDrawing(true);
            };

            const draw = (e) => {
                if (!isDrawing || !isDrawer) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                const y = (e.clientY || e.touches?.[0]?.clientY) - rect.top;
                
                ctx.strokeStyle = drawColor;
                ctx.lineWidth = brushSize;
                ctx.lineCap = 'round';
                ctx.lineTo(x, y);
                ctx.stroke();
            };

            const stopDrawing = () => {
                setIsDrawing(false);
            };

            const clearCanvas = () => {
                if (!isDrawer) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            };

            const sendMessage = () => {
                if (!chatInput.trim() || isDrawer) return;
                const newMessage = {
                    player: playerName,
                    message: chatInput,
                    timestamp: Date.now(),
                    avatar: selectedAvatar
                };
                setChatMessages(prev => [...prev, newMessage]);
                setChatInput('');
            };

            const selectWinner = (messageName) => {
                setRoundWinner(messageName);
                setShowTimerEndModal(false);
                setShowPickWinner(false);
                setSelectedWinnerCandidate(null);
                setTimeout(() => {
                    setIsDrawer(false);
                    setRoundWinner(null);
                    setGameTimer(60);
                    setChatMessages([]);
                    const words = ['MOUNTAIN', 'AIRPLANE', 'BIRTHDAY', 'TELESCOPE', 'WATERFALL', 'DINOSAUR'];
                    setCurrentWord(words[Math.floor(Math.random() * words.length)]);
                }, 3000);
            };

            return (
                <div className={`min-h-screen ${theme === 'tron' ? 'bg-black tron-grid' : theme === 'kids' ? 'bg-gradient-to-br from-orange-300 via-pink-400 to-purple-500' : 'bg-gradient-to-br from-gray-900 via-orange-950 to-black'} p-4 pt-24`}>
                    {/* Background Music */}
                    <audio ref={audioRef} loop>
                        {theme === 'tron' && (
                            <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg" />
                        )}
                        {theme === 'kids' && (
                            <source src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3" type="audio/mpeg" />
                        )}
                        {theme === 'scary' && (
                            <source src="https://assets.mixkit.co/active_storage/sfx/2462/2462-preview.mp3" type="audio/mpeg" />
                        )}
                        Your browser does not support the audio element.
                    </audio>

                    {/* Music Start Button - appears until clicked */}
                    {!musicStarted && !isMuted && (
                        <div className="fixed top-24 right-4 z-50 animate-bounce">
                            <button
                                onClick={startMusic}
                                className={`${theme === 'tron' ? 'bg-cyan-500 text-black tron-glow' : theme === 'kids' ? 'bg-purple-500 text-white' : 'bg-orange-600 text-white'} px-6 py-3 rounded-xl font-bold shadow-xl flex items-center gap-2 hover:scale-105 transition-all`}
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                </svg>
                                 Start Music
                            </button>
                        </div>
                    )}
                    
                    <div className="max-w-7xl mx-auto">
                        {/* Game Header - Ultra Compact Single Row */}
                        <div className={`${currentTheme.cardBg} backdrop-blur-lg rounded-lg p-2 ${theme === 'tron' ? 'border border-cyan-500/30' : theme === 'kids' ? 'border-2 border-purple-400' : 'border border-orange-700'} mb-2`}>
                            <div className="flex items-center justify-between gap-2">
                                {/* Game Name - Compact */}
                                <h1 className={`text-sm md:text-lg font-bold ${currentTheme.text} ${currentTheme.font} whitespace-nowrap`}>
                                    {theme === 'tron' ? 'PICTIONARY' : theme === 'kids' ? ' Drawing' : 'PICTIONARY'}
                                </h1>
                                
                                {/* Word (if drawer) - Compact */}
                                {isDrawer && (
                                    <div className={`${theme === 'tron' ? 'bg-cyan-500/20 border border-cyan-500/30 text-cyan-400' : theme === 'kids' ? 'bg-purple-500 text-white' : 'bg-orange-700/40 text-orange-400 border border-orange-700'} px-2 py-1 rounded-lg flex items-center gap-1`}>
                                        <span className="text-[0.6rem] opacity-70">Word:</span>
                                        <span className="text-xs md:text-sm font-black tracking-wide">{currentWord}</span>
                                    </div>
                                )}
                                
                                {/* Timer - Compact */}
                                <div className={`${gameTimer <= 10 ? (theme === 'tron' ? 'bg-red-500/20 text-red-400 border border-red-500' : theme === 'kids' ? 'bg-red-500 text-white' : 'bg-red-700/40 text-red-400 border border-red-700') : (theme === 'tron' ? 'bg-cyan-500/20 border border-cyan-500/30 text-cyan-400' : theme === 'kids' ? 'bg-green-500 text-white' : 'bg-orange-700/40 text-orange-400 border border-orange-700')} px-2 py-1 rounded-lg flex items-center gap-1 ${gameTimer <= 10 ? 'animate-pulse' : ''}`}>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    <span className="text-sm md:text-base font-black">{gameTimer}s</span>
                                </div>
                            </div>
                        </div>

                        {/* Main Game Area - Canvas and Chat */}
                        <div className="grid lg:grid-cols-3 gap-4 mb-4">
                            {/* Drawing Canvas */}
                            <div className="lg:col-span-2">
                                <div className={`${currentTheme.cardBg} backdrop-blur-lg rounded-2xl p-4 ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-4 border-purple-400' : 'border-2 border-orange-700'}`}>
                                    {isDrawer && (
                                        <div className="flex flex-wrap items-center gap-3 mb-4">
                                            <div className="flex items-center gap-2">
                                                <label className={`text-sm font-semibold ${currentTheme.text}`}>Color:</label>
                                                <input 
                                                    type="color" 
                                                    value={drawColor} 
                                                    onChange={(e) => setDrawColor(e.target.value)}
                                                    className="w-12 h-12 rounded cursor-pointer border-2"
                                                />
                                                <button onClick={() => setDrawColor('#000000')} className="w-8 h-8 bg-black border-2 rounded" title="Black"></button>
                                                <button onClick={() => setDrawColor('#ff0000')} className="w-8 h-8 bg-red-500 border-2 rounded" title="Red"></button>
                                                <button onClick={() => setDrawColor('#0000ff')} className="w-8 h-8 bg-blue-500 border-2 rounded" title="Blue"></button>
                                                <button onClick={() => setDrawColor('#00ff00')} className="w-8 h-8 bg-green-500 border-2 rounded" title="Green"></button>
                                                <button onClick={() => setDrawColor('#ffffff')} className="w-8 h-8 bg-white border-2 border-gray-400 rounded" title="Eraser (White)"></button>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <label className={`text-sm font-semibold ${currentTheme.text}`}>Size:</label>
                                                <input 
                                                    type="range" 
                                                    min="1" 
                                                    max="20" 
                                                    value={brushSize} 
                                                    onChange={(e) => setBrushSize(e.target.value)}
                                                    className="w-24"
                                                />
                                                <span className={currentTheme.text}>{brushSize}px</span>
                                            </div>
                                            <button 
                                                onClick={clearCanvas}
                                                className={`${theme === 'tron' ? 'bg-red-500/30 hover:bg-red-500/50 text-red-400' : theme === 'kids' ? 'bg-red-500 hover:bg-red-400 text-white' : 'bg-red-700/40 hover:bg-red-700/60 text-red-400'} px-4 py-2 rounded-lg font-semibold transition-all`}
                                            >
                                                Clear
                                            </button>
                                        </div>
                                    )}
                                    <canvas
                                        ref={canvasRef}
                                        width={800}
                                        height={600}
                                        onMouseDown={startDrawing}
                                        onMouseMove={draw}
                                        onMouseUp={stopDrawing}
                                        onMouseLeave={stopDrawing}
                                        onTouchStart={startDrawing}
                                        onTouchMove={draw}
                                        onTouchEnd={stopDrawing}
                                        className={`w-full bg-white rounded-xl ${isDrawer ? 'cursor-crosshair' : 'cursor-not-allowed'} touch-none`}
                                        style={{ maxHeight: '600px' }}
                                    />
                                </div>
                            </div>

                            {/* Chat/Guessing Area - Auto height */}
                            <div className={`${currentTheme.cardBg} backdrop-blur-lg rounded-xl md:rounded-2xl p-3 md:p-4 ${theme === 'tron' ? 'border border-cyan-500/30' : theme === 'kids' ? 'border-2 md:border-4 border-purple-400' : 'border border-orange-700'} flex flex-col h-[400px] md:h-[500px]`}>
                                <h3 className={`text-sm md:text-lg font-bold ${currentTheme.text} mb-2 ${currentTheme.font}`}>
                                    {isDrawer ? (theme === 'tron' ? '> GUESSES' : ' Guesses') : (theme === 'tron' ? '> YOUR_GUESS' : ' Your Guess')}
                                </h3>

                                {/* Messages - Visible without scrolling */}
                                <div className={`flex-1 overflow-y-auto mb-2 space-y-2 ${theme === 'tron' ? 'scrollbar-tron' : theme === 'kids' ? 'scrollbar-kids' : 'scrollbar-scary'}`}>
                                    {chatMessages.map((msg, idx) => {
                                        const character = availableCharacters.find(c => c.id === msg.avatar) || availableCharacters[0];
                                        return (
                                            <div
                                                key={idx}
                                                className={`${theme === 'tron' ? 'bg-cyan-500/10 border border-cyan-500/30' : theme === 'kids' ? 'bg-purple-100 border-2 border-purple-300' : 'bg-orange-900/20 border border-orange-700/50'} rounded-lg p-3`}
                                            >
                                                <div className="flex items-start gap-2">
                                                    <div className="w-8 h-8">
                                                        <CharacterSVG characterId={msg.avatar} size={32} color={character.color} />
                                                    </div>
                                                    <div className="flex-1">
                                                        <div className={`font-bold text-sm ${currentTheme.text}`}>{msg.player}</div>
                                                        <div className={`${currentTheme.textSecondary} text-sm`}>{msg.message}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* Winner Announcement */}
                                {roundWinner && (
                                    <div className={`${theme === 'tron' ? 'bg-green-500/20 border-2 border-green-500' : theme === 'kids' ? 'bg-green-400 text-white' : 'bg-green-700/40 border-2 border-green-600'} rounded-xl p-4 mb-3 text-center animate-pulse`}>
                                        <div className="text-2xl font-black mb-1"> {roundWinner} WINS! </div>
                                        <div className="text-sm opacity-80">Switching roles...</div>
                                    </div>
                                )}

                                {/* Input */}
                                {!isDrawer && !roundWinner && (
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={chatInput}
                                            onChange={(e) => setChatInput(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                                            placeholder="Type your guess..."
                                            className={`flex-1 ${theme === 'tron' ? 'bg-gray-900 text-cyan-400 border border-cyan-500/30' : theme === 'kids' ? 'bg-white text-purple-900 border-2 border-purple-300' : 'bg-gray-900 text-orange-400 border border-orange-700/50'} px-4 py-2 rounded-lg focus:outline-none focus:ring-2 ${theme === 'tron' ? 'focus:ring-cyan-400' : theme === 'kids' ? 'focus:ring-purple-500' : 'focus:ring-orange-600'}`}
                                        />
                                        <button
                                            onClick={sendMessage}
                                            className={`${theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black' : theme === 'kids' ? 'bg-purple-500 hover:bg-purple-400 text-white' : 'bg-orange-700 hover:bg-orange-600 text-white'} px-6 py-2 rounded-lg font-bold transition-all`}
                                        >
                                            Send
                                        </button>
                                    </div>
                                )}

                                {isDrawer && !roundWinner && chatMessages.length > 0 && (
                                    <button
                                        onClick={() => { setSelectedWinnerCandidate(null); setShowPickWinner(true); }}
                                        className={`w-full ${theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black' : theme === 'kids' ? 'bg-green-500 hover:bg-green-400 text-white' : 'bg-orange-700 hover:bg-orange-600 text-white'} font-bold py-3 rounded-xl transition-all text-sm`}
                                    >
                                        {theme === 'tron' ? '[ PICK_WINNER ]' : 'Pick Winner'}
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* Pick Winner Modal */}
                        {showPickWinner && isDrawer && (
                            <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                <div className={`${currentTheme.cardBg} backdrop-blur-xl rounded-3xl p-6 md:p-8 max-w-lg w-full max-h-[80vh] flex flex-col ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-4 border-purple-400' : 'border-4 border-orange-700'}`}>
                                    <h2 className={`text-xl md:text-2xl font-black ${currentTheme.text} mb-4 text-center ${currentTheme.font}`}>
                                        {theme === 'tron' ? '> SELECT_WINNER' : 'Select the Winner'}
                                    </h2>

                                    <div className={`flex-1 overflow-y-auto space-y-2 mb-4 ${theme === 'tron' ? 'scrollbar-tron' : theme === 'kids' ? 'scrollbar-kids' : 'scrollbar-scary'}`}>
                                        {currentRoom?.players.filter(p => p.name !== playerName).map((player, idx) => {
                                            const character = availableCharacters.find(c => c.id === player.avatar) || availableCharacters[0];
                                            const isSelected = selectedWinnerCandidate === player.name;
                                            return (
                                                <button
                                                    key={idx}
                                                    onClick={() => setSelectedWinnerCandidate(player.name)}
                                                    className={`w-full ${isSelected ? (theme === 'tron' ? 'bg-cyan-500/30 border-2 border-cyan-400 ring-2 ring-cyan-400' : theme === 'kids' ? 'bg-green-200 border-2 border-green-500 ring-2 ring-green-400' : 'bg-orange-600/40 border-2 border-orange-500 ring-2 ring-orange-400') : (theme === 'tron' ? 'bg-cyan-500/10 border border-cyan-500/30 hover:bg-cyan-500/20' : theme === 'kids' ? 'bg-purple-100 border-2 border-purple-300 hover:bg-purple-200' : 'bg-orange-900/20 border border-orange-700/50 hover:bg-orange-900/30')} rounded-lg p-3 transition-all`}
                                                >
                                                    <div className="flex items-center gap-3">
                                                        <div className="w-10 h-10 flex-shrink-0">
                                                            <CharacterSVG characterId={player.avatar} size={40} color={character.color} />
                                                        </div>
                                                        <div className={`font-bold text-sm ${currentTheme.text} flex-1 text-left`}>{player.name}</div>
                                                        {isSelected && (
                                                            <Check className={`w-5 h-5 ${theme === 'tron' ? 'text-cyan-400' : theme === 'kids' ? 'text-green-600' : 'text-orange-500'}`} />
                                                        )}
                                                    </div>
                                                </button>
                                            );
                                        })}
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => setShowPickWinner(false)}
                                            className={`flex-1 ${theme === 'tron' ? 'bg-gray-800 hover:bg-gray-700 text-cyan-400' : theme === 'kids' ? 'bg-purple-200 hover:bg-purple-300 text-purple-900' : 'bg-gray-800 hover:bg-gray-700 text-orange-400'} font-bold py-3 rounded-xl transition-all`}
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={() => selectedWinnerCandidate && selectWinner(selectedWinnerCandidate)}
                                            disabled={!selectedWinnerCandidate}
                                            className={`flex-1 ${selectedWinnerCandidate ? (theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black' : theme === 'kids' ? 'bg-green-500 hover:bg-green-400 text-white' : 'bg-orange-700 hover:bg-orange-600 text-white') : 'bg-gray-600 text-gray-400 cursor-not-allowed'} font-bold py-3 rounded-xl transition-all`}
                                        >
                                            Confirm
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Timer End Modal - Pick Winner */}
                        {showTimerEndModal && isDrawer && (
                            <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                <div className={`${currentTheme.cardBg} backdrop-blur-xl rounded-3xl p-6 md:p-8 max-w-2xl w-full max-h-[80vh] flex flex-col ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-4 border-purple-400' : 'border-4 border-orange-700'}`}>
                                    {/* Header */}
                                    <div className="text-center mb-4">
                                        <h2 className={`text-2xl md:text-3xl font-black ${currentTheme.text} mb-2 ${currentTheme.font}`}>
                                            {theme === 'tron' ? '> TIME_EXPIRED' : "Time's Up!"}
                                        </h2>
                                        <p className={`${currentTheme.textSecondary} text-sm md:text-base`}>
                                            The word was: <span className={`font-black ${currentTheme.text}`}>{currentWord}</span>
                                        </p>
                                        <p className={`${currentTheme.textSecondary} text-sm mt-2`}>
                                            Select a player to award the win, or choose No Winner
                                        </p>
                                    </div>

                                    {/* Player list with guesses */}
                                    <div className={`flex-1 overflow-y-auto space-y-2 mb-4 ${theme === 'tron' ? 'scrollbar-tron' : theme === 'kids' ? 'scrollbar-kids' : 'scrollbar-scary'}`}>
                                        {(() => {
                                            const players = currentRoom?.players.filter(p => p.name !== playerName) || [];
                                            if (players.length === 0) return (
                                                <div className={`${currentTheme.textSecondary} text-center py-8`}>No other players</div>
                                            );
                                            return players.map((player, idx) => {
                                                const character = availableCharacters.find(c => c.id === player.avatar) || availableCharacters[0];
                                                const playerGuesses = chatMessages.filter(m => m.player === player.name);
                                                const isSelected = selectedWinnerCandidate === player.name;
                                                return (
                                                    <button
                                                        key={idx}
                                                        onClick={() => setSelectedWinnerCandidate(player.name)}
                                                        className={`w-full ${isSelected ? (theme === 'tron' ? 'bg-cyan-500/30 border-2 border-cyan-400 ring-2 ring-cyan-400' : theme === 'kids' ? 'bg-green-200 border-2 border-green-500 ring-2 ring-green-400' : 'bg-orange-600/40 border-2 border-orange-500 ring-2 ring-orange-400') : (theme === 'tron' ? 'bg-cyan-500/10 border border-cyan-500/30 hover:bg-cyan-500/20' : theme === 'kids' ? 'bg-purple-100 border-2 border-purple-300 hover:bg-purple-200' : 'bg-orange-900/20 border border-orange-700/50 hover:bg-orange-900/30')} rounded-lg p-3 transition-all`}
                                                    >
                                                        <div className="flex items-center gap-3">
                                                            <div className="w-10 h-10 flex-shrink-0">
                                                                <CharacterSVG characterId={player.avatar} size={40} color={character.color} />
                                                            </div>
                                                            <div className="flex-1 text-left">
                                                                <div className={`font-bold text-sm ${currentTheme.text}`}>{player.name}</div>
                                                                {playerGuesses.length > 0 ? (
                                                                    <div className={`${currentTheme.textSecondary} text-xs mt-1`}>
                                                                        {playerGuesses.map(g => g.message).join(', ')}
                                                                    </div>
                                                                ) : (
                                                                    <div className={`${currentTheme.textSecondary} text-xs mt-1 italic`}>No guesses</div>
                                                                )}
                                                            </div>
                                                            {isSelected && (
                                                                <Check className={`w-5 h-5 ${theme === 'tron' ? 'text-cyan-400' : theme === 'kids' ? 'text-green-600' : 'text-orange-500'}`} />
                                                            )}
                                                        </div>
                                                    </button>
                                                );
                                            });
                                        })()}
                                    </div>

                                    {/* Action Buttons */}
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => setShowTimerEndModal(false)}
                                            className={`flex-1 ${theme === 'tron' ? 'bg-gray-800 hover:bg-gray-700 text-cyan-400' : theme === 'kids' ? 'bg-purple-200 hover:bg-purple-300 text-purple-900' : 'bg-gray-800 hover:bg-gray-700 text-orange-400'} font-bold py-3 rounded-xl transition-all`}
                                        >
                                            No Winner
                                        </button>
                                        <button
                                            onClick={() => selectedWinnerCandidate && selectWinner(selectedWinnerCandidate)}
                                            disabled={!selectedWinnerCandidate}
                                            className={`flex-1 ${selectedWinnerCandidate ? (theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black' : theme === 'kids' ? 'bg-green-500 hover:bg-green-400 text-white' : 'bg-orange-700 hover:bg-orange-600 text-white') : 'bg-gray-600 text-gray-400 cursor-not-allowed'} font-bold py-3 rounded-xl transition-all`}
                                        >
                                            Confirm Winner
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Players List at Bottom - Drawing Order */}
                        <div className={`${currentTheme.cardBg} backdrop-blur-lg rounded-xl md:rounded-2xl p-3 md:p-4 ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-2 md:border-4 border-purple-400' : 'border-2 border-orange-700'}`}>
                            <h3 className={`text-sm md:text-lg font-bold ${currentTheme.text} mb-3 ${currentTheme.font}`}>
                                {theme === 'tron' ? '> DRAWING_ORDER' : ' Drawing Order'}
                            </h3>
                            <div className="flex flex-wrap gap-2 md:gap-3">
                                {currentRoom?.players.map((player, idx) => {
                                    const character = availableCharacters.find(c => c.id === player.avatar) || availableCharacters[0];
                                    const isCurrentDrawer = isDrawer && player.name === playerName;
                                    const orderNumber = idx + 1;
                                    return (
                                        <div 
                                            key={idx}
                                            className={`${isCurrentDrawer ? (theme === 'tron' ? 'bg-cyan-500/30 border-2 border-cyan-400 ring-2 ring-cyan-400 scale-110' : theme === 'kids' ? 'bg-yellow-200 border-2 border-yellow-500 ring-2 ring-yellow-400 scale-110' : 'bg-orange-600/40 border-2 border-orange-500 ring-2 ring-orange-400 scale-110') : (theme === 'tron' ? 'bg-cyan-500/10 border border-cyan-500/30' : theme === 'kids' ? 'bg-purple-100 border-2 border-purple-300' : 'bg-orange-900/20 border border-orange-700/50')} rounded-lg p-2 flex items-center gap-2 transition-all relative`}
                                        >
                                            {/* Order Number Badge */}
                                            <div className={`absolute -top-2 -left-2 w-5 h-5 md:w-6 md:h-6 rounded-full ${isCurrentDrawer ? (theme === 'tron' ? 'bg-cyan-400 text-black' : theme === 'kids' ? 'bg-yellow-500 text-white' : 'bg-orange-500 text-white') : (theme === 'tron' ? 'bg-gray-700 text-cyan-400' : theme === 'kids' ? 'bg-purple-400 text-white' : 'bg-gray-800 text-orange-400')} font-bold text-xs flex items-center justify-center`}>
                                                {orderNumber}
                                            </div>
                                            
                                            <div className="w-10 h-10 md:w-12 md:h-12">
                                                <CharacterSVG characterId={player.avatar} size={48} color={character.color} />
                                            </div>
                                            <div className="flex-1 min-w-0">
                                                <div className={`font-bold text-xs md:text-sm ${currentTheme.text} truncate`}>{player.name}</div>
                                                {isCurrentDrawer && (
                                                    <div className={`text-[0.6rem] md:text-xs ${theme === 'tron' ? 'text-cyan-300' : theme === 'kids' ? 'text-yellow-700' : 'text-orange-400'} font-semibold`}>
                                                         Drawing Now
                                                    </div>
                                                )}
                                                {!isCurrentDrawer && (
                                                    <div className={`text-[0.6rem] md:text-xs ${currentTheme.textSecondary}`}>
                                                        {orderNumber === 1 && isDrawer ? 'Next' : `#${orderNumber}`}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        function GameRoomApp() {
            const [page, setPage] = useState('landing');
            const [showCreateInput, setShowCreateInput] = useState(false);
            const [showJoinInput, setShowJoinInput] = useState(false);
            const [roomName, setRoomName] = useState('Test Game Room');
            const [joinRoomId, setJoinRoomId] = useState('XU1V2');
            const [playerName, setPlayerName] = useState('Player');
            const [currentRoom, setCurrentRoom] = useState(null);
            const [isMaster, setIsMaster] = useState(false);
            const [showGameSelector, setShowGameSelector] = useState(false);
            const [selectedGames, setSelectedGames] = useState([]);
            const [countdown, setCountdown] = useState(3);
            const [currentGameIndex, setCurrentGameIndex] = useState(0);
            const [error, setError] = useState('');
            const [showMenu, setShowMenu] = useState(false);
            const [theme, setTheme] = useState('tron'); // 'tron', 'kids', or 'scary'
            const [isMuted, setIsMuted] = useState(false);
            const [numPlayers, setNumPlayers] = useState('');
            const [ageRange, setAgeRange] = useState('');
            const [minAge, setMinAge] = useState(5);
            const [maxAge, setMaxAge] = useState(18);
            const [minPlayers, setMinPlayers] = useState(1);
            const [maxPlayers, setMaxPlayers] = useState(16);
            const [sortBy, setSortBy] = useState('popular');
            const [selectorMinAge, setSelectorMinAge] = useState(5);
            const [selectorMaxAge, setSelectorMaxAge] = useState(18);
            const [selectorMinPlayers, setSelectorMinPlayers] = useState(1);
            const [selectorMaxPlayers, setSelectorMaxPlayers] = useState(16);
            const [selectorSortBy, setSelectorSortBy] = useState('popular');
            const [selectedGameInfo, setSelectedGameInfo] = useState(null);
            const [selectedGameDesc, setSelectedGameDesc] = useState(null);
            const [qrExpanded, setQrExpanded] = useState(false);
            const [selectedAvatar, setSelectedAvatar] = useState('meta');
            const [avatarPickerMode, setAvatarPickerMode] = useState(null); // null | 'initial' | 'change'
            const [avatarTimerCount, setAvatarTimerCount] = useState(30);
            const [avatarTakenToast, setAvatarTakenToast] = useState('');
            const [showMasterTips, setShowMasterTips] = useState(false);
            const [characterInfoModal, setCharacterInfoModal] = useState(null);
            const [lobbyChatMessages, setLobbyChatMessages] = useState([]);
            const [lobbyChatInput, setLobbyChatInput] = useState('');
            const [unreadCount, setUnreadCount] = useState(0);
            const [chatAutoScroll, setChatAutoScroll] = useState(true);
            const [showChatModal, setShowChatModal] = useState(false);
            const [isMobilePortrait, setIsMobilePortrait] = useState(() => window.matchMedia('(max-width: 767px) and (orientation: portrait)').matches);
            const [devToast, setDevToast] = useState('');
            const devFirstConnect = useRef(true);
            const audioRef = useRef(null);
            const qrRef = useRef(null);
            const qrSmallRef = useRef(null);
            const lobbyChatEndRef = useRef(null);
            const modalChatEndRef = useRef(null);
            const chatScrollRef = useRef(null);
            const modalChatScrollRef = useRef(null);

            // Themed character avatars
            const characterAvatars = {
                tron: [
                    // --- Common (10) - Unlocked by default ---
                    { id: 'cyber-knight', name: 'Cyber Knight', emoji: '', color: '#06b6d4', rarity: 'common', description: 'A standard-issue grid warrior. Reliable, sturdy, and ready for any game.', unlock: null },
                    { id: 'neon-ninja', name: 'Neon Ninja', emoji: '', color: '#3b82f6', rarity: 'common', description: 'Silent and swift, this ninja leaves only a blue trail in the data stream.', unlock: null },
                    { id: 'data-runner', name: 'Data Runner', emoji: '', color: '#8b5cf6', rarity: 'common', description: 'Fastest courier on the grid. Delivers packets before you blink.', unlock: null },
                    { id: 'circuit-breaker', name: 'Circuit Breaker', emoji: '', color: '#06b6d4', rarity: 'common', description: 'Disrupts enemy systems with a single pulse. Don\'t get too close.', unlock: null },
                    { id: 'byte-fighter', name: 'Byte Fighter', emoji: '', color: '#0ea5e9', rarity: 'common', description: 'Trained in 8-bit combat. Small but fierce.', unlock: null },
                    { id: 'pixel-warrior', name: 'Pixel Warrior', emoji: '', color: '#6366f1', rarity: 'common', description: 'Born from the arcade era. Every move is a classic.', unlock: null },
                    { id: 'tech-ghost', name: 'Tech Ghost', emoji: '', color: '#22d3ee', rarity: 'common', description: 'A phantom process that refuses to terminate. Haunts the RAM.', unlock: null },
                    { id: 'cyber-samurai', name: 'Cyber Samurai', emoji: '', color: '#3b82f6', rarity: 'common', description: 'Honour-bound digital ronin. Wields a light-blade with precision.', unlock: null },
                    { id: 'grid-master', name: 'Grid Master', emoji: '', color: '#06b6d4', rarity: 'common', description: 'Controls the game board itself. The grid bends to their will.', unlock: null },
                    { id: 'binary-ace', name: 'Binary Ace', emoji: '', color: '#0891b2', rarity: 'common', description: 'Thinks in ones and zeros. Always two steps ahead.', unlock: null },
                    // --- Uncommon (10) - Locked, easier unlocks ---
                    { id: 'volt-striker', name: 'Volt Striker', emoji: '', color: '#facc15', rarity: 'uncommon', description: 'Charged with raw energy. Each strike leaves a lingering spark.', unlock: 'Play your first game' },
                    { id: 'quantum-thief', name: 'Quantum Thief', emoji: '', color: '#a78bfa', rarity: 'uncommon', description: 'Exists in multiple states simultaneously. You can\'t catch what you can\'t observe.', unlock: 'Win a game' },
                    { id: 'plasma-drone', name: 'Plasma Drone', emoji: '', color: '#34d399', rarity: 'uncommon', description: 'An autonomous scout that maps the grid before anyone else arrives.', unlock: 'Create 3 rooms' },
                    { id: 'hex-coder', name: 'Hex Coder', emoji: '', color: '#f472b6', rarity: 'uncommon', description: 'Writes reality in hexadecimal. Bugs fear this one.', unlock: 'Send 25 chat messages' },
                    { id: 'ion-scout', name: 'Ion Scout', emoji: '', color: '#38bdf8', rarity: 'uncommon', description: 'Always scanning the horizon. First to spot incoming threats.', unlock: 'Join 5 different rooms' },
                    { id: 'wire-wraith', name: 'Wire Wraith', emoji: '', color: '#94a3b8', rarity: 'uncommon', description: 'A tangle of abandoned connections given sentience. Unsettling but effective.', unlock: 'Play a game with 4+ players' },
                    { id: 'signal-flare', name: 'Signal Flare', emoji: '', color: '#fb923c', rarity: 'uncommon', description: 'A walking broadcast tower. Allies always know where the action is.', unlock: 'Win 3 games' },
                    { id: 'core-sentinel', name: 'Core Sentinel', emoji: '', color: '#2dd4bf', rarity: 'uncommon', description: 'Guardian of the system kernel. Immovable and unbreakable.', unlock: 'Play 5 different game types' },
                    { id: 'glitch-fox', name: 'Glitch Fox', emoji: '', color: '#c084fc', rarity: 'uncommon', description: 'A digital fox that phases through firewalls. Cute but chaotic.', unlock: 'Win a game in under 60 seconds' },
                    { id: 'null-agent', name: 'Null Agent', emoji: '', color: '#e2e8f0', rarity: 'uncommon', description: 'Officially doesn\'t exist. Redacted from every database.', unlock: 'Play 10 games total' },
                    // --- Rare (5) - Locked, with extra visual flair ---
                    { id: 'prism-knight', name: 'Prism Knight', emoji: '', color: '#06b6d4', rarity: 'rare', description: 'Encased in crystalline armor that refracts light into deadly beams. Their shield can deflect any attack back at the sender.', unlock: 'Win 10 games and survive a tiebreaker' },
                    { id: 'void-archer', name: 'Void Archer', emoji: '', color: '#8b5cf6', rarity: 'rare', description: 'Fires arrows made of compressed null-space. Each shot tears a hole in the grid that repairs itself moments later.', unlock: 'Score first in 5 consecutive rounds' },
                    { id: 'neon-ronin', name: 'Neon Ronin', emoji: '', color: '#f43f5e', rarity: 'rare', description: 'A masterless samurai with a plasma katana that burns at 10,000 kelvin. Their blade leaves trails of molten light.', unlock: 'Win 5 games in a row' },
                    { id: 'data-alchemist', name: 'Data Alchemist', emoji: '', color: '#34d399', rarity: 'rare', description: 'Transmutes raw data into gold-tier code. Orbiting potions contain compressed algorithms worth more than entire servers.', unlock: 'Be in a room with 8+ players and win' },
                    { id: 'circuit-witch', name: 'Circuit Witch', emoji: '', color: '#a855f7', rarity: 'rare', description: 'Weaves spells from ethernet cables and forgotten protocols. Their digital robes shimmer with encrypted incantations.', unlock: 'Play a game at exactly midnight' },
                    // --- Legendary (5) - Locked, with glow/flame/large effects ---
                    { id: 'grid-phoenix', name: 'Grid Phoenix', emoji: '', color: '#f59e0b', rarity: 'legendary', description: 'Born from a catastrophic system crash, this immortal firebird rebuilds itself from corrupted data. Its flames purify any code they touch.', unlock: 'Win 50 games  rise from the data' },
                    { id: 'neon-titan', name: 'Neon Titan', emoji: '', color: '#06b6d4', rarity: 'legendary', description: 'A colossal entity that towers over the grid. Servers buckle under its footsteps. Its aura overclocks everything nearby.', unlock: 'Win 25 games in a single session' },
                    { id: 'cyber-bear', name: 'Cyber Bear', emoji: '', color: '#38bdf8', rarity: 'legendary', description: 'An ancient digital beast covered in circuit-pattern fur. Its roar crashes weak firewalls. Feared across every network.', unlock: 'Play 100 total games' },
                    { id: 'quantum-dragon', name: 'Quantum Dragon', emoji: '', color: '#a78bfa', rarity: 'legendary', description: 'A serpent woven from pure quantum threads. It exists in every timeline simultaneously, seeing all possible futures.', unlock: 'Achieve a perfect game with zero wrong answers' },
                    { id: 'omega-prime', name: 'Omega Prime', emoji: '', color: '#fbbf24', rarity: 'legendary', description: 'The final form. The last character. The one who mastered every challenge the grid could offer. Radiates pure, blinding energy.', unlock: 'Unlock all other characters' }
                ],
                kids: [
                    { id: 'happy-unicorn', name: 'Happy Unicorn', emoji: '', color: '#ec4899' },
                    { id: 'cool-fox', name: 'Cool Fox', emoji: '', color: '#f97316' },
                    { id: 'brave-lion', name: 'Brave Lion', emoji: '', color: '#eab308' },
                    { id: 'smart-panda', name: 'Smart Panda', emoji: '', color: '#6b7280' },
                    { id: 'silly-frog', name: 'Silly Frog', emoji: '', color: '#22c55e' },
                    { id: 'speedy-rabbit', name: 'Speedy Rabbit', emoji: '', color: '#a855f7' },
                    { id: 'friendly-bear', name: 'Friendly Bear', emoji: '', color: '#92400e' },
                    { id: 'magical-cat', name: 'Magical Cat', emoji: '', color: '#8b5cf6' },
                    { id: 'happy-penguin', name: 'Happy Penguin', emoji: '', color: '#0ea5e9' },
                    { id: 'rainbow-koala', name: 'Rainbow Koala', emoji: '', color: '#d946ef' },
                    { id: 'buzzy-bee', name: 'Buzzy Bee', emoji: '', color: '#facc15' },
                    { id: 'tiny-turtle', name: 'Tiny Turtle', emoji: '', color: '#4ade80' },
                    { id: 'dotty-ladybug', name: 'Dotty Ladybug', emoji: '', color: '#ef4444' },
                    { id: 'fluffy-sheep', name: 'Fluffy Sheep', emoji: '', color: '#cbd5e1' },
                    { id: 'jolly-dolphin', name: 'Jolly Dolphin', emoji: '', color: '#38bdf8' },
                    { id: 'cheeky-monkey', name: 'Cheeky Monkey', emoji: '', color: '#a16207' },
                    { id: 'snowy-owl', name: 'Snowy Owl', emoji: '', color: '#f8fafc' },
                    { id: 'lucky-clover', name: 'Lucky Clover', emoji: '', color: '#16a34a' },
                    { id: 'starry-fish', name: 'Starry Fish', emoji: '', color: '#fb923c' },
                    { id: 'candy-dragon', name: 'Candy Dragon', emoji: '', color: '#e879f9' }
                ],
                scary: [
                    { id: 'vampire-lord', name: 'Vampire Lord', emoji: '', color: '#dc2626' },
                    { id: 'howling-wolf', name: 'Howling Wolf', emoji: '', color: '#9333ea' },
                    { id: 'ghost-haunter', name: 'Ghost Haunter', emoji: '', color: '#6b7280' },
                    { id: 'zombie-king', name: 'Zombie King', emoji: '', color: '#65a30d' },
                    { id: 'witch-mage', name: 'Witch Mage', emoji: '', color: '#7c3aed' },
                    { id: 'skeleton-warrior', name: 'Skeleton Warrior', emoji: '', color: '#f5f5f5' },
                    { id: 'demon-hunter', name: 'Demon Hunter', emoji: '', color: '#b91c1c' },
                    { id: 'dark-wizard', name: 'Dark Wizard', emoji: '', color: '#581c87' },
                    { id: 'shadow-reaper', name: 'Shadow Reaper', emoji: '', color: '#1f2937' },
                    { id: 'cursed-mummy', name: 'Cursed Mummy', emoji: '', color: '#ca8a04' },
                    { id: 'bone-crawler', name: 'Bone Crawler', emoji: '', color: '#d4d4d8' },
                    { id: 'plague-doctor', name: 'Plague Doctor', emoji: '', color: '#525252' },
                    { id: 'blood-raven', name: 'Blood Raven', emoji: '', color: '#991b1b' },
                    { id: 'swamp-fiend', name: 'Swamp Fiend', emoji: '', color: '#4d7c0f' },
                    { id: 'night-stalker', name: 'Night Stalker', emoji: '', color: '#334155' },
                    { id: 'venom-spider', name: 'Venom Spider', emoji: '', color: '#7f1d1d' },
                    { id: 'tomb-keeper', name: 'Tomb Keeper', emoji: '', color: '#78716c' },
                    { id: 'banshee-wail', name: 'Banshee Wail', emoji: '', color: '#a5b4fc' },
                    { id: 'inferno-imp', name: 'Inferno Imp', emoji: '', color: '#ea580c' },
                    { id: 'crypt-wyrm', name: 'Crypt Wyrm', emoji: '', color: '#6b21a8' }
                ]
            };

            const availableCharacters = characterAvatars[theme] || characterAvatars.tron;

            const rarityConfig = {
                common:    { label: 'Common',    color: '#94a3b8', border: 'border-gray-500/40',   bg: 'bg-gray-500/10',    glow: '' },
                uncommon:  { label: 'Uncommon',  color: '#22c55e', border: 'border-green-500/40',  bg: 'bg-green-500/10',   glow: '' },
                rare:      { label: 'Rare',      color: '#8b5cf6', border: 'border-purple-500/50', bg: 'bg-purple-500/10',  glow: 'shadow-[0_0_12px_rgba(139,92,246,0.4)]' },
                legendary: { label: 'Legendary', color: '#f59e0b', border: 'border-yellow-500/50', bg: 'bg-yellow-500/10', glow: 'shadow-[0_0_20px_rgba(245,158,11,0.5)]' }
            };
            const takenCharacters = (currentRoom?.players.map(p => p.avatar) || []).filter(a => a !== 'meta');

            // Pre-created dummy room for development
            const dummyRoom = {
                id: 'XU1V2',
                name: "Anderson's Game Room",
                master: 'Anderson',
                players: [
                    { name: 'Anderson', isMaster: true, avatar: '' },
                    { name: 'Sarah', isMaster: false, avatar: '' },
                    { name: 'Mike', isMaster: false, avatar: '' },
                    { name: 'Emma', isMaster: false, avatar: '' }
                ],
                selectedGames: [1, 5, 9], // Trivia Master, Quick Math, Music Quiz
            };

            // Theme configurations
            const themes = {
                tron: {
                    bg: 'bg-black',
                    gradientFrom: 'from-black',
                    gradientVia: 'via-gray-900',
                    gradientTo: 'to-black',
                    text: 'text-cyan-400',
                    textSecondary: 'text-cyan-300',
                    accent: 'bg-cyan-500',
                    accentHover: 'hover:bg-cyan-400',
                    border: 'border-cyan-400',
                    glow: 'tron-glow',
                    font: 'font-orbitron',
                    cardBg: 'bg-gray-900/90',
                    headerBg: 'bg-black/90'
                },
                kids: {
                    bg: 'bg-gradient-to-br from-pink-300 via-purple-300 to-blue-300',
                    gradientFrom: 'from-pink-400',
                    gradientVia: 'via-purple-400',
                    gradientTo: 'to-blue-400',
                    text: 'text-purple-800',
                    textSecondary: 'text-purple-600',
                    accent: 'bg-pink-500',
                    accentHover: 'hover:bg-pink-400',
                    border: 'border-purple-400',
                    glow: 'kids-shadow',
                    font: 'font-quicksand',
                    cardBg: 'bg-white/90',
                    headerBg: 'bg-white/80'
                },
                scary: {
                    bg: 'bg-black',
                    gradientFrom: 'from-gray-900',
                    gradientVia: 'via-orange-950',
                    gradientTo: 'to-black',
                    text: 'text-orange-500',
                    textSecondary: 'text-orange-600',
                    accent: 'bg-orange-700',
                    accentHover: 'hover:bg-orange-600',
                    border: 'border-orange-700',
                    glow: 'shadow-[0_0_20px_rgba(194,65,12,0.6)]',
                    font: 'font-orbitron',
                    cardBg: 'bg-gray-950/95',
                    headerBg: 'bg-black/95'
                }
            };

            const currentTheme = themes[theme];

            // Dev toast: show when server restarts (socket reconnects)
            useEffect(() => {
                const onConnect = () => {
                    if (devFirstConnect.current) {
                        devFirstConnect.current = false;
                        return;
                    }
                    setDevToast('Server reloaded');
                    console.log(`Server refreshed  ${new Date().toLocaleTimeString()}`);
                    setTimeout(() => setDevToast(''), 10000);
                };
                socket.on('connect', onConnect);
                return () => socket.off('connect', onConnect);
            }, []);

            // Rejoin room on mount (after page refresh)
            useEffect(() => {
                const session = loadSession();
                if (!session || !session.roomId) return;

                // Restore local state immediately to prevent landing page flash
                setPlayerName(session.playerName || 'Player');
                setSelectedAvatar(session.avatar || 'cyber-knight');
                setIsMaster(session.isMaster || false);
                setTheme(session.theme || 'tron');
                setPage('rejoining');

                const attemptRejoin = () => {
                    socket.emit('rejoinRoom', {
                        roomId: session.roomId,
                        playerName: session.playerName,
                        avatar: session.avatar
                    });
                };

                if (socket.connected) {
                    attemptRejoin();
                } else {
                    socket.once('connect', attemptRejoin);
                }

                const onRejoinSuccess = (room) => {
                    setCurrentRoom(room);
                    setSelectedGames(room.selectedGames || []);
                    // Restore page  countdown is transient, fall back to room
                    const targetPage = session.page === 'game' ? 'game' : 'room';
                    setPage(targetPage);
                    console.log(`Rejoined room ${room.id} as ${session.playerName}`);
                };

                const onRejoinFailed = (data) => {
                    clearSession();
                    setPage('landing');
                    setIsMaster(false);
                    setError(data.message || 'Could not rejoin room');
                    setTimeout(() => setError(''), 4000);
                    console.log('Rejoin failed:', data.message);
                };

                socket.on('rejoinSuccess', onRejoinSuccess);
                socket.on('rejoinFailed', onRejoinFailed);

                return () => {
                    socket.off('rejoinSuccess', onRejoinSuccess);
                    socket.off('rejoinFailed', onRejoinFailed);
                };
            }, []);

            // Auto-save session whenever relevant state changes
            useEffect(() => {
                if (page === 'landing' || page === 'rejoining') return;
                if (!currentRoom) return;
                saveSession({
                    roomId: currentRoom.id,
                    playerName,
                    avatar: selectedAvatar,
                    isMaster,
                    theme,
                    page,
                    selectedGames
                });
            }, [currentRoom, playerName, selectedAvatar, isMaster, theme, page, selectedGames]);

            useEffect(() => {
                socket.on('roomCreated', (room) => {
                    setCurrentRoom(room);
                    setIsMaster(true);
                    setSelectedGames(room.selectedGames || []);
                    setPage('room');
                    setShowCreateInput(false);
                    setAvatarPickerMode('initial');
                    if (audioRef.current) {
                        audioRef.current.play();
                    }
                });

                socket.on('roomJoined', (room) => {
                    setCurrentRoom(room);
                    setIsMaster(false);
                    setSelectedGames(room.selectedGames || []);
                    setPage('room');
                    setShowJoinInput(false);
                    setAvatarPickerMode('initial');
                });

                socket.on('playerJoined', (data) => {
                    if (currentRoom && currentRoom.id === data.roomId) {
                        setCurrentRoom(prev => ({
                            ...prev,
                            players: [...prev.players, { name: data.player, isMaster: false, avatar: data.avatar }]
                        }));
                    }
                });

                socket.on('gamesUpdated', (data) => {
                    if (currentRoom && currentRoom.id === data.roomId) {
                        setSelectedGames(data.selectedGames);
                    }
                });

                socket.on('gameStarting', (data) => {
                    if (currentRoom && currentRoom.id === data.roomId) {
                        setPage('countdown');
                        let count = 3;
                        const timer = setInterval(() => {
                            count--;
                            setCountdown(count);
                            if (count === 0) {
                                clearInterval(timer);
                                setPage('game');
                            }
                        }, 1000);
                    }
                });

                socket.on('chatMessage', (data) => {
                    setLobbyChatMessages(prev => [...prev, data]);
                    const isMobilePortrait = window.matchMedia('(max-width: 767px) and (orientation: portrait)').matches;
                    if (isMobilePortrait) {
                        setShowChatModal(prev => {
                            if (!prev) setUnreadCount(c => c + 1);
                            return prev;
                        });
                    } else {
                        setChatAutoScroll(prev => {
                            if (!prev) setUnreadCount(c => c + 1);
                            return prev;
                        });
                    }
                });

                socket.on('error', (data) => {
                    setError(data.message);
                    setTimeout(() => setError(''), 3000);
                });

                socket.on('playerLeft', (data) => {
                    setCurrentRoom(prev => {
                        if (!prev || prev.id !== data.roomId) return prev;
                        return { ...prev, players: prev.players.filter(p => p.name !== data.playerName) };
                    });
                });

                socket.on('playerRejoined', (data) => {
                    setCurrentRoom(prev => {
                        if (!prev || prev.id !== data.roomId) return prev;
                        return {
                            ...prev,
                            players: prev.players.map(p =>
                                p.name === data.playerName ? { ...p, connected: true } : p
                            )
                        };
                    });
                });

                socket.on('avatarChanged', (data) => {
                    setCurrentRoom(prev => {
                        if (!prev || prev.id !== data.roomId) return prev;
                        return {
                            ...prev,
                            players: prev.players.map(p =>
                                p.name === data.playerName ? { ...p, avatar: data.avatar } : p
                            )
                        };
                    });
                });

                return () => {
                    socket.off('chatMessage');
                    socket.off('playerLeft');
                    socket.off('playerRejoined');
                    socket.off('avatarChanged');
                };
            }, [currentRoom]);

            // Track mobile portrait media query
            useEffect(() => {
                const mq = window.matchMedia('(max-width: 767px) and (orientation: portrait)');
                const handler = (e) => setIsMobilePortrait(e.matches);
                mq.addEventListener('change', handler);
                return () => mq.removeEventListener('change', handler);
            }, []);

            // Auto-fill room code from URL parameter
            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const roomParam = params.get('room');
                if (roomParam) {
                    setJoinRoomId(roomParam.toUpperCase());
                    setShowJoinInput(true);
                }
            }, []);

            // Generate QR codes when room page is visible and refs are available
            useEffect(() => {
                if (!currentRoom?.id || page !== 'room') return;
                const joinUrl = `${window.location.origin}/?room=${currentRoom.id}`;

                // Small delay to ensure the DOM ref is mounted
                const timer = setTimeout(() => {
                    if (qrSmallRef.current) {
                        qrSmallRef.current.innerHTML = '';
                        new QRCode(qrSmallRef.current, {
                            text: joinUrl,
                            width: 128,
                            height: 128,
                            colorDark: '#000000',
                            colorLight: '#ffffff',
                            correctLevel: QRCode.CorrectLevel.M
                        });
                    }
                }, 50);
                return () => clearTimeout(timer);
            }, [currentRoom?.id, page]);

            // Generate large QR code when modal opens
            useEffect(() => {
                if (!qrExpanded || !currentRoom?.id) return;
                const joinUrl = `${window.location.origin}/?room=${currentRoom.id}`;

                // Small delay to ensure the modal DOM is rendered
                const timer = setTimeout(() => {
                    if (qrRef.current) {
                        qrRef.current.innerHTML = '';
                        new QRCode(qrRef.current, {
                            text: joinUrl,
                            width: 256,
                            height: 256,
                            colorDark: '#000000',
                            colorLight: '#ffffff',
                            correctLevel: QRCode.CorrectLevel.M
                        });
                    }
                }, 50);
                return () => clearTimeout(timer);
            }, [qrExpanded, currentRoom?.id]);

            const handleCreateRoom = () => {
                if (roomName.trim() && playerName.trim()) {
                    socket.emit('createRoom', { roomName, playerName });
                }
            };

            const handleJoinRoom = () => {
                if (joinRoomId.trim() && playerName.trim()) {
                    socket.emit('joinRoom', { roomId: joinRoomId.toUpperCase(), playerName });
                }
            };

            const confirmAvatarSelection = () => {
                if (!selectedAvatar || selectedAvatar === 'meta') return;
                socket.emit('changeAvatar', { roomId: currentRoom.id, avatar: selectedAvatar });
                const wasInitial = avatarPickerMode === 'initial';
                setAvatarPickerMode(null);
                if (wasInitial && isMaster) {
                    setShowMasterTips(true);
                }
            };

            const toggleGame = (gameId) => {
                socket.emit('toggleGame', { roomId: currentRoom.id, gameId });
                setSelectedGames(prev => 
                    prev.includes(gameId) 
                        ? prev.filter(id => id !== gameId)
                        : [...prev, gameId]
                );
            };

            const sendLobbyChat = () => {
                if (!lobbyChatInput.trim() || !currentRoom) return;
                socket.emit('chatMessage', { roomId: currentRoom.id, message: lobbyChatInput.trim() });
                setLobbyChatInput('');
            };

            // Smart auto-scroll lobby chat
            const handleChatScroll = () => {
                const el = chatScrollRef.current;
                if (!el) return;
                const atBottom = el.scrollHeight - el.scrollTop - el.clientHeight < 40;
                setChatAutoScroll(atBottom);
                if (atBottom) setUnreadCount(0);
            };

            const scrollChatToBottom = () => {
                const el = chatScrollRef.current;
                if (el) {
                    el.scrollTop = el.scrollHeight;
                    setChatAutoScroll(true);
                }
            };

            useEffect(() => {
                if (chatAutoScroll) {
                    lobbyChatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
                    modalChatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
                }
            }, [lobbyChatMessages, chatAutoScroll]);

            const startGame = () => {
                if (selectedGames.length > 0) {
                    socket.emit('startGame', { roomId: currentRoom.id });
                }
            };

            // Avatar selection countdown  ticks down when in initial mode
            useEffect(() => {
                if (avatarPickerMode !== 'initial') return;
                setAvatarTimerCount(30);
                const interval = setInterval(() => {
                    setAvatarTimerCount(prev => prev <= 1 ? 0 : prev - 1);
                }, 1000);
                return () => clearInterval(interval);
            }, [avatarPickerMode]);

            // Kick player when timer reaches 0
            useEffect(() => {
                if (avatarTimerCount !== 0 || avatarPickerMode !== 'initial') return;
                setAvatarPickerMode(null);
                clearSession();
                setPage('landing');
                setCurrentRoom(null);
                setIsMaster(false);
                setSelectedAvatar('meta');
                setError('Kicked  you did not select an avatar in time');
                setTimeout(() => setError(''), 4000);
            }, [avatarTimerCount]);

            const goToLanding = () => {
                clearSession();
                setPage('landing');
                setCurrentRoom(null);
                setIsMaster(false);
                setShowMenu(false);
                setShowCreateInput(false);
                setShowJoinInput(false);
                setSelectedGames([]);
                setAvatarPickerMode(null);
                setSelectedAvatar('meta');
                if (audioRef.current) {
                    audioRef.current.pause();
                    audioRef.current.currentTime = 0;
                }
            };

            const toggleTheme = () => {
                setTheme(prev => {
                    if (prev === 'tron') return 'kids';
                    if (prev === 'kids') return 'scary';
                    return 'tron';
                });
            };

            const StarRating = ({ rating }) => {
                const stars = [];
                for (let i = 1; i <= 5; i++) {
                    stars.push(
                        <Star key={i} className="star inline" filled={i <= Math.floor(rating)} />
                    );
                }
                return <div className="flex items-center gap-1">{stars} <span className="text-xs ml-1">{rating}</span></div>;
            };

            // Header Component
            const Header = () => (
                <>
                {devToast && (
                    <div className={`fixed top-2 left-1/2 -translate-x-1/2 z-[100] text-xs font-bold px-3 py-1 rounded-full shadow-lg ${currentTheme.font} ${theme === 'tron' ? 'bg-cyan-500/90 text-black tron-glow' : theme === 'kids' ? 'bg-purple-500 text-white kids-shadow' : 'bg-orange-700/90 text-white shadow-[0_0_15px_rgba(234,88,12,0.6)]'}`} style={{ animation: 'fadeToast 10s ease-in-out forwards' }}>
                        {theme === 'tron' ? '> ' : ''}{devToast}{theme === 'tron' ? ' _' : ''}
                    </div>
                )}
                <header className={`fixed top-0 left-0 right-0 z-50 ${currentTheme.headerBg} backdrop-blur-lg ${theme === 'tron' ? 'border-b border-cyan-500/30' : 'border-b-4 border-purple-300'}`}>
                    <div className="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
                        <button 
                            onClick={goToLanding}
                            className="flex items-center gap-3 hover:opacity-80 transition-opacity group"
                        >
                            <div className={`hidden md:block w-16 h-16 ${theme === 'tron' ? 'bg-cyan-500/20 tron-border' : theme === 'kids' ? 'bg-gradient-to-br from-pink-400 to-purple-500 kids-shadow' : 'bg-orange-900/40 border-2 border-orange-700'} rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform p-2`}>
                                {theme === 'tron' ? (
                                    <DaftPunkRobotHead className={`w-full h-full text-cyan-400`} />
                                ) : theme === 'kids' ? (
                                    <DaftPunkHelmet className={`w-full h-full text-white`} />
                                ) : (
                                    <WerewolfHowlingIcon className={`w-full h-full text-orange-500`} />
                                )}
                            </div>
                            <span className={`${currentTheme.text} font-bold text-xl md:text-2xl ${currentTheme.font} ${theme === 'tron' ? 'tron-text-glow' : ''}`}>
                                GameHub
                            </span>
                        </button>

                        <div className="flex items-center gap-2">
                            {/* Theme Dropdown */}
                            <div className="relative">
                                <select
                                    value={theme}
                                    onChange={(e) => setTheme(e.target.value)}
                                    className={`appearance-none w-10 h-10 md:w-auto md:h-12 md:pl-10 md:pr-4 ${theme === 'tron' ? 'bg-cyan-500/20 tron-border' : theme === 'kids' ? 'bg-purple-500' : 'bg-orange-700/40 border-2 border-orange-700'} rounded-xl font-semibold transition-all hover:scale-105 cursor-pointer focus:outline-none focus:ring-2 ${theme === 'tron' ? 'focus:ring-cyan-400' : theme === 'kids' ? 'focus:ring-purple-400' : 'focus:ring-orange-500'} text-transparent md:text-current ${theme === 'tron' ? 'md:text-cyan-400' : theme === 'kids' ? 'md:text-white' : 'md:text-orange-400'}`}
                                >
                                    <option value="tron" className={`${theme === 'tron' ? 'bg-gray-900 text-cyan-400' : theme === 'kids' ? 'bg-purple-100 text-purple-900' : 'bg-gray-900 text-orange-400'}`}>Tron</option>
                                    <option value="kids" className={`${theme === 'tron' ? 'bg-gray-900 text-cyan-400' : theme === 'kids' ? 'bg-purple-100 text-purple-900' : 'bg-gray-900 text-orange-400'}`}>Kids</option>
                                    <option value="scary" className={`${theme === 'tron' ? 'bg-gray-900 text-cyan-400' : theme === 'kids' ? 'bg-purple-100 text-purple-900' : 'bg-gray-900 text-orange-400'}`}>Scary</option>
                                </select>
                                {/* Palette Icon Overlay */}
                                <div className="absolute inset-0 flex items-center justify-center md:justify-start md:pl-3 pointer-events-none">
                                    <Palette className={`w-5 h-5 md:w-6 md:h-6 ${theme === 'tron' ? 'text-cyan-400' : theme === 'kids' ? 'text-white' : 'text-orange-400'}`} />
                                </div>
                            </div>

                            {/* Mute Button */}
                            <button
                                onClick={() => setIsMuted(!isMuted)}
                                className={`w-10 h-10 md:w-12 md:h-12 ${theme === 'tron' ? 'bg-cyan-500/20 tron-border text-cyan-400' : theme === 'kids' ? 'bg-purple-500 text-white' : 'bg-orange-700/40 text-orange-400 border-2 border-orange-700'} rounded-xl flex items-center justify-center transition-all hover:scale-105`}
                                title={isMuted ? 'Unmute' : 'Mute'}
                            >
                                {isMuted ? (
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                        <line x1="23" y1="9" x2="17" y2="15"></line>
                                        <line x1="17" y1="9" x2="23" y2="15"></line>
                                    </svg>
                                ) : (
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                    </svg>
                                )}
                            </button>
                            
                            <button
                                onClick={() => setShowMenu(!showMenu)}
                                className={`w-10 h-10 md:w-12 md:h-12 ${theme === 'tron' ? 'bg-cyan-500/20 tron-border text-cyan-400' : theme === 'kids' ? 'bg-purple-500 text-white' : 'bg-orange-700/40 text-orange-400 border-2 border-orange-700'} rounded-xl flex items-center justify-center transition-all hover:scale-105`}
                            >
                                <Menu className="w-5 h-5 md:w-6 md:h-6" />
                            </button>
                        </div>
                    </div>

                    {showMenu && (
                        <div className={`absolute top-full right-4 mt-2 w-64 ${currentTheme.cardBg} backdrop-blur-xl rounded-2xl ${theme === 'tron' ? 'tron-border' : 'border-4 border-purple-300'} shadow-2xl overflow-hidden`}>
                            <div className="p-2">
                                <button
                                    onClick={goToLanding}
                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 ${currentTheme.text} transition-all group`}
                                >
                                    <Home className="w-5 h-5 group-hover:scale-110 transition-transform" />
                                    <span className="font-medium">Home</span>
                                </button>
                                
                                <button
                                    onClick={() => setShowMenu(false)}
                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 ${currentTheme.text} transition-all group`}
                                >
                                    <User className="w-5 h-5 group-hover:scale-110 transition-transform" />
                                    <span className="font-medium">Profile</span>
                                </button>

                                <button
                                    onClick={() => setShowMenu(false)}
                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 ${currentTheme.text} transition-all group`}
                                >
                                    <Settings className="w-5 h-5 group-hover:scale-110 transition-transform" />
                                    <span className="font-medium">Settings</span>
                                </button>

                                <button
                                    onClick={() => setShowMenu(false)}
                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 ${currentTheme.text} transition-all group`}
                                >
                                    <HelpCircle className="w-5 h-5 group-hover:scale-110 transition-transform" />
                                    <span className="font-medium">Help & Support</span>
                                </button>

                                <div className={`my-2 border-t ${theme === 'tron' ? 'border-cyan-500/30' : 'border-purple-300'}`}></div>

                                <button
                                    onClick={() => setShowMenu(false)}
                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl ${theme === 'tron' ? 'hover:bg-red-500/20 text-red-400' : 'hover:bg-red-200 text-red-600'} transition-all group`}
                                >
                                    <LogOut className="w-5 h-5 group-hover:scale-110 transition-transform" />
                                    <span className="font-medium">Log Out</span>
                                </button>
                            </div>
                        </div>
                    )}
                </header>
                </>
            );

            // Rejoining Page (brief loading screen during reconnect)
            if (page === 'rejoining') {
                return (
                    <div className={`min-h-screen ${theme === 'tron' ? 'bg-black tron-grid' : theme === 'kids' ? 'bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200' : 'bg-gradient-to-br from-gray-900 via-orange-950 to-black'} flex flex-col items-center justify-center p-4`} style={{ minHeight: '100dvh' }}>
                        <div className={`text-center`}>
                            <div className={`inline-block p-4 md:p-6 ${theme === 'tron' ? 'bg-cyan-500/10 tron-border' : theme === 'kids' ? 'bg-white kids-shadow' : 'bg-orange-900/40 border-4 border-orange-700'} rounded-2xl md:rounded-3xl mb-6`}>
                                {theme === 'tron' ? (
                                    <DaftPunkRobotHead className="w-16 h-16 md:w-24 md:h-24 text-cyan-400" />
                                ) : theme === 'kids' ? (
                                    <DaftPunkHelmet className="w-16 h-16 md:w-24 md:h-24 text-purple-600" />
                                ) : (
                                    <WerewolfHowlingIcon className="w-16 h-16 md:w-24 md:h-24 text-orange-500" />
                                )}
                            </div>
                            <h2 className={`${currentTheme.text} text-xl md:text-2xl font-bold ${currentTheme.font} mb-3`} style={{ animation: 'softPulse 2s ease-in-out infinite' }}>
                                {theme === 'tron' ? '> RECONNECTING...' : theme === 'kids' ? 'Coming back!' : 'Returning...'}
                            </h2>
                            <p className={`${currentTheme.textSecondary} text-sm`}>Reconnecting to room...</p>
                        </div>
                    </div>
                );
            }

            // Landing Page
            if (page === 'landing') {
                return (
                    <>
                        <Header />
                        <div className={`min-h-screen ${theme === 'tron' ? 'bg-black tron-grid' : theme === 'kids' ? 'bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200' : 'bg-gradient-to-br from-gray-900 via-orange-950 to-black'} flex flex-col items-center justify-center p-4 pt-28`}>
                            <div className="relative max-w-7xl w-full">
                                <div className={`text-center mb-8 md:mb-12`}>
                                    <div className={`inline-block p-4 md:p-6 ${theme === 'tron' ? 'bg-cyan-500/10 tron-border' : theme === 'kids' ? 'bg-white kids-shadow' : 'bg-orange-900/40 border-4 border-orange-700'} rounded-2xl md:rounded-3xl mb-4 md:mb-6 ${theme === 'kids' ? 'kids-icon-float' : ''}`}>
                                        {theme === 'tron' ? (
                                            <DaftPunkRobotHead className={`w-16 h-16 md:w-24 md:h-24 text-cyan-400`} />
                                        ) : theme === 'kids' ? (
                                            <DaftPunkHelmet className={`w-16 h-16 md:w-24 md:h-24 text-purple-600`} />
                                        ) : (
                                            <WerewolfHowlingIcon className={`w-16 h-16 md:w-24 md:h-24 text-orange-500`} />
                                        )}
                                    </div>
                                    <h1 className={`text-5xl md:text-7xl font-black ${currentTheme.text} mb-2 md:mb-3 tracking-tight ${currentTheme.font} ${theme === 'tron' ? 'tron-text-glow' : ''}`} style={theme === 'tron' ? { animation: 'softPulse 3s ease-in-out infinite' } : {}}>
                                        GameHub
                                    </h1>
                                    <p className={`${currentTheme.textSecondary} text-lg md:text-xl font-light mb-6`}>
                                        {theme === 'tron' ? 'Connect. Compete. Conquer.' : theme === 'kids' ? 'Play Together, Have Fun! ' : 'Enter If You Dare... '}
                                    </p>
                                    
                                    {/* Dev Buttons */}
                                    <div className="flex flex-wrap justify-center gap-2">
                                        <button
                                            onClick={() => {
                                                const testRoom = {
                                                    id: 'TEST123',
                                                    name: 'Quick Test Room',
                                                    master: 'You',
                                                    players: [
                                                        { name: 'You', isMaster: true, avatar: 'cyber-knight' },
                                                        { name: 'Sarah', isMaster: false, avatar: 'neon-ninja' },
                                                        { name: 'Mike', isMaster: false, avatar: 'data-runner' },
                                                        { name: 'Emma', isMaster: false, avatar: 'circuit-breaker' }
                                                    ],
                                                    selectedGames: [1]
                                                };
                                                setCurrentRoom(testRoom);
                                                setIsMaster(true);
                                                setPlayerName('You');
                                                setSelectedAvatar('cyber-knight');
                                                setPage('game');
                                            }}
                                            className={`${theme === 'tron' ? 'bg-green-500/90 hover:bg-green-400 text-black' : theme === 'kids' ? 'bg-green-400 hover:bg-green-300 text-white' : 'bg-green-700 hover:bg-green-600 text-white'} font-bold py-2 px-4 rounded-xl transition-all text-xs opacity-60 hover:opacity-100`}
                                        >
                                            DEV: Pictionary
                                        </button>
                                        <button
                                            onClick={() => {
                                                const devRoom = {
                                                    id: 'DEV001',
                                                    name: 'Dev Master Room',
                                                    master: 'You',
                                                    players: [
                                                        { name: 'You', isMaster: true, avatar: 'cyber-knight' },
                                                        { name: 'Sarah', isMaster: false, avatar: 'neon-ninja' },
                                                        { name: 'Mike', isMaster: false, avatar: 'data-runner' },
                                                        { name: 'Emma', isMaster: false, avatar: 'circuit-breaker' },
                                                        { name: 'James', isMaster: false, avatar: 'byte-fighter' },
                                                        { name: 'Olivia', isMaster: false, avatar: 'pixel-warrior' },
                                                        { name: 'Liam', isMaster: false, avatar: 'tech-ghost' },
                                                        { name: 'Sophia', isMaster: false, avatar: 'cyber-samurai' }
                                                    ],
                                                    selectedGames: [1, 2, 3, 4, 5, 6, 7]
                                                };
                                                setCurrentRoom(devRoom);
                                                setIsMaster(true);
                                                setPlayerName('You');
                                                setSelectedAvatar('cyber-knight');
                                                setSelectedGames([1, 2, 3, 4, 5, 6, 7]);
                                                setPage('room');
                                            }}
                                            className={`${theme === 'tron' ? 'bg-cyan-500/90 hover:bg-cyan-400 text-black' : theme === 'kids' ? 'bg-purple-400 hover:bg-purple-300 text-white' : 'bg-orange-700 hover:bg-orange-600 text-white'} font-bold py-2 px-4 rounded-xl transition-all text-xs opacity-60 hover:opacity-100`}
                                        >
                                            DEV: Master Room
                                        </button>
                                        <button
                                            onClick={() => {
                                                const devRoom = {
                                                    id: 'DEV002',
                                                    name: 'Dev Player Room',
                                                    master: 'GameMaster',
                                                    players: [
                                                        { name: 'GameMaster', isMaster: true, avatar: 'grid-master' },
                                                        { name: 'You', isMaster: false, avatar: 'neon-ninja' },
                                                        { name: 'Sarah', isMaster: false, avatar: 'data-runner' },
                                                        { name: 'Mike', isMaster: false, avatar: 'circuit-breaker' },
                                                        { name: 'Emma', isMaster: false, avatar: 'byte-fighter' },
                                                        { name: 'James', isMaster: false, avatar: 'pixel-warrior' },
                                                        { name: 'Olivia', isMaster: false, avatar: 'tech-ghost' },
                                                        { name: 'Sophia', isMaster: false, avatar: 'cyber-samurai' }
                                                    ],
                                                    selectedGames: [1, 2, 3]
                                                };
                                                setCurrentRoom(devRoom);
                                                setIsMaster(false);
                                                setPlayerName('You');
                                                setSelectedAvatar('neon-ninja');
                                                setSelectedGames([1, 2, 3]);
                                                setPage('room');
                                            }}
                                            className={`${theme === 'tron' ? 'bg-blue-500/90 hover:bg-blue-400 text-black' : theme === 'kids' ? 'bg-blue-400 hover:bg-blue-300 text-white' : 'bg-blue-700 hover:bg-blue-600 text-white'} font-bold py-2 px-4 rounded-xl transition-all text-xs opacity-60 hover:opacity-100`}
                                        >
                                            DEV: Join as Player
                                        </button>
                                    </div>
                                </div>

                                {error && (
                                    <div className={`mb-4 p-4 ${theme === 'tron' ? 'bg-red-500/20 border border-red-400' : 'bg-red-200 border-4 border-red-400'} rounded-2xl ${currentTheme.text} text-center`}>
                                        {error}
                                    </div>
                                )}

                                <div className="space-y-4 mb-12">
                                    {!showCreateInput && !showJoinInput && (
                                        <>
                                            <button
                                                onClick={() => setShowCreateInput(true)}
                                                className={`w-full ${theme === 'tron' ? 'bg-cyan-500/90 hover:bg-cyan-400 text-black tron-glow' : theme === 'kids' ? 'bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-400 hover:to-purple-400 text-white kids-shadow' : 'bg-orange-700 hover:bg-orange-600 text-white shadow-[0_0_20px_rgba(194,65,12,0.5)]'} font-bold py-6 px-8 rounded-2xl transition-all duration-300 hover:scale-105 group ${currentTheme.font}`}
                                            >
                                                <div className="flex items-center justify-center gap-3">
                                                    <Crown className="w-7 h-7 group-hover:rotate-12 transition-transform" />
                                                    <span className="text-2xl">{theme === 'tron' ? '[ CREATE_ROOM ]' : theme === 'kids' ? 'Create Game Room' : 'CREATE ROOM'}</span>
                                                </div>
                                            </button>

                                            <button
                                                onClick={() => setShowJoinInput(true)}
                                                className={`w-full ${theme === 'tron' ? 'bg-gray-900 hover:bg-gray-800 text-cyan-400 tron-border' : theme === 'kids' ? 'bg-white hover:bg-purple-50 text-purple-600 border-4 border-purple-400 kids-shadow' : 'bg-gray-900 hover:bg-gray-800 text-orange-400 border-2 border-orange-700 shadow-[0_0_15px_rgba(194,65,12,0.3)]'} font-bold py-6 px-8 rounded-2xl transition-all duration-300 hover:scale-105 group ${currentTheme.font}`}
                                            >
                                                <div className="flex items-center justify-center gap-3">
                                                    <Users className="w-7 h-7 group-hover:scale-110 transition-transform" />
                                                    <span className="text-2xl">{theme === 'tron' ? '[ JOIN_ROOM ]' : theme === 'kids' ? 'Join Existing Room' : 'JOIN ROOM'}</span>
                                                </div>
                                            </button>
                                        </>
                                    )}

                                    {showCreateInput && (
                                        <div className={`${currentTheme.cardBg} backdrop-blur-lg p-6 rounded-2xl ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-4 border-purple-300' : 'border-4 border-orange-700'}`}>
                                            <input
                                                type="text"
                                                placeholder={theme === 'tron' ? '> Room name...' : theme === 'kids' ? 'Room name (e.g. Fun Zone)' : 'Room name...'}
                                                value={roomName}
                                                onChange={(e) => setRoomName(e.target.value)}
                                                maxLength={20}
                                                className={`w-full px-4 py-3 mb-3 rounded-xl ${theme === 'tron' ? 'bg-black text-cyan-400 border border-cyan-500 placeholder-cyan-600' : theme === 'scary' ? 'bg-gray-900 text-orange-400 border-2 border-orange-700 placeholder-orange-700' : 'bg-white text-purple-900 border-2 border-purple-300 placeholder-purple-400'} focus:outline-none focus:ring-2 ${theme === 'tron' ? 'focus:ring-cyan-400' : theme === 'scary' ? 'focus:ring-orange-600' : 'focus:ring-purple-500'}`}
                                            />
                                            <input
                                                type="text"
                                                placeholder={theme === 'tron' ? '> Your name...' : theme === 'kids' ? 'Your name (e.g. Alex)' : 'Your name...'}
                                                value={playerName}
                                                onChange={(e) => setPlayerName(e.target.value)}
                                                maxLength={20}
                                                className={`w-full px-4 py-3 mb-4 rounded-xl ${theme === 'tron' ? 'bg-black text-cyan-400 border border-cyan-500 placeholder-cyan-600' : theme === 'scary' ? 'bg-gray-900 text-orange-400 border-2 border-orange-700 placeholder-orange-700' : 'bg-white text-purple-900 border-2 border-purple-300 placeholder-purple-400'} focus:outline-none focus:ring-2 ${theme === 'tron' ? 'focus:ring-cyan-400' : theme === 'scary' ? 'focus:ring-orange-600' : 'focus:ring-purple-500'}`}
                                            />
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={handleCreateRoom}
                                                    className={`flex-1 ${theme === 'tron' ? 'bg-green-500 hover:bg-green-400 text-black' : theme === 'scary' ? 'bg-green-700 hover:bg-green-600 text-white' : 'bg-green-400 hover:bg-green-300 text-white'} font-bold py-3 rounded-xl transition-all`}
                                                >
                                                    {theme === 'tron' ? '[ CREATE ]' : theme === 'scary' ? 'CREATE' : 'Create'}
                                                </button>
                                                <button
                                                    onClick={() => setShowCreateInput(false)}
                                                    className={`px-6 ${theme === 'tron' ? 'bg-gray-800 hover:bg-gray-700 text-cyan-400' : theme === 'scary' ? 'bg-gray-800 hover:bg-gray-700 text-orange-400' : 'bg-purple-200 hover:bg-purple-300 text-purple-900'} font-bold py-3 rounded-xl transition-all`}
                                                >
                                                    {theme === 'tron' ? '[ CANCEL ]' : theme === 'scary' ? 'CANCEL' : 'Cancel'}
                                                </button>
                                            </div>
                                        </div>
                                    )}

                                    {showJoinInput && (
                                        <div className={`${currentTheme.cardBg} backdrop-blur-lg p-6 rounded-2xl ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-4 border-purple-300' : 'border-4 border-orange-700'}`}>
                                            <input
                                                type="text"
                                                placeholder={theme === 'tron' ? '> Room code (e.g. AB12CD)' : theme === 'kids' ? 'Room code (e.g. AB12CD)' : 'Room code (e.g. AB12CD)'}
                                                value={joinRoomId}
                                                onChange={(e) => setJoinRoomId(e.target.value.toUpperCase())}
                                                maxLength={20}
                                                className={`w-full px-4 py-3 mb-3 rounded-xl ${theme === 'tron' ? 'bg-black text-cyan-400 border border-cyan-500 placeholder-cyan-600' : theme === 'scary' ? 'bg-gray-900 text-orange-400 border-2 border-orange-700 placeholder-orange-700' : 'bg-white text-purple-900 border-2 border-purple-300 placeholder-purple-400'} focus:outline-none focus:ring-2 ${theme === 'tron' ? 'focus:ring-cyan-400' : theme === 'scary' ? 'focus:ring-orange-600' : 'focus:ring-purple-500'} uppercase`}
                                            />
                                            <input
                                                type="text"
                                                placeholder={theme === 'tron' ? '> Your name...' : theme === 'kids' ? 'Your name (e.g. Alex)' : 'Your name...'}
                                                value={playerName}
                                                onChange={(e) => setPlayerName(e.target.value)}
                                                maxLength={20}
                                                className={`w-full px-4 py-3 mb-4 rounded-xl ${theme === 'tron' ? 'bg-black text-cyan-400 border border-cyan-500 placeholder-cyan-600' : theme === 'scary' ? 'bg-gray-900 text-orange-400 border-2 border-orange-700 placeholder-orange-700' : 'bg-white text-purple-900 border-2 border-purple-300 placeholder-purple-400'} focus:outline-none focus:ring-2 ${theme === 'tron' ? 'focus:ring-cyan-400' : theme === 'scary' ? 'focus:ring-orange-600' : 'focus:ring-purple-500'}`}
                                            />
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={handleJoinRoom}
                                                    className={`flex-1 ${theme === 'tron' ? 'bg-blue-500 hover:bg-blue-400 text-black' : theme === 'scary' ? 'bg-orange-700 hover:bg-orange-600 text-white' : 'bg-blue-400 hover:bg-blue-300 text-white'} font-bold py-3 rounded-xl transition-all`}
                                                >
                                                    {theme === 'tron' ? '[ JOIN ]' : theme === 'scary' ? 'ENTER' : 'Join'}
                                                </button>
                                                <button
                                                    onClick={() => setShowJoinInput(false)}
                                                    className={`px-6 ${theme === 'tron' ? 'bg-gray-800 hover:bg-gray-700 text-cyan-400' : theme === 'scary' ? 'bg-gray-800 hover:bg-gray-700 text-orange-400' : 'bg-purple-200 hover:bg-purple-300 text-purple-900'} font-bold py-3 rounded-xl transition-all`}
                                                >
                                                    {theme === 'tron' ? '[ CANCEL ]' : theme === 'scary' ? 'CANCEL' : 'Cancel'}
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* How It Works Section */}
                                <div className={`${currentTheme.cardBg} backdrop-blur-lg p-4 md:p-8 rounded-3xl ${theme === 'tron' ? 'tron-border' : 'border-4 border-purple-300'} mb-8 md:mb-12`}>
                                    <h2 className={`text-2xl md:text-3xl font-bold ${currentTheme.text} mb-4 md:mb-8 text-center ${currentTheme.font}`}>
                                        {theme === 'tron' ? '> SYSTEM_PROTOCOL' : theme === 'kids' ? 'How It Works ' : 'THE RITUAL '}
                                    </h2>
                                    
                                    <div className="grid grid-cols-4 gap-2 md:gap-6">
                                        <div className="text-center">
                                            <div className={`w-12 h-12 md:w-20 md:h-20 mx-auto mb-2 md:mb-4 ${theme === 'tron' ? 'bg-cyan-500/20 tron-border' : 'bg-purple-200 border-2 md:border-4 border-purple-400'} rounded-xl md:rounded-2xl flex items-center justify-center ${theme === 'kids' ? 'kids-bubble' : ''}`}>
                                                <Crown className={`w-6 h-6 md:w-10 md:h-10 ${currentTheme.text}`} />
                                            </div>
                                            <h3 className={`text-xs md:text-lg font-bold ${currentTheme.text} mb-1 md:mb-2 ${currentTheme.font}`}>
                                                1. Create
                                            </h3>
                                            <p className={`${currentTheme.textSecondary} text-[0.65rem] md:text-sm hidden md:block`}>
                                                {theme === 'tron' ? 'Set up your game room' : 'Set up your game room in seconds'}
                                            </p>
                                        </div>
                                        
                                        <div className="text-center">
                                            <div className={`w-12 h-12 md:w-20 md:h-20 mx-auto mb-2 md:mb-4 ${theme === 'tron' ? 'bg-cyan-500/20 tron-border' : 'bg-purple-200 border-2 md:border-4 border-purple-400'} rounded-xl md:rounded-2xl flex items-center justify-center ${theme === 'kids' ? 'kids-bubble' : ''}`} style={{ animationDelay: '0.2s' }}>
                                                <Users className={`w-6 h-6 md:w-10 md:h-10 ${currentTheme.text}`} />
                                            </div>
                                            <h3 className={`text-xs md:text-lg font-bold ${currentTheme.text} mb-1 md:mb-2 ${currentTheme.font}`}>
                                                2. Join
                                            </h3>
                                            <p className={`${currentTheme.textSecondary} text-[0.65rem] md:text-sm hidden md:block`}>
                                                {theme === 'tron' ? 'Share room code or QR' : 'Share the code or QR code'}
                                            </p>
                                        </div>
                                        
                                        <div className="text-center">
                                            <div className={`w-12 h-12 md:w-20 md:h-20 mx-auto mb-2 md:mb-4 ${theme === 'tron' ? 'bg-cyan-500/20 tron-border' : 'bg-purple-200 border-2 md:border-4 border-purple-400'} rounded-xl md:rounded-2xl flex items-center justify-center ${theme === 'kids' ? 'kids-bubble' : ''}`} style={{ animationDelay: '0.4s' }}>
                                                <Gamepad2 className={`w-6 h-6 md:w-10 md:h-10 ${currentTheme.text}`} strokeWidth={2} />
                                            </div>
                                            <h3 className={`text-xs md:text-lg font-bold ${currentTheme.text} mb-1 md:mb-2 ${currentTheme.font}`}>
                                                3. Select
                                            </h3>
                                            <p className={`${currentTheme.textSecondary} text-[0.65rem] md:text-sm hidden md:block`}>
                                                {theme === 'tron' ? 'Choose games to play' : 'Pick your favorite games'}
                                            </p>
                                        </div>
                                        
                                        <div className="text-center">
                                            <div className={`w-12 h-12 md:w-20 md:h-20 mx-auto mb-2 md:mb-4 ${theme === 'tron' ? 'bg-cyan-500/20 tron-border' : 'bg-purple-200 border-2 md:border-4 border-purple-400'} rounded-xl md:rounded-2xl flex items-center justify-center ${theme === 'kids' ? 'kids-bubble' : ''}`} style={{ animationDelay: '0.6s' }}>
                                                <Play className={`w-6 h-6 md:w-10 md:h-10 ${currentTheme.text}`} />
                                            </div>
                                            <h3 className={`text-xs md:text-lg font-bold ${currentTheme.text} mb-1 md:mb-2 ${currentTheme.font}`}>
                                                4. Play
                                            </h3>
                                            <p className={`${currentTheme.textSecondary} text-[0.65rem] md:text-sm hidden md:block`}>
                                                {theme === 'tron' ? 'Game begins!' : 'Have fun together!'}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Explore Games Section */}
                                <div className={`${currentTheme.cardBg} backdrop-blur-lg p-8 rounded-3xl ${theme === 'tron' ? 'tron-border' : 'border-4 border-purple-300'}`}>
                                    <h2 className={`text-3xl font-bold ${currentTheme.text} mb-6 text-center ${currentTheme.font}`}>
                                        {theme === 'tron' ? '> GAME_LIBRARY' : theme === 'kids' ? 'Explore Games ' : 'TORTURE CHAMBER '}
                                    </h2>
                                    
                                    {/* Filters */}
                                    <div className="grid md:grid-cols-3 gap-4 mb-8">
                                        <div>
                                            <label className={`block ${currentTheme.textSecondary} text-sm font-semibold mb-2`}>
                                                Players: {minPlayers === 1 && maxPlayers === 16 ? 'All' : `1-${maxPlayers}`}
                                            </label>
                                            <div className="relative pt-1">
                                                <input
                                                    type="range"
                                                    min="1"
                                                    max="16"
                                                    value={maxPlayers}
                                                    onChange={(e) => {
                                                        const val = parseInt(e.target.value);
                                                        setMinPlayers(1);
                                                        setMaxPlayers(val);
                                                    }}
                                                    className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                                    style={{
                                                        background: theme === 'tron' 
                                                            ? `linear-gradient(to right, #06b6d4 0%, #06b6d4 ${(maxPlayers/16)*100}%, #1f2937 ${(maxPlayers/16)*100}%, #1f2937 100%)`
                                                            : `linear-gradient(to right, #a855f7 0%, #a855f7 ${(maxPlayers/16)*100}%, #e9d5ff ${(maxPlayers/16)*100}%, #e9d5ff 100%)`
                                                    }}
                                                />
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className={`block ${currentTheme.textSecondary} text-sm font-semibold mb-2`}>
                                                Age: {minAge === 5 && maxAge === 18 ? 'All Ages' : `${minAge}+`}
                                            </label>
                                            <div className="relative pt-1">
                                                <input
                                                    type="range"
                                                    min="5"
                                                    max="18"
                                                    value={minAge}
                                                    onChange={(e) => {
                                                        const val = parseInt(e.target.value);
                                                        setMinAge(val);
                                                        setMaxAge(18);
                                                    }}
                                                    className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                                    style={{
                                                        background: theme === 'tron'
                                                            ? `linear-gradient(to right, #1f2937 0%, #1f2937 ${((minAge-5)/13)*100}%, #06b6d4 ${((minAge-5)/13)*100}%, #06b6d4 100%)`
                                                            : `linear-gradient(to right, #e9d5ff 0%, #e9d5ff ${((minAge-5)/13)*100}%, #a855f7 ${((minAge-5)/13)*100}%, #a855f7 100%)`
                                                    }}
                                                />
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className={`block ${currentTheme.textSecondary} text-sm font-semibold mb-2`}>
                                                Sort By
                                            </label>
                                            <select
                                                value={sortBy}
                                                onChange={(e) => setSortBy(e.target.value)}
                                                className={`w-full px-4 py-2 rounded-lg ${theme === 'tron' ? 'bg-black text-cyan-400 border border-cyan-500' : 'bg-white text-purple-900 border-2 border-purple-300'} focus:outline-none focus:ring-2 ${theme === 'tron' ? 'focus:ring-cyan-400' : 'focus:ring-purple-500'}`}
                                            >
                                                <option value="popular">Most Popular</option>
                                                <option value="newest">Newest</option>
                                                <option value="rating">Highest Rated</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    {/* Game Library Grid - Fixed Height */}
                                    <div className={`h-[800px] lg:h-[500px] overflow-y-auto pr-2 ${theme === 'tron' ? 'scrollbar-tron' : theme === 'kids' ? 'scrollbar-kids' : 'scrollbar-scary'}`}>
                                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                                        {MOCK_GAMES
                                            .filter(game => {
                                                // Parse player range
                                                const playerParts = game.players.split('-');
                                                const gameMinPlayers = parseInt(playerParts[0]);
                                                const gameMaxPlayers = playerParts.length > 1 ? parseInt(playerParts[1]) : gameMinPlayers;
                                                
                                                // Check if game's player range is within filter
                                                const playersMatch = gameMinPlayers <= maxPlayers;
                                                
                                                // Check if game's minimum age is at or above filter minimum
                                                const ageMatch = game.ageMin >= minAge;
                                                
                                                return playersMatch && ageMatch;
                                            })
                                            .sort((a, b) => {
                                                if (sortBy === 'rating') return b.rating - a.rating;
                                                if (sortBy === 'newest') return b.id - a.id;
                                                return 0; // popular - default order
                                            })
                                            .map((game) => (
                                            <div
                                                key={game.id}
                                                className={`relative rounded-xl md:rounded-2xl overflow-hidden transition-all duration-300 hover:scale-105 ${theme === 'tron' ? 'border-2 border-cyan-500/50 hover:border-cyan-400 bg-black' : theme === 'kids' ? 'border-2 md:border-4 border-purple-300' : 'border-2 border-orange-700/50 hover:border-orange-600 bg-gray-900'} cursor-pointer`}
                                            >
                                                <div
                                                    className="aspect-square transition-all relative"
                                                    style={{ backgroundColor: theme === 'tron' ? '#0a0a0a' : theme === 'scary' ? '#1a0a00' : game.color }}
                                                >
                                                    {theme === 'tron' && (
                                                        <div className="absolute inset-0 bg-gradient-to-br from-cyan-900/20 to-transparent"></div>
                                                    )}
                                                    {theme === 'scary' && (
                                                        <div className="absolute inset-0 bg-gradient-to-br from-orange-900/20 to-transparent"></div>
                                                    )}
                                                    <div className="absolute inset-0 flex flex-col items-center justify-center p-2 md:p-3">
                                                        <div className={`mb-1 md:mb-2 ${theme === 'tron' ? 'text-cyan-400' : theme === 'scary' ? 'text-orange-500' : 'text-white'}`}>
                                                            {getGameIcon(game.id, 'w-8 h-8 md:w-10 md:h-10 lg:w-12 lg:h-12')}
                                                        </div>
                                                        <span className={`${theme === 'tron' ? 'text-cyan-400' : theme === 'scary' ? 'text-orange-400' : 'text-white'} font-bold text-xs md:text-sm text-center mb-1 md:mb-2 line-clamp-2`}>
                                                            {game.name}
                                                        </span>
                                                        <div className="flex items-center gap-0.5 md:gap-1 mb-0.5 md:mb-1">
                                                            {[1, 2, 3, 4, 5].map((i) => (
                                                                <Star key={i} className={`${theme === 'tron' ? 'text-cyan-400' : theme === 'scary' ? 'text-orange-500' : 'text-yellow-400'} inline w-2 h-2 md:w-3 md:h-3`} filled={i <= Math.floor(game.rating)} />
                                                            ))}
                                                            <span className={`text-[0.6rem] md:text-xs ${theme === 'tron' ? 'text-cyan-300' : theme === 'scary' ? 'text-orange-400' : 'text-white'} ml-0.5 md:ml-1`}>{game.rating}</span>
                                                        </div>
                                                        <span className={`text-[0.6rem] md:text-xs ${theme === 'tron' ? 'text-cyan-500' : theme === 'scary' ? 'text-orange-500' : 'text-white/80'}`}>{game.players}</span>
                                                    </div>
                                                    
                                                    <div className="absolute inset-0 bg-black/0 hover:bg-black/10 transition-all"></div>
                                                </div>
                                                
                                                <div className={`p-1.5 md:p-2 ${theme === 'tron' ? 'bg-cyan-900/20 border-t border-cyan-500/30' : theme === 'scary' ? 'bg-orange-900/20 border-t border-orange-700/30' : 'bg-white/90 border-t border-purple-200'}`}>
                                                    <div className="flex gap-1 md:gap-2">
                                                        <button
                                                            onClick={() => setSelectedGameInfo(game)}
                                                            className={`flex-1 ${theme === 'tron' ? 'bg-cyan-500/30 hover:bg-cyan-500/50 text-cyan-400' : theme === 'scary' ? 'bg-orange-700/40 hover:bg-orange-700/60 text-orange-400' : 'bg-purple-500 hover:bg-purple-400 text-white'} text-[0.6rem] md:text-xs py-1 md:py-1.5 px-1 md:px-2 rounded transition-all flex items-center justify-center gap-0.5 md:gap-1`}
                                                        >
                                                            <Info className="w-2.5 h-2.5 md:w-3 md:h-3" />
                                                            <span className="hidden sm:inline">Info</span>
                                                        </button>
                                                        <a
                                                            href={game.youtubeLink}
                                                            target="_blank"
                                                            rel="noopener noreferrer"
                                                            className={`flex-1 ${theme === 'tron' ? 'bg-red-500/30 hover:bg-red-500/50 text-red-400' : theme === 'scary' ? 'bg-red-700/40 hover:bg-red-700/60 text-red-400' : 'bg-red-500 hover:bg-red-400 text-white'} text-[0.6rem] md:text-xs py-1 md:py-1.5 px-1 md:px-2 rounded transition-all flex items-center justify-center gap-0.5 md:gap-1`}
                                                            onClick={(e) => e.stopPropagation()}
                                                        >
                                                            <Youtube className="w-2.5 h-2.5 md:w-3 md:h-3" />
                                                            <span className="hidden sm:inline">Video</span>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </>
                );
            }

            // Game Room Page
            if (page === 'room') {
                return (
                    <>
                        <Header />
                        <div className={`min-h-screen ${theme === 'tron' ? 'bg-black tron-grid' : theme === 'kids' ? 'bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200' : 'bg-gradient-to-br from-gray-900 via-orange-950 to-black'} p-2 pt-24 md:pt-40 landscape:pt-24`} style={{ minHeight: '100dvh' }}>
                            {isMaster && (
                                <audio ref={audioRef} loop>
                                    {theme === 'tron' && (
                                        <source src="https://www.soundjay.com/mechanical/sounds/mechanical-keyboard-slow-1.mp3" type="audio/mpeg" />
                                    )}
                                    {theme === 'kids' && (
                                        <source src="https://www.soundjay.com/misc/sounds/magic-chime-02.mp3" type="audio/mpeg" />
                                    )}
                                    {theme === 'scary' && (
                                        <source src="https://www.soundjay.com/misc/sounds/horror-bell-1.mp3" type="audio/mpeg" />
                                    )}
                                </audio>
                            )}

                            <div className="max-w-6xl mx-auto" style={{ maxHeight: 'calc(100dvh - 6rem)', overflow: 'auto', paddingBottom: isMaster ? (isMobilePortrait ? '9.5rem' : '5rem') : '0' }}>
                                <div className={`${currentTheme.cardBg} backdrop-blur-lg rounded-2xl md:rounded-3xl p-3 md:p-4 landscape:p-3 ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-2 md:border-4 border-purple-300' : 'border-2 md:border-4 border-orange-700'} mb-2`}>
                                    {/* Room Info - Title/ID with QR right */}
                                    <div className="flex items-stretch gap-2 md:gap-3 mb-2 md:mb-3">
                                        {/* Left - Title + Room ID */}
                                        <div className="flex-1 min-w-0 flex flex-col justify-between">
                                            <div id="room-title" className="mb-1 md:mb-2 text-center">
                                                {isMaster && <Crown className={`mx-auto mb-1 w-6 h-6 md:w-10 md:h-10 ${theme === 'tron' ? 'text-cyan-400' : theme === 'scary' ? 'text-orange-500' : 'text-yellow-400'}`} />}
                                                <h1 className={`text-xl md:text-2xl lg:text-3xl font-bold ${currentTheme.text} ${currentTheme.font} ${theme === 'tron' ? 'tron-text-glow' : ''} break-words overflow-hidden`}>
                                                    {currentRoom?.name}
                                                </h1>
                                            </div>
                                            <div id="room-id" className="flex flex-col mt-auto">
                                                <span className={`text-xs font-semibold ${currentTheme.textSecondary} mb-1`}>Room ID:</span>
                                                <div className={`font-mono text-lg md:text-xl lg:text-2xl font-bold tracking-wider whitespace-nowrap ${theme === 'tron' ? 'bg-cyan-500/20 tron-border text-cyan-400' : theme === 'scary' ? 'bg-orange-900/30 border-2 border-orange-700 text-orange-400' : 'bg-purple-200 text-purple-900 border-2 border-purple-400'} px-3 md:px-4 py-2 md:py-3 rounded-lg text-center inline-block`}>
                                                    {currentRoom?.id}
                                                </div>
                                            </div>
                                        </div>
                                        {/* Right - QR Code (shrink-wrapped, height fills parent) */}
                                        <div
                                            id="room-qr"
                                            className={`shrink-0 ${theme === 'tron' ? 'bg-cyan-500/20 tron-border' : theme === 'scary' ? 'bg-orange-900/30 border-2 border-orange-700' : 'bg-white border-2 md:border-4 border-purple-400'} p-1 md:p-2 rounded-xl cursor-pointer hover:scale-105 transition-transform flex flex-col items-center`}
                                            onClick={() => setQrExpanded(true)}
                                        >
                                            <div className="bg-white rounded p-0.5 flex items-center justify-center flex-1 min-h-0">
                                                <div ref={qrSmallRef} className="qr-small-container"></div>
                                            </div>
                                            <p className={`text-[0.5rem] md:text-[0.6rem] text-center mt-0.5 ${theme === 'tron' ? 'text-cyan-400' : theme === 'scary' ? 'text-orange-400' : 'text-purple-600'} font-semibold leading-none shrink-0`}>
                                                Tap to expand
                                            </p>
                                        </div>
                                    </div>

                                    {/* Expanded QR Code Modal */}
                                    {qrExpanded && (
                                        <div className="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setQrExpanded(false)}>
                                            <div className={`${currentTheme.cardBg} rounded-3xl p-8 max-w-md w-full`} onClick={(e) => e.stopPropagation()}>
                                                <h3 className={`text-2xl font-bold ${currentTheme.text} mb-4 text-center ${currentTheme.font}`}>
                                                    Scan to Join
                                                </h3>
                                                <div className={`${theme === 'tron' ? 'bg-cyan-400' : theme === 'scary' ? 'bg-orange-600' : 'bg-gradient-to-br from-purple-500 to-pink-500'} rounded-2xl p-8 mb-4`}>
                                                    <div className="bg-white rounded-xl p-6 flex items-center justify-center">
                                                        <div ref={qrRef}></div>
                                                    </div>
                                                </div>
                                                <div className={`text-center mb-4 ${currentTheme.text}`}>
                                                    <p className="text-sm mb-2">Room ID:</p>
                                                    <p className="font-mono text-3xl font-bold tracking-wider">{currentRoom?.id}</p>
                                                </div>
                                                <button
                                                    onClick={() => setQrExpanded(false)}
                                                    className={`w-full ${theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black' : theme === 'scary' ? 'bg-orange-700 hover:bg-orange-600 text-white' : 'bg-purple-500 hover:bg-purple-400 text-white'} font-bold py-3 rounded-xl transition-all`}
                                                >
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    )}

                                    {/* Character Avatars Row - scaled to 80% on md/landscape */}
                                    <div id="room-players" className={`origin-top md:scale-[0.8] landscape:scale-[0.8] ${theme === 'tron' ? 'bg-gray-900/50 border border-cyan-500/30' : theme === 'kids' ? 'bg-white/70 border-2 md:border-4 border-purple-300' : 'bg-gray-950/80 border-2 border-orange-700/50 shadow-[0_0_30px_rgba(194,65,12,0.3)]'} rounded-xl md:rounded-2xl p-2 md:p-3 mb-2 landscape:p-2 landscape:mb-1 md:mb-[-10%]`}>
                                        <h3 className={`text-sm md:text-base lg:text-lg font-bold ${currentTheme.text} mb-2 md:mb-3 text-center ${currentTheme.font}`}>
                                            {theme === 'tron' ? 'CONNECTED_PLAYERS' : theme === 'kids' ? 'Players in the Room' : 'SUMMONED SOULS'} ({currentRoom?.players.length})
                                        </h3>
                                        <div className="flex flex-wrap justify-center gap-2 md:gap-4">
                                            {currentRoom?.players.map((player, idx) => {
                                                const isMeta = player.avatar === 'meta';
                                                const character = isMeta
                                                    ? { id: 'meta', name: 'Joining...', color: '#06b6d4' }
                                                    : (availableCharacters.find(c => c.id === player.avatar) || availableCharacters[0]);
                                                const isOwnAvatar = player.name === playerName;
                                                return (
                                                    <div
                                                        key={idx}
                                                        className={`player-avatar relative flex flex-col items-center transition-all hover:scale-110 ${player.isMaster ? 'scale-110' : ''} ${isOwnAvatar && !isMeta ? 'cursor-pointer' : ''}`}
                                                        onClick={() => {
                                                            if (isOwnAvatar && !isMeta && !avatarPickerMode) {
                                                                setSelectedAvatar(player.avatar);
                                                                setAvatarPickerMode('change');
                                                            }
                                                        }}
                                                    >
                                                        {/* Character Card */}
                                                        <div
                                                            className={`w-16 h-20 md:w-20 md:h-24 lg:w-24 lg:h-28 landscape:w-16 landscape:h-20 rounded-2xl p-2 md:p-4 flex flex-col items-center justify-center relative overflow-hidden ${
                                                                isMeta
                                                                    ? 'bg-green-500/10 border border-green-500/30'
                                                                    : theme === 'tron'
                                                                        ? 'bg-cyan-500/20'
                                                                        : theme === 'kids'
                                                                            ? 'bg-gradient-to-br from-purple-200 to-pink-200'
                                                                            : 'bg-gradient-to-br from-gray-900 to-orange-950/50'
                                                            }`}
                                                            style={{
                                                                boxShadow: isMeta
                                                                    ? '0 0 15px rgba(34,197,94,0.3)'
                                                                    : theme === 'tron'
                                                                        ? `0 0 15px ${character.color}40`
                                                                        : theme === 'scary'
                                                                            ? `0 0 15px ${character.color}30`
                                                                            : undefined
                                                            }}
                                                        >
                                                            {/* Crown for master */}
                                                            {player.isMaster && (
                                                                <div className="absolute -top-2 -right-2 bg-yellow-400 rounded-full p-1.5 md:p-2 shadow-lg animate-bounce">
                                                                    <Crown className="w-3 h-3 md:w-5 md:h-5 text-yellow-900" fill="currentColor" />
                                                                </div>
                                                            )}

                                                            {/* Edit indicator for own avatar */}
                                                            {isOwnAvatar && !isMeta && !avatarPickerMode && (
                                                                <div className="absolute -top-1 -left-1 bg-cyan-500 rounded-full p-1 shadow-lg">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="black" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round">
                                                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                                                    </svg>
                                                                </div>
                                                            )}

                                                            {/* Character SVG */}
                                                            <div className="flex-1 flex items-center justify-center w-full min-h-0">
                                                                <CharacterSVG characterId={character.id} size={48} color={character.color} />
                                                            </div>

                                                            {/* "Selecting..." label for meta */}
                                                            {isMeta && (
                                                                <div className="absolute bottom-0.5 left-0 right-0 text-center">
                                                                    <span className="text-[0.5rem] text-green-400 font-mono" style={{ animation: 'softPulse 2s ease-in-out infinite' }}>Selecting...</span>
                                                                </div>
                                                            )}
                                                        </div>

                                                        {/* Player Name Below */}
                                                        <div className={`mt-1 px-2 py-0.5 rounded-full font-semibold text-[0.65rem] md:text-xs ${
                                                            isMeta
                                                                ? 'bg-gray-800 text-green-400'
                                                                : theme === 'tron'
                                                                    ? 'bg-gray-800 text-cyan-400'
                                                                    : theme === 'kids'
                                                                        ? 'bg-white text-purple-700'
                                                                        : 'bg-gray-900 text-orange-400'
                                                        }`}>
                                                            {player.name}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    {/* Games + Chat Side-by-Side on md/landscape */}
                                    <div className="flex flex-col md:flex-row landscape:flex-row gap-2">
                                        {/* Selected Games Section */}
                                        <div id="room-selected-games" className={`md:w-1/2 landscape:w-1/2 flex flex-col ${theme === 'tron' ? 'bg-gray-900/50 border border-cyan-500/30' : theme === 'kids' ? 'bg-white/70 border-2 md:border-4 border-purple-300' : 'bg-gray-950/80 border-2 border-orange-700/50'} rounded-xl md:rounded-2xl p-2 md:p-3`}>
                                            <h3 className={`text-sm md:text-base lg:text-lg font-bold ${currentTheme.text} mb-2 md:mb-3 flex items-center gap-2 ${currentTheme.font}`}>
                                                <Gamepad2 className="w-5 h-5 md:w-6 md:h-6" />
                                                <span className="truncate">{theme === 'tron' ? 'SELECTED_GAMES' : theme === 'kids' ? 'Selected Games' : 'CHOSEN HORRORS'}</span>
                                                <span className="whitespace-nowrap">({selectedGames.length})</span>
                                            </h3>
                                            <div className={`flex-1 overflow-y-auto md:max-h-72 ${theme === 'tron' ? 'scrollbar-tron' : theme === 'kids' ? 'scrollbar-kids' : 'scrollbar-scary'}`}>
                                                <div className="grid grid-cols-1 gap-3">
                                                    {selectedGames.length === 0 ? (
                                                        <p className={`${currentTheme.textSecondary} text-sm col-span-full text-center py-4`}>
                                                            {theme === 'tron' ? '> No games selected' : theme === 'kids' ? 'No games selected yet' : '> The chamber awaits...'}
                                                        </p>
                                                    ) : (
                                                        selectedGames.map((gameId) => {
                                                            const game = MOCK_GAMES.find(g => g.id === gameId);
                                                            return (
                                                                <div
                                                                    key={gameId}
                                                                    className={`${theme === 'tron' ? 'border border-cyan-500/30' : theme === 'kids' ? 'border-2 border-purple-300' : 'border border-orange-700/50'} rounded-lg p-4`}
                                                                >
                                                                    <div className="flex items-start gap-3">
                                                                        <div className={`${theme === 'tron' ? 'text-cyan-400' : theme === 'kids' ? 'text-purple-600' : 'text-orange-500'}`}>
                                                                            {getGameIcon(game?.id, 'w-8 h-8')}
                                                                        </div>
                                                                        <div className="flex-1 min-w-0">
                                                                            <div className={`${currentTheme.text} font-bold text-sm mb-1`}>{game?.name}</div>
                                                                            <div className="flex items-center gap-2 flex-wrap">
                                                                                <div className="flex items-center gap-1">
                                                                                    {[1, 2, 3, 4, 5].map((i) => (
                                                                                        <Star key={i} className={`${theme === 'tron' ? 'text-cyan-400' : theme === 'kids' ? 'text-yellow-400' : 'text-orange-500'} w-3 h-3`} filled={i <= Math.floor(game?.rating || 0)} />
                                                                                    ))}
                                                                                    <span className={`text-xs ${currentTheme.textSecondary} ml-1`}>{game?.rating}</span>
                                                                                </div>
                                                                                <button
                                                                                    onClick={() => setSelectedGameDesc(game)}
                                                                                    className={`text-xs ${currentTheme.text} underline hover:no-underline transition-all`}
                                                                                >
                                                                                    description
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            );
                                                        })
                                                    )}
                                                </div>
                                            </div>
                                        </div>

                                        {/* Lobby Chat Panel - hidden on mobile portrait, visible on md+ and landscape */}
                                        <div id="room-chat" className={`hidden md:flex landscape:flex md:w-1/2 landscape:w-1/2 flex-col ${theme === 'tron' ? 'bg-gray-900/50 border border-cyan-500/30' : theme === 'kids' ? 'bg-white/70 border-2 md:border-4 border-purple-300' : 'bg-gray-950/80 border-2 border-orange-700/50'} rounded-xl md:rounded-2xl p-2 md:p-3`}>
                                            <h3 className={`text-sm md:text-base font-bold ${currentTheme.text} mb-1 flex items-center gap-2 ${currentTheme.font}`}>
                                                {theme === 'tron' ? '> ROOM_CHAT' : theme === 'kids' ? 'Room Chat' : 'WHISPERS'}
                                            </h3>
                                            <div className="relative flex-1">
                                                <div
                                                    ref={chatScrollRef}
                                                    onScroll={handleChatScroll}
                                                    className={`h-40 md:h-56 landscape:h-40 overflow-y-auto mb-1 space-y-1 ${theme === 'tron' ? 'scrollbar-tron' : theme === 'kids' ? 'scrollbar-kids' : 'scrollbar-scary'}`}
                                                >
                                                    {lobbyChatMessages.length === 0 ? (
                                                        <p className={`${currentTheme.textSecondary} text-sm text-center py-4`}>
                                                            {theme === 'tron' ? '> No messages yet...' : theme === 'kids' ? 'No messages yet!' : '> Silence...'}
                                                        </p>
                                                    ) : (
                                                        lobbyChatMessages.map((msg, idx) => {
                                                            const character = availableCharacters.find(c => c.id === msg.avatar) || availableCharacters[0];
                                                            return (
                                                                <div key={idx} className={`${theme === 'tron' ? 'bg-cyan-500/10 border border-cyan-500/30' : theme === 'kids' ? 'bg-purple-100 border-2 border-purple-300' : 'bg-orange-900/20 border border-orange-700/50'} rounded-lg p-2`}>
                                                                    <div className="flex items-start gap-2">
                                                                        <div className="w-7 h-7 flex-shrink-0">
                                                                            <CharacterSVG characterId={msg.avatar} size={28} color={character.color} />
                                                                        </div>
                                                                        <div className="flex-1 min-w-0">
                                                                            <span className={`font-bold text-xs ${currentTheme.text}`}>{msg.player}</span>
                                                                            <span className={`${currentTheme.textSecondary} text-xs ml-2`}>{msg.message}</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            );
                                                        })
                                                    )}
                                                    <div ref={lobbyChatEndRef} />
                                                </div>
                                                {/* Scroll to bottom button */}
                                                {!chatAutoScroll && lobbyChatMessages.length > 0 && (
                                                    <button
                                                        onClick={scrollChatToBottom}
                                                        className={`absolute bottom-2 left-1/2 -translate-x-1/2 z-10 w-8 h-8 rounded-full flex items-center justify-center shadow-lg transition-all hover:scale-110 ${theme === 'tron' ? 'bg-cyan-500 text-black' : theme === 'kids' ? 'bg-purple-500 text-white' : 'bg-orange-700 text-white'}`}
                                                    >
                                                        <ChevronDown className="w-5 h-5" />
                                                    </button>
                                                )}
                                            </div>
                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    value={lobbyChatInput}
                                                    onChange={(e) => setLobbyChatInput(e.target.value)}
                                                    onKeyPress={(e) => e.key === 'Enter' && sendLobbyChat()}
                                                    placeholder={theme === 'tron' ? '> Type message...' : 'Type a message...'}
                                                    maxLength={200}
                                                    className={`flex-1 ${theme === 'tron' ? 'bg-gray-900 text-cyan-400 border border-cyan-500/30' : theme === 'kids' ? 'bg-white text-purple-900 border-2 border-purple-300' : 'bg-gray-900 text-orange-400 border border-orange-700/50'} px-3 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 ${theme === 'tron' ? 'focus:ring-cyan-400' : theme === 'kids' ? 'focus:ring-purple-500' : 'focus:ring-orange-600'}`}
                                                />
                                                <button
                                                    onClick={sendLobbyChat}
                                                    className={`${theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black' : theme === 'kids' ? 'bg-purple-500 hover:bg-purple-400 text-white' : 'bg-orange-700 hover:bg-orange-600 text-white'} px-4 py-2 rounded-lg font-bold text-sm transition-all`}
                                                >
                                                    Send
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            {/* Fixed Bottom Action Bar */}
                            {isMaster && (
                                <div className={`fixed bottom-0 left-0 right-0 z-40 p-3 ${theme === 'tron' ? 'bg-gray-900/95 border-t border-cyan-500/30' : theme === 'kids' ? 'bg-white/95 border-t-2 border-purple-300' : 'bg-gray-950/95 border-t-2 border-orange-700/50'} backdrop-blur-sm`}>
                                    <div className="max-w-6xl mx-auto flex flex-col md:flex-row landscape:flex-row gap-2 items-stretch">
                                        <button
                                            onClick={() => setShowGameSelector(true)}
                                            className={`flex-1 ${theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black tron-glow' : theme === 'kids' ? 'bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-400 hover:to-pink-400 text-white kids-shadow' : 'bg-orange-700 hover:bg-orange-600 text-white shadow-[0_0_20px_rgba(194,65,12,0.5)]'} font-bold py-3 px-6 rounded-xl transition-all duration-300 hover:scale-[1.02] shadow-lg ${currentTheme.font}`}
                                        >
                                            <span className="flex items-center justify-center gap-2 text-base">
                                                <Gamepad2 className="w-5 h-5" />
                                                {theme === 'tron' ? '[ ADD_GAMES ]' : theme === 'kids' ? 'Add Games ' : 'ADD NIGHTMARES '}
                                            </span>
                                        </button>
                                        <button
                                            onClick={startGame}
                                            disabled={selectedGames.length === 0}
                                            className={`flex-1 ${selectedGames.length === 0 ? 'opacity-40 cursor-not-allowed' : 'hover:scale-[1.02]'} ${theme === 'tron' ? 'bg-green-500 hover:bg-green-400 text-black tron-glow' : theme === 'kids' ? 'bg-gradient-to-r from-green-400 to-blue-400 hover:from-green-300 hover:to-blue-300 text-white kids-shadow' : 'bg-gradient-to-r from-green-700 to-green-600 hover:from-green-600 hover:to-green-500 text-white shadow-[0_0_20px_rgba(22,163,74,0.4)]'} font-bold py-3 px-6 rounded-xl transition-all duration-300 shadow-lg ${selectedGames.length > 0 ? 'animate-pulse' : ''} ${currentTheme.font}`}
                                        >
                                            <span className="flex items-center justify-center gap-2 text-base">
                                                <Play className="w-5 h-5" />
                                                {theme === 'tron' ? '[ START_GAME ]' : theme === 'kids' ? 'Start Game! ' : 'START GAME '}
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Floating Chat Icon - Fixed to Room page bottom-right */}
                            <button
                                onClick={() => {
                                    if (isMobilePortrait) {
                                        setShowChatModal(true);
                                        setUnreadCount(0);
                                    } else {
                                        const chatEl = document.getElementById('room-chat');
                                        if (chatEl) chatEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                        setUnreadCount(0);
                                    }
                                }}
                                className={`fixed z-40 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110 ${theme === 'tron' ? 'bg-cyan-500 text-black' : theme === 'kids' ? 'bg-purple-500 text-white' : 'bg-orange-700 text-white'}`}
                                style={{ bottom: isMaster ? (isMobilePortrait ? '9.5rem' : '5rem') : '1rem', right: '1rem' }}
                            >
                                <MessageCircle className="w-6 h-6" />
                                {unreadCount > 0 && (
                                    <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1">
                                        {unreadCount > 9 ? '9+' : unreadCount}
                                    </span>
                                )}
                            </button>

                            {/* Mobile Portrait Chat Modal */}
                            {showChatModal && (
                                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex flex-col">
                                    <div className={`flex-1 flex flex-col mx-3 mt-3 rounded-2xl overflow-hidden ${theme === 'tron' ? 'bg-gray-900 border border-cyan-500/30' : theme === 'kids' ? 'bg-white border-2 border-purple-300' : 'bg-gray-950 border-2 border-orange-700/50'}`} style={{ marginBottom: isMaster ? '9.5rem' : '0.75rem' }}>
                                        {/* Modal Header */}
                                        <div className={`flex items-center justify-between p-3 border-b ${theme === 'tron' ? 'border-cyan-500/30' : theme === 'kids' ? 'border-purple-300' : 'border-orange-700/50'}`}>
                                            <h3 className={`text-base font-bold ${currentTheme.text} ${currentTheme.font}`}>
                                                {theme === 'tron' ? '> ROOM_CHAT' : theme === 'kids' ? 'Room Chat' : 'WHISPERS'}
                                            </h3>
                                            <button onClick={() => setShowChatModal(false)} className={`p-1 rounded-lg ${theme === 'tron' ? 'hover:bg-cyan-500/20 text-cyan-400' : theme === 'kids' ? 'hover:bg-purple-100 text-purple-500' : 'hover:bg-orange-900/40 text-orange-400'}`}>
                                                <X className="w-6 h-6" />
                                            </button>
                                        </div>
                                        {/* Modal Messages */}
                                        <div
                                            ref={modalChatScrollRef}
                                            onScroll={() => {
                                                const el = modalChatScrollRef.current;
                                                if (!el) return;
                                                const atBottom = el.scrollHeight - el.scrollTop - el.clientHeight < 40;
                                                setChatAutoScroll(atBottom);
                                                if (atBottom) setUnreadCount(0);
                                            }}
                                            className={`flex-1 overflow-y-auto p-3 space-y-1 ${theme === 'tron' ? 'scrollbar-tron' : theme === 'kids' ? 'scrollbar-kids' : 'scrollbar-scary'}`}
                                        >
                                            {lobbyChatMessages.length === 0 ? (
                                                <p className={`${currentTheme.textSecondary} text-sm text-center py-4`}>
                                                    {theme === 'tron' ? '> No messages yet...' : theme === 'kids' ? 'No messages yet!' : '> Silence...'}
                                                </p>
                                            ) : (
                                                lobbyChatMessages.map((msg, idx) => {
                                                    const character = availableCharacters.find(c => c.id === msg.avatar) || availableCharacters[0];
                                                    return (
                                                        <div key={idx} className={`${theme === 'tron' ? 'bg-cyan-500/10 border border-cyan-500/30' : theme === 'kids' ? 'bg-purple-100 border-2 border-purple-300' : 'bg-orange-900/20 border border-orange-700/50'} rounded-lg p-2`}>
                                                            <div className="flex items-start gap-2">
                                                                <div className="w-7 h-7 flex-shrink-0">
                                                                    <CharacterSVG characterId={msg.avatar} size={28} color={character.color} />
                                                                </div>
                                                                <div className="flex-1 min-w-0">
                                                                    <span className={`font-bold text-xs ${currentTheme.text}`}>{msg.player}</span>
                                                                    <span className={`${currentTheme.textSecondary} text-xs ml-2`}>{msg.message}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })
                                            )}
                                            <div ref={modalChatEndRef} />
                                        </div>
                                        {/* Scroll to bottom button in modal */}
                                        {!chatAutoScroll && lobbyChatMessages.length > 0 && (
                                            <div className="relative">
                                                <button
                                                    onClick={() => {
                                                        const el = modalChatScrollRef.current;
                                                        if (el) { el.scrollTop = el.scrollHeight; setChatAutoScroll(true); }
                                                    }}
                                                    className={`absolute -top-10 left-1/2 -translate-x-1/2 z-10 w-8 h-8 rounded-full flex items-center justify-center shadow-lg transition-all hover:scale-110 ${theme === 'tron' ? 'bg-cyan-500 text-black' : theme === 'kids' ? 'bg-purple-500 text-white' : 'bg-orange-700 text-white'}`}
                                                >
                                                    <ChevronDown className="w-5 h-5" />
                                                </button>
                                            </div>
                                        )}
                                        {/* Modal Input */}
                                        <div className={`p-3 border-t ${theme === 'tron' ? 'border-cyan-500/30' : theme === 'kids' ? 'border-purple-300' : 'border-orange-700/50'}`}>
                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    value={lobbyChatInput}
                                                    onChange={(e) => setLobbyChatInput(e.target.value)}
                                                    onKeyPress={(e) => e.key === 'Enter' && sendLobbyChat()}
                                                    placeholder={theme === 'tron' ? '> Type message...' : 'Type a message...'}
                                                    maxLength={200}
                                                    className={`flex-1 ${theme === 'tron' ? 'bg-gray-900 text-cyan-400 border border-cyan-500/30' : theme === 'kids' ? 'bg-white text-purple-900 border-2 border-purple-300' : 'bg-gray-900 text-orange-400 border border-orange-700/50'} px-3 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 ${theme === 'tron' ? 'focus:ring-cyan-400' : theme === 'kids' ? 'focus:ring-purple-500' : 'focus:ring-orange-600'}`}
                                                />
                                                <button
                                                    onClick={sendLobbyChat}
                                                    className={`${theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black' : theme === 'kids' ? 'bg-purple-500 hover:bg-purple-400 text-white' : 'bg-orange-700 hover:bg-orange-600 text-white'} px-4 py-2 rounded-lg font-bold text-sm transition-all`}
                                                >
                                                    Send
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Game Selector Modal */}
                            {showGameSelector && (
                                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex flex-col z-50">
                                    <div className={`flex-1 flex flex-col m-2 md:m-4 rounded-2xl md:rounded-3xl overflow-hidden ${currentTheme.cardBg} ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-4 border-purple-400' : 'border-4 border-orange-700'}`}>
                                        {/* Header */}
                                        <div className="p-3 md:p-6 pb-0 md:pb-0">
                                            <h2 className={`text-lg md:text-3xl font-bold ${currentTheme.text} mb-3 md:mb-6 text-center ${currentTheme.font} ${theme === 'tron' ? 'tron-text-glow' : ''}`}>
                                                {theme === 'tron' ? '[ SELECT_GAMES ]' : theme === 'kids' ? 'Select Your Games ' : 'CHOOSE YOUR NIGHTMARES '}
                                            </h2>

                                            {/* Filters */}
                                            <div className="grid grid-cols-3 gap-2 md:gap-4 mb-3 md:mb-4">
                                                {/* Players min-max slider */}
                                                <div>
                                                    <label className={`block ${currentTheme.textSecondary} text-[0.6rem] md:text-sm font-semibold mb-1`}>
                                                        Players: {selectorMinPlayers === 1 && selectorMaxPlayers === 16 ? 'All' : `${selectorMinPlayers}-${selectorMaxPlayers}`}
                                                    </label>
                                                    <div className="dual-range-wrapper relative h-2 mt-2 mb-3">
                                                        <div className={`absolute inset-0 rounded-lg ${theme === 'tron' ? 'bg-gray-800' : theme === 'scary' ? 'bg-stone-900' : 'bg-purple-100'}`}></div>
                                                        <div className="absolute top-0 h-full rounded-lg" style={{
                                                            left: `${((selectorMinPlayers - 1) / 15) * 100}%`,
                                                            right: `${100 - ((selectorMaxPlayers - 1) / 15) * 100}%`,
                                                            background: theme === 'tron' ? '#06b6d4' : theme === 'scary' ? '#ea580c' : '#a855f7'
                                                        }}></div>
                                                        <input
                                                            type="range" min="1" max="16"
                                                            value={selectorMinPlayers}
                                                            onChange={(e) => {
                                                                const v = parseInt(e.target.value);
                                                                setSelectorMinPlayers(Math.min(v, selectorMaxPlayers));
                                                            }}
                                                            className="absolute inset-0 w-full appearance-none bg-transparent pointer-events-none [&::-webkit-slider-thumb]:pointer-events-auto [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:relative [&::-webkit-slider-thumb]:z-10"
                                                            style={{ '--tw-thumb-bg': theme === 'tron' ? '#06b6d4' : theme === 'scary' ? '#ea580c' : '#a855f7' }}
                                                        />
                                                        <input
                                                            type="range" min="1" max="16"
                                                            value={selectorMaxPlayers}
                                                            onChange={(e) => {
                                                                const v = parseInt(e.target.value);
                                                                setSelectorMaxPlayers(Math.max(v, selectorMinPlayers));
                                                            }}
                                                            className="absolute inset-0 w-full appearance-none bg-transparent pointer-events-none [&::-webkit-slider-thumb]:pointer-events-auto [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:relative [&::-webkit-slider-thumb]:z-10"
                                                            style={{ '--tw-thumb-bg': theme === 'tron' ? '#06b6d4' : theme === 'scary' ? '#ea580c' : '#a855f7' }}
                                                        />
                                                    </div>
                                                </div>
                                                {/* Age min-max slider */}
                                                <div>
                                                    <label className={`block ${currentTheme.textSecondary} text-[0.6rem] md:text-sm font-semibold mb-1`}>
                                                        Age: {selectorMinAge === 5 && selectorMaxAge === 18 ? 'All Ages' : `${selectorMinAge}-${selectorMaxAge}`}
                                                    </label>
                                                    <div className="dual-range-wrapper relative h-2 mt-2 mb-3">
                                                        <div className={`absolute inset-0 rounded-lg ${theme === 'tron' ? 'bg-gray-800' : theme === 'scary' ? 'bg-stone-900' : 'bg-purple-100'}`}></div>
                                                        <div className="absolute top-0 h-full rounded-lg" style={{
                                                            left: `${((selectorMinAge - 5) / 13) * 100}%`,
                                                            right: `${100 - ((selectorMaxAge - 5) / 13) * 100}%`,
                                                            background: theme === 'tron' ? '#06b6d4' : theme === 'scary' ? '#ea580c' : '#a855f7'
                                                        }}></div>
                                                        <input
                                                            type="range" min="5" max="18"
                                                            value={selectorMinAge}
                                                            onChange={(e) => {
                                                                const v = parseInt(e.target.value);
                                                                setSelectorMinAge(Math.min(v, selectorMaxAge));
                                                            }}
                                                            className="absolute inset-0 w-full appearance-none bg-transparent pointer-events-none [&::-webkit-slider-thumb]:pointer-events-auto [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:relative [&::-webkit-slider-thumb]:z-10"
                                                            style={{ '--tw-thumb-bg': theme === 'tron' ? '#06b6d4' : theme === 'scary' ? '#ea580c' : '#a855f7' }}
                                                        />
                                                        <input
                                                            type="range" min="5" max="18"
                                                            value={selectorMaxAge}
                                                            onChange={(e) => {
                                                                const v = parseInt(e.target.value);
                                                                setSelectorMaxAge(Math.max(v, selectorMinAge));
                                                            }}
                                                            className="absolute inset-0 w-full appearance-none bg-transparent pointer-events-none [&::-webkit-slider-thumb]:pointer-events-auto [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:relative [&::-webkit-slider-thumb]:z-10"
                                                            style={{ '--tw-thumb-bg': theme === 'tron' ? '#06b6d4' : theme === 'scary' ? '#ea580c' : '#a855f7' }}
                                                        />
                                                    </div>
                                                </div>
                                                {/* Sort */}
                                                <div>
                                                    <label className={`block ${currentTheme.textSecondary} text-[0.6rem] md:text-sm font-semibold mb-1`}>
                                                        Sort By
                                                    </label>
                                                    <select
                                                        value={selectorSortBy}
                                                        onChange={(e) => setSelectorSortBy(e.target.value)}
                                                        className={`w-full px-2 md:px-4 py-1 md:py-2 rounded-lg text-xs md:text-sm ${theme === 'tron' ? 'bg-black text-cyan-400 border border-cyan-500' : theme === 'scary' ? 'bg-gray-900 text-orange-400 border border-orange-700' : 'bg-white text-purple-900 border-2 border-purple-300'} focus:outline-none focus:ring-2 ${theme === 'tron' ? 'focus:ring-cyan-400' : theme === 'scary' ? 'focus:ring-orange-600' : 'focus:ring-purple-500'}`}
                                                    >
                                                        <option value="popular">Most Popular</option>
                                                        <option value="newest">Newest</option>
                                                        <option value="rating">Highest Rated</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Scrollable Game Grid */}
                                        <div className={`flex-1 overflow-y-auto px-3 md:px-6 pb-3 md:pb-4 ${theme === 'tron' ? 'scrollbar-tron' : theme === 'kids' ? 'scrollbar-kids' : 'scrollbar-scary'}`}>
                                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 md:gap-3">
                                                {MOCK_GAMES
                                                    .filter(game => {
                                                        const playerParts = game.players.split('-');
                                                        const gameMinPlayers = parseInt(playerParts[0]);
                                                        const gameMaxPlayers = parseInt(playerParts[1] || playerParts[0]);
                                                        const playersMatch = gameMinPlayers <= selectorMaxPlayers && gameMaxPlayers >= selectorMinPlayers;
                                                        const ageMatch = game.ageMin >= selectorMinAge && game.ageMin <= selectorMaxAge;
                                                        return playersMatch && ageMatch;
                                                    })
                                                    .sort((a, b) => {
                                                        if (selectorSortBy === 'rating') return b.rating - a.rating;
                                                        if (selectorSortBy === 'newest') return b.id - a.id;
                                                        return 0;
                                                    })
                                                    .map((game) => (
                                                    <div
                                                        key={game.id}
                                                        className={`relative rounded-lg md:rounded-xl overflow-hidden transition-all duration-300 hover:scale-105 ${theme === 'tron' ? 'border border-cyan-500/30' : theme === 'kids' ? 'border-2 border-purple-300' : 'border border-orange-700/50'} ${selectedGames.includes(game.id) ? (theme === 'tron' ? 'ring-2 ring-cyan-400' : theme === 'scary' ? 'ring-2 ring-orange-500' : 'ring-2 ring-purple-500') : ''}`}
                                                    >
                                                        <button
                                                            onClick={() => toggleGame(game.id)}
                                                            className="w-full aspect-[4/3] transition-all relative"
                                                            style={{ backgroundColor: theme === 'tron' ? 'transparent' : game.color }}
                                                        >
                                                            {theme === 'scary' && <div className="absolute inset-0 bg-gradient-to-br from-orange-900/20 to-transparent"></div>}
                                                            <div className="absolute inset-0 flex flex-col items-center justify-center p-2">
                                                                <div className={`mb-1 ${theme === 'tron' ? 'text-cyan-400' : theme === 'scary' ? 'text-orange-500' : 'text-white'}`}>
                                                                    {getGameIcon(game.id, 'w-6 h-6 md:w-8 md:h-8')}
                                                                </div>
                                                                <span className={`${theme === 'tron' ? 'text-cyan-400' : theme === 'scary' ? 'text-orange-400' : 'text-white'} font-bold text-[0.6rem] md:text-xs text-center leading-tight line-clamp-2`}>
                                                                    {game.name}
                                                                </span>
                                                                <div className="flex items-center gap-0.5 mt-1">
                                                                    {[1, 2, 3, 4, 5].map((i) => (
                                                                        <Star key={i} className={`${theme === 'tron' ? 'text-cyan-400' : theme === 'scary' ? 'text-orange-500' : 'text-yellow-400'} w-2 h-2 md:w-2.5 md:h-2.5`} filled={i <= Math.floor(game.rating)} />
                                                                    ))}
                                                                </div>
                                                                <span className={`text-[0.5rem] md:text-[0.6rem] mt-0.5 ${theme === 'tron' ? 'text-cyan-500' : theme === 'scary' ? 'text-orange-500' : 'text-white/80'}`}>{game.players}</span>
                                                            </div>
                                                            {selectedGames.includes(game.id) && (
                                                                <div className="absolute top-1 right-1 w-6 h-6 md:w-7 md:h-7 bg-green-500 rounded-full flex items-center justify-center">
                                                                    <Check className="w-3 h-3 md:w-4 md:h-4 text-white" strokeWidth={3} />
                                                                </div>
                                                            )}
                                                        </button>
                                                        <div className={`p-1 md:p-1.5 ${theme === 'tron' ? 'bg-cyan-900/20 border-t border-cyan-500/30' : theme === 'scary' ? 'bg-orange-900/20 border-t border-orange-700/30' : 'bg-white/90 border-t border-purple-200'}`}>
                                                            <div className="flex gap-1">
                                                                <button
                                                                    onClick={() => setSelectedGameDesc(game)}
                                                                    className={`flex-1 ${theme === 'tron' ? 'bg-cyan-500/30 hover:bg-cyan-500/50 text-cyan-400' : theme === 'scary' ? 'bg-orange-700/40 hover:bg-orange-700/60 text-orange-400' : 'bg-purple-500 hover:bg-purple-400 text-white'} text-[0.5rem] md:text-xs py-1 px-1 rounded transition-all flex items-center justify-center gap-0.5`}
                                                                >
                                                                    <Info className="w-2 h-2 md:w-3 md:h-3" />
                                                                    <span className="hidden sm:inline">Desc</span>
                                                                </button>
                                                                <a
                                                                    href={game.youtubeLink}
                                                                    target="_blank"
                                                                    rel="noopener noreferrer"
                                                                    className={`flex-1 ${theme === 'tron' ? 'bg-red-500/30 hover:bg-red-500/50 text-red-400' : theme === 'scary' ? 'bg-red-700/40 hover:bg-red-700/60 text-red-400' : 'bg-red-500 hover:bg-red-400 text-white'} text-[0.5rem] md:text-xs py-1 px-1 rounded transition-all flex items-center justify-center gap-0.5`}
                                                                    onClick={(e) => e.stopPropagation()}
                                                                >
                                                                    <Youtube className="w-2 h-2 md:w-3 md:h-3" />
                                                                    <span className="hidden sm:inline">Video</span>
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Fixed Close Button at bottom */}
                                        <div className={`p-3 md:p-4 border-t ${theme === 'tron' ? 'border-cyan-500/30 bg-gray-900/95' : theme === 'kids' ? 'border-purple-300 bg-white/95' : 'border-orange-700/50 bg-gray-950/95'} backdrop-blur-sm`}>
                                            <button
                                                onClick={() => setShowGameSelector(false)}
                                                className={`w-full ${theme === 'tron' ? 'bg-gray-800 hover:bg-gray-700 text-cyan-400 tron-border' : theme === 'scary' ? 'bg-orange-700 hover:bg-orange-600 text-white' : 'bg-purple-500 hover:bg-purple-400 text-white kids-shadow'} font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2 text-sm md:text-lg`}
                                            >
                                                <X className="w-5 h-5 md:w-6 md:h-6" />
                                                {theme === 'tron' ? '[ CLOSE ]' : theme === 'scary' ? 'SEAL THE CRYPT' : 'Close'}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Game Info Modal */}
                            {selectedGameInfo && (
                                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setSelectedGameInfo(null)}>
                                    <div className={`${currentTheme.cardBg} rounded-3xl p-8 max-w-lg w-full ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-4 border-purple-400' : 'border-4 border-orange-700'}`} onClick={(e) => e.stopPropagation()}>
                                        <h3 className={`text-3xl font-bold ${currentTheme.text} mb-4 ${currentTheme.font}`}>
                                            {selectedGameInfo.name}
                                        </h3>
                                        <div className="mb-4">
                                            <StarRating rating={selectedGameInfo.rating} />
                                        </div>
                                        <p className={`${currentTheme.textSecondary} mb-6 text-lg`}>
                                            {selectedGameInfo.description}
                                        </p>
                                        <button
                                            onClick={() => setSelectedGameInfo(null)}
                                            className={`w-full ${theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black' : theme === 'kids' ? 'bg-purple-500 hover:bg-purple-400 text-white' : 'bg-orange-700 hover:bg-orange-600 text-white'} font-bold py-3 rounded-xl transition-all`}
                                        >
                                            Close
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Selected Game Description Modal */}
                            {selectedGameDesc && (
                                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setSelectedGameDesc(null)}>
                                    <div className={`${currentTheme.cardBg} backdrop-blur-xl rounded-3xl p-8 max-w-lg w-full ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-4 border-purple-400' : 'border-4 border-orange-700'}`} onClick={(e) => e.stopPropagation()}>
                                        <div className="flex items-center gap-4 mb-4">
                                            <div className={`${theme === 'tron' ? 'text-cyan-400' : theme === 'kids' ? 'text-purple-600' : 'text-orange-500'}`}>
                                                {getGameIcon(selectedGameDesc.id, 'w-16 h-16')}
                                            </div>
                                            <div>
                                                <h3 className={`text-2xl font-bold ${currentTheme.text} ${currentTheme.font}`}>
                                                    {selectedGameDesc.name}
                                                </h3>
                                                <div className="flex items-center gap-1 mt-1">
                                                    {[1, 2, 3, 4, 5].map((i) => (
                                                        <Star key={i} className={`${theme === 'tron' ? 'text-cyan-400' : theme === 'kids' ? 'text-yellow-400' : 'text-orange-500'} w-4 h-4`} filled={i <= Math.floor(selectedGameDesc.rating)} />
                                                    ))}
                                                    <span className={`text-sm ${currentTheme.textSecondary} ml-1`}>{selectedGameDesc.rating}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <p className={`${currentTheme.textSecondary} mb-4 text-base`}>
                                            {selectedGameDesc.description}
                                        </p>
                                        <div className={`${currentTheme.textSecondary} text-sm mb-6`}>
                                            <div><strong>Players:</strong> {selectedGameDesc.players}</div>
                                            <div><strong>Age:</strong> {selectedGameDesc.ageMin}+</div>
                                        </div>
                                        <button
                                            onClick={() => setSelectedGameDesc(null)}
                                            className={`w-full ${theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black' : theme === 'kids' ? 'bg-purple-500 hover:bg-purple-400 text-white' : 'bg-orange-700 hover:bg-orange-600 text-white'} font-bold py-3 rounded-xl transition-all`}
                                        >
                                            Close
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Avatar Picker Modal */}
                            {avatarPickerMode && (
                                <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                    <div className={`${currentTheme.cardBg} backdrop-blur-lg rounded-3xl max-w-4xl w-full max-h-[90vh] flex flex-col ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-4 border-purple-300' : 'border-4 border-orange-600'}`}>
                                        {/* Fixed Header */}
                                        <div className="p-6 md:p-8 pb-4">
                                            <h2 className={`text-2xl md:text-3xl font-bold ${currentTheme.text} mb-2 text-center ${currentTheme.font}`}>
                                                {theme === 'tron' ? 'SELECT_CHARACTER' : theme === 'kids' ? 'Choose Your Character!' : 'SUMMON YOUR AVATAR'}
                                            </h2>
                                            <p className={`${currentTheme.textSecondary} text-center text-sm md:text-base`}>
                                                {avatarPickerMode === 'change'
                                                    ? 'Select a new avatar'
                                                    : theme === 'scary' ? 'Choose wisely... others cannot take your form' : 'Pick a character - each is unique to you!'}
                                            </p>
                                            {/* Timer for initial mode */}
                                            {avatarPickerMode === 'initial' && (
                                                <div className="text-center mt-2">
                                                    <span className={`inline-block px-3 py-1 rounded-full text-sm font-bold font-mono ${
                                                        avatarTimerCount <= 10 ? 'bg-red-500/30 text-red-400 animate-pulse' : 'bg-cyan-500/20 text-cyan-400'
                                                    }`}>
                                                        {avatarTimerCount}s
                                                    </span>
                                                </div>
                                            )}
                                        </div>

                                        {/* "Already taken" toast */}
                                        {avatarTakenToast && (
                                            <div className="mx-6 mb-2 p-2 bg-red-500/20 border border-red-500/50 rounded-lg text-center text-red-400 text-sm font-semibold" style={{ animation: 'softPulse 0.5s ease-in-out' }}>
                                                "{avatarTakenToast}" is already taken!
                                            </div>
                                        )}

                                        {/* Scrollable Character Grid */}
                                        <div className={`flex-1 overflow-y-auto px-6 md:px-8 min-h-0 ${theme === 'tron' ? 'scrollbar-tron' : theme === 'kids' ? 'scrollbar-kids' : 'scrollbar-scary'}`}>
                                            {['common', 'uncommon', 'rare', 'legendary'].map(rarity => {
                                                const chars = availableCharacters.filter(c => (c.rarity || 'common') === rarity);
                                                if (chars.length === 0) return null;
                                                const rc = rarityConfig[rarity];
                                                return (
                                                    <div key={rarity} className="mb-4">
                                                        <div className="flex items-center gap-2 mb-2 pt-1">
                                                            <span className="text-xs font-bold tracking-widest uppercase" style={{ color: rc.color }}>{rc.label}</span>
                                                            <div className="flex-1 h-px" style={{ background: rc.color, opacity: 0.3 }}></div>
                                                        </div>
                                                        <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                                                            {chars.map((character) => {
                                                                const myRoomAvatar = currentRoom?.players.find(p => p.name === playerName)?.avatar;
                                                                const isTaken = takenCharacters.filter(a => a !== myRoomAvatar).includes(character.id);
                                                                const isLocked = character.unlock != null;
                                                                const isSelected = selectedAvatar === character.id;
                                                                return (
                                                                    <div key={character.id} className="relative">
                                                                        <button
                                                                            onClick={() => {
                                                                                if (isLocked) return;
                                                                                if (isTaken) {
                                                                                    setAvatarTakenToast(character.name);
                                                                                    setTimeout(() => setAvatarTakenToast(''), 2000);
                                                                                    return;
                                                                                }
                                                                                setSelectedAvatar(character.id);
                                                                            }}
                                                                            disabled={isLocked}
                                                                            className={`relative w-full p-3 rounded-xl transition-all ${
                                                                                isLocked
                                                                                    ? `opacity-40 cursor-not-allowed bg-gray-800/40 border ${rc.border}`
                                                                                    : isTaken
                                                                                        ? 'opacity-40 bg-gray-800/30 grayscale cursor-pointer'
                                                                                        : isSelected
                                                                                            ? `bg-cyan-500/30 tron-border scale-105 ring-4 ring-cyan-400 ${rc.glow}`
                                                                                            : `bg-gray-800/50 border ${rc.border} hover:bg-gray-700/50 hover:scale-105 ${rc.glow}`
                                                                            }`}
                                                                        >
                                                                            {/* Rarity dot */}
                                                                            <div className="absolute top-1.5 left-1.5">
                                                                                <div className="w-2 h-2 rounded-full" style={{ background: rc.color }}></div>
                                                                            </div>
                                                                            {/* Lock icon */}
                                                                            {isLocked && (
                                                                                <div className="absolute top-1.5 right-1.5">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke={rc.color} strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                                                                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                                                                    </svg>
                                                                                </div>
                                                                            )}
                                                                            <div className={`mb-1 flex justify-center ${isLocked ? 'grayscale' : ''}`}>
                                                                                <CharacterSVG characterId={character.id} size={60} color={isLocked ? '#555' : character.color} />
                                                                            </div>
                                                                            <div className={`text-xs font-semibold text-center ${(isLocked || isTaken) ? 'text-gray-600' : currentTheme.text}`}>
                                                                                {character.name}
                                                                                {isTaken && !isLocked && <div className="text-[0.6rem] text-gray-500 mt-0.5">Taken</div>}
                                                                            </div>
                                                                        </button>
                                                                        {/* Info button */}
                                                                        <button
                                                                            onClick={(e) => { e.stopPropagation(); setCharacterInfoModal(character); }}
                                                                            className="absolute bottom-1.5 right-1.5 w-5 h-5 rounded-full flex items-center justify-center bg-gray-700/80 hover:bg-gray-600 transition-colors"
                                                                            style={{ color: rc.color }}
                                                                        >
                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                                                                                <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
                                                                            </svg>
                                                                        </button>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>

                                        {/* Fixed Footer */}
                                        <div className="p-6 md:p-8 pt-4 flex gap-3">
                                            <button
                                                onClick={confirmAvatarSelection}
                                                disabled={!selectedAvatar || selectedAvatar === 'meta'}
                                                className={`flex-1 ${
                                                    !selectedAvatar || selectedAvatar === 'meta'
                                                        ? 'bg-gray-700 text-gray-500 cursor-not-allowed'
                                                        : theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black' : theme === 'kids' ? 'bg-purple-500 hover:bg-purple-400 text-white' : 'bg-orange-700 hover:bg-orange-600 text-white'
                                                } font-bold py-3 rounded-xl transition-all`}
                                            >
                                                {theme === 'tron' ? '[ CONFIRM ]' : 'Confirm'}
                                            </button>
                                            {avatarPickerMode === 'change' && (
                                                <button
                                                    onClick={() => setAvatarPickerMode(null)}
                                                    className={`px-6 ${theme === 'tron' ? 'bg-gray-800 hover:bg-gray-700 text-cyan-400' : theme === 'kids' ? 'bg-purple-200 hover:bg-purple-300 text-purple-900' : 'bg-gray-800 hover:bg-gray-700 text-orange-400'} font-bold py-3 rounded-xl transition-all`}
                                                >
                                                    Cancel
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Character Info Modal */}
                            {characterInfoModal && (() => {
                                const c = characterInfoModal;
                                const rc = rarityConfig[c.rarity || 'common'];
                                const isLocked = c.unlock != null;
                                return (
                                    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-[60]" onClick={() => setCharacterInfoModal(null)}>
                                        <div className={`${currentTheme.cardBg} backdrop-blur-xl rounded-3xl max-w-sm w-full p-6 ${rc.glow}`} style={{ border: `2px solid ${rc.color}40` }} onClick={(e) => e.stopPropagation()}>
                                            <div className="text-center mb-4">
                                                <div className="inline-block mb-3">
                                                    <CharacterSVG characterId={c.id} size={100} color={isLocked ? '#555' : c.color} />
                                                </div>
                                                <h3 className={`text-xl font-bold ${currentTheme.font}`} style={{ color: rc.color }}>{c.name}</h3>
                                                <span className="inline-block mt-1 text-[0.65rem] font-bold tracking-widest uppercase px-2 py-0.5 rounded-full" style={{ color: rc.color, background: `${rc.color}20`, border: `1px solid ${rc.color}40` }}>
                                                    {rc.label}
                                                </span>
                                            </div>
                                            <p className={`${currentTheme.textSecondary} text-sm text-center mb-4 leading-relaxed`}>
                                                {c.description || 'A character of the grid.'}
                                            </p>
                                            {isLocked ? (
                                                <div className="text-center mb-4">
                                                    <div className="flex items-center justify-center gap-2 mb-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke={rc.color} strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                                                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                                        </svg>
                                                        <span className="text-xs font-bold uppercase tracking-wide" style={{ color: rc.color }}>How to Unlock</span>
                                                    </div>
                                                    <p className="text-sm text-cyan-300 font-medium">{c.unlock}</p>
                                                </div>
                                            ) : (
                                                <div className="text-center mb-4">
                                                    <span className="text-xs font-bold text-green-400 uppercase tracking-wide">Unlocked</span>
                                                </div>
                                            )}
                                            <button
                                                onClick={() => setCharacterInfoModal(null)}
                                                className="w-full bg-gray-800 hover:bg-gray-700 text-cyan-400 tron-border font-bold py-2.5 rounded-xl transition-all text-sm"
                                            >
                                                [ CLOSE ]
                                            </button>
                                        </div>
                                    </div>
                                );
                            })()}

                            {/* Master Tips Modal */}
                            {showMasterTips && (
                                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-[60]" onClick={() => setShowMasterTips(false)}>
                                    <div className={`${currentTheme.cardBg} backdrop-blur-xl rounded-3xl max-w-md w-full p-6 ${theme === 'tron' ? 'tron-border' : theme === 'kids' ? 'border-4 border-purple-300' : 'border-4 border-orange-600'}`} onClick={(e) => e.stopPropagation()}>
                                        <div className="text-center mb-5">
                                            <div className="inline-block mb-3 bg-yellow-400 rounded-full p-3">
                                                <Crown className="w-8 h-8 text-yellow-900" fill="currentColor" />
                                            </div>
                                            <h3 className={`text-xl font-bold ${currentTheme.text} ${currentTheme.font}`}>
                                                {theme === 'tron' ? 'GAME_MASTER_PROTOCOL' : 'Game Master Tips'}
                                            </h3>
                                            <p className={`${currentTheme.textSecondary} text-sm mt-1`}>Tips for an awesome game room</p>
                                        </div>
                                        <div className="space-y-3 mb-5">
                                            {/* Tip 1: Music */}
                                            <div className="flex items-start gap-3 p-3 rounded-xl bg-gray-800/50">
                                                <div className="flex-shrink-0 w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#06b6d4" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                        <path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/>
                                                    </svg>
                                                </div>
                                                <div>
                                                    <p className={`text-sm font-semibold ${currentTheme.text}`}>Turn on the music</p>
                                                    <p className="text-xs text-gray-400">Hit the sound icon in the header to set the mood with the theme soundtrack</p>
                                                </div>
                                            </div>
                                            {/* Tip 2: Screen share */}
                                            <div className="flex items-start gap-3 p-3 rounded-xl bg-gray-800/50">
                                                <div className="flex-shrink-0 w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#06b6d4" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/>
                                                    </svg>
                                                </div>
                                                <div>
                                                    <p className={`text-sm font-semibold ${currentTheme.text}`}>Cast to a TV</p>
                                                    <p className="text-xs text-gray-400">Screen share or cast to a big screen for a party-style social experience</p>
                                                </div>
                                            </div>
                                            {/* Tip 3: Share room */}
                                            <div className="flex items-start gap-3 p-3 rounded-xl bg-gray-800/50">
                                                <div className="flex-shrink-0 w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#06b6d4" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                        <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/>
                                                    </svg>
                                                </div>
                                                <div>
                                                    <p className={`text-sm font-semibold ${currentTheme.text}`}>Share the QR code</p>
                                                    <p className="text-xs text-gray-400">Friends can scan the QR code or enter the room code to join instantly</p>
                                                </div>
                                            </div>
                                            {/* Tip 4: Mix games */}
                                            <div className="flex items-start gap-3 p-3 rounded-xl bg-gray-800/50">
                                                <div className="flex-shrink-0 w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                                                    <Gamepad2 className="w-[18px] h-[18px]" style={{ color: '#06b6d4' }} />
                                                </div>
                                                <div>
                                                    <p className={`text-sm font-semibold ${currentTheme.text}`}>Mix up the games</p>
                                                    <p className="text-xs text-gray-400">Add a variety of games to keep things fresh  you control the playlist</p>
                                                </div>
                                            </div>
                                            {/* Tip 5: You're in charge */}
                                            <div className="flex items-start gap-3 p-3 rounded-xl bg-gray-800/50">
                                                <div className="flex-shrink-0 w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                                                    <Crown className="w-[18px] h-[18px]" style={{ color: '#06b6d4' }} />
                                                </div>
                                                <div>
                                                    <p className={`text-sm font-semibold ${currentTheme.text}`}>You're the Game Master</p>
                                                    <p className="text-xs text-gray-400">Only you can add/remove games and start the round  use your power wisely</p>
                                                </div>
                                            </div>
                                        </div>
                                        <button
                                            onClick={() => setShowMasterTips(false)}
                                            className={`w-full ${theme === 'tron' ? 'bg-cyan-500 hover:bg-cyan-400 text-black' : theme === 'kids' ? 'bg-purple-500 hover:bg-purple-400 text-white' : 'bg-orange-700 hover:bg-orange-600 text-white'} font-bold py-3 rounded-xl transition-all ${currentTheme.font}`}
                                        >
                                            {theme === 'tron' ? '[ LET\'S GO ]' : 'Got it!'}
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </>
                );
            }

            // Countdown Page
            if (page === 'countdown') {
                return (
                    <>
                        <Header />
                        <div className={`min-h-screen ${theme === 'tron' ? 'bg-black tron-grid' : theme === 'kids' ? 'bg-gradient-to-br from-orange-400 via-pink-500 to-purple-600' : 'bg-gradient-to-br from-gray-900 via-orange-950 to-black'} flex items-center justify-center p-4`} style={{ minHeight: '100dvh' }}>
                            <div className={`backdrop-blur-xl ${theme === 'tron' ? 'bg-gray-900/80 border-4 border-cyan-500' : theme === 'kids' ? 'bg-white/80 border-4 border-purple-400' : 'bg-gray-950/80 border-4 border-orange-600'} rounded-3xl p-8 md:p-16 shadow-2xl max-w-lg w-full`}>
                                <h2 className={`${theme === 'tron' ? 'text-cyan-400 tron-text-glow' : theme === 'kids' ? 'text-purple-700' : 'text-orange-500'} text-2xl md:text-5xl font-bold mb-6 md:mb-12 animate-pulse ${currentTheme.font} text-center`}>
                                    {theme === 'tron' ? '> INITIALIZING...' : theme === 'kids' ? 'Get Ready! ' : 'IT BEGINS... '}
                                </h2>
                                <div className={`${theme === 'tron' ? 'text-cyan-400 tron-text-glow' : theme === 'kids' ? 'text-purple-700' : 'text-orange-500'} font-black leading-none ${currentTheme.font} text-center text-[8rem] md:text-[15rem]`}>
                                    {countdown}
                                </div>
                            </div>
                        </div>
                    </>
                );
            }

            // Game Page - Pictionary
            if (page === 'game') {
                return (
                    <>
                        <Header />
                        <PictionaryGame 
                            theme={theme}
                            currentTheme={currentTheme}
                            playerName={playerName}
                            selectedAvatar={selectedAvatar}
                            availableCharacters={availableCharacters}
                            currentRoom={currentRoom}
                            isMuted={isMuted}
                        />
                    </>
                );
            }

            return null;
        }

        ReactDOM.render(<GameRoomApp />, document.getElementById('root'));
    </script>
</body>
</html>
